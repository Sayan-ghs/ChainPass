const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-De7PG1tA.js","assets/index-BEge5-cv.js","assets/index-BJwYJt8M.css"])))=>i.map(i=>d[i]);
import{I as fi,B as pf,d as ro,s as Hs,a as Ji,c as $w,b as Dw,k as qw,e as jw,f as Uw,g as Zh,h as de,i as Lc,j as k,l as Ut,m as Mw,n as df,o as gf,p as zc,q as Gt,t as jt,x as yf,r as vf,H as Lw,u as mf,v as fo,w as ac,y as Xh,C as zw,z as Hw,A as kw,D as Kw,E as Gi,F as wf,G as rr,J as mo,K as el,L as Vw,M as Bw,N as wo,O as _f,P as Hc,Q as jr,R as _o,S as bo,T as yt,U as St,V as tl,W as Fw,X as Gw,Y as kc,Z as Eo,$ as Kc,_ as Dr,a0 as Ww,a1 as rl,a2 as Qw}from"./index-BEge5-cv.js";const Jw=Object.freeze(Object.defineProperty({__proto__:null,IEvents:fi},Symbol.toStringTag,{value:"Module"}));function Yw(o,t=[]){const r=[];return Object.keys(o).forEach(s=>{if(t.length&&!t.includes(s))return;const a=o[s];r.push(...a.accounts)}),r}const Zw={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}};function Xw(o,t){const{message:r,code:s}=Zw[o];return{message:r,code:s}}function Ic(o,t){return!!Array.isArray(o)}function e_(o){return!o||typeof o.then!="function"?Promise.resolve(o):o}function Be(o,...t){try{return e_(o(...t))}catch(r){return Promise.reject(r)}}function t_(o){const t=typeof o;return o===null||t!=="object"&&t!=="function"}function r_(o){const t=Object.getPrototypeOf(o);return!t||t.isPrototypeOf(Object)}function co(o){if(t_(o))return String(o);if(r_(o)||Array.isArray(o))return JSON.stringify(o);if(typeof o.toJSON=="function")return co(o.toJSON());throw new Error("[unstorage] Cannot stringify value!")}const Pc="base64:";function i_(o){return typeof o=="string"?o:Pc+o_(o)}function s_(o){return typeof o!="string"||!o.startsWith(Pc)?o:n_(o.slice(Pc.length))}function n_(o){return globalThis.Buffer?pf.from(o,"base64"):Uint8Array.from(globalThis.atob(o),t=>t.codePointAt(0))}function o_(o){return globalThis.Buffer?pf.from(o).toString("base64"):globalThis.btoa(String.fromCodePoint(...o))}function dt(o){var t;return o&&((t=o.split("?")[0])==null?void 0:t.replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,""))||""}function a_(...o){return dt(o.join(":"))}function io(o){return o=dt(o),o?o+":":""}function c_(o,t){if(t===void 0)return!0;let r=0,s=o.indexOf(":");for(;s>-1;)r++,s=o.indexOf(":",s+1);return r<=t}function u_(o,t){return t?o.startsWith(t)&&o[o.length-1]!=="$":o[o.length-1]!=="$"}const h_="memory",l_=()=>{const o=new Map;return{name:h_,getInstance:()=>o,hasItem(t){return o.has(t)},getItem(t){return o.get(t)??null},getItemRaw(t){return o.get(t)??null},setItem(t,r){o.set(t,r)},setItemRaw(t,r){o.set(t,r)},removeItem(t){o.delete(t)},getKeys(){return[...o.keys()]},clear(){o.clear()},dispose(){o.clear()}}};function f_(o={}){const t={mounts:{"":o.driver||l_()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},r=y=>{for(const E of t.mountpoints)if(y.startsWith(E))return{base:E,relativeKey:y.slice(E.length),driver:t.mounts[E]};return{base:"",relativeKey:y,driver:t.mounts[""]}},s=(y,E)=>t.mountpoints.filter(P=>P.startsWith(y)||E&&y.startsWith(P)).map(P=>({relativeBase:y.length>P.length?y.slice(P.length):void 0,mountpoint:P,driver:t.mounts[P]})),a=(y,E)=>{if(t.watching){E=dt(E);for(const P of t.watchListeners)P(y,E)}},u=async()=>{if(!t.watching){t.watching=!0;for(const y in t.mounts)t.unwatch[y]=await il(t.mounts[y],a,y)}},l=async()=>{if(t.watching){for(const y in t.unwatch)await t.unwatch[y]();t.unwatch={},t.watching=!1}},g=(y,E,P)=>{const S=new Map,q=D=>{let z=S.get(D.base);return z||(z={driver:D.driver,base:D.base,items:[]},S.set(D.base,z)),z};for(const D of y){const z=typeof D=="string",ne=dt(z?D:D.key),Z=z?void 0:D.value,ge=z||!D.options?E:{...E,...D.options},te=r(ne);q(te).items.push({key:ne,value:Z,relativeKey:te.relativeKey,options:ge})}return Promise.all([...S.values()].map(D=>P(D))).then(D=>D.flat())},w={hasItem(y,E={}){y=dt(y);const{relativeKey:P,driver:S}=r(y);return Be(S.hasItem,P,E)},getItem(y,E={}){y=dt(y);const{relativeKey:P,driver:S}=r(y);return Be(S.getItem,P,E).then(q=>ro(q))},getItems(y,E={}){return g(y,E,P=>P.driver.getItems?Be(P.driver.getItems,P.items.map(S=>({key:S.relativeKey,options:S.options})),E).then(S=>S.map(q=>({key:a_(P.base,q.key),value:ro(q.value)}))):Promise.all(P.items.map(S=>Be(P.driver.getItem,S.relativeKey,S.options).then(q=>({key:S.key,value:ro(q)})))))},getItemRaw(y,E={}){y=dt(y);const{relativeKey:P,driver:S}=r(y);return S.getItemRaw?Be(S.getItemRaw,P,E):Be(S.getItem,P,E).then(q=>s_(q))},async setItem(y,E,P={}){if(E===void 0)return w.removeItem(y);y=dt(y);const{relativeKey:S,driver:q}=r(y);q.setItem&&(await Be(q.setItem,S,co(E),P),q.watch||a("update",y))},async setItems(y,E){await g(y,E,async P=>{if(P.driver.setItems)return Be(P.driver.setItems,P.items.map(S=>({key:S.relativeKey,value:co(S.value),options:S.options})),E);P.driver.setItem&&await Promise.all(P.items.map(S=>Be(P.driver.setItem,S.relativeKey,co(S.value),S.options)))})},async setItemRaw(y,E,P={}){if(E===void 0)return w.removeItem(y,P);y=dt(y);const{relativeKey:S,driver:q}=r(y);if(q.setItemRaw)await Be(q.setItemRaw,S,E,P);else if(q.setItem)await Be(q.setItem,S,i_(E),P);else return;q.watch||a("update",y)},async removeItem(y,E={}){typeof E=="boolean"&&(E={removeMeta:E}),y=dt(y);const{relativeKey:P,driver:S}=r(y);S.removeItem&&(await Be(S.removeItem,P,E),(E.removeMeta||E.removeMata)&&await Be(S.removeItem,P+"$",E),S.watch||a("remove",y))},async getMeta(y,E={}){typeof E=="boolean"&&(E={nativeOnly:E}),y=dt(y);const{relativeKey:P,driver:S}=r(y),q=Object.create(null);if(S.getMeta&&Object.assign(q,await Be(S.getMeta,P,E)),!E.nativeOnly){const D=await Be(S.getItem,P+"$",E).then(z=>ro(z));D&&typeof D=="object"&&(typeof D.atime=="string"&&(D.atime=new Date(D.atime)),typeof D.mtime=="string"&&(D.mtime=new Date(D.mtime)),Object.assign(q,D))}return q},setMeta(y,E,P={}){return this.setItem(y+"$",E,P)},removeMeta(y,E={}){return this.removeItem(y+"$",E)},async getKeys(y,E={}){var ne;y=io(y);const P=s(y,!0);let S=[];const q=[];let D=!0;for(const Z of P){(ne=Z.driver.flags)!=null&&ne.maxDepth||(D=!1);const ge=await Be(Z.driver.getKeys,Z.relativeBase,E);for(const te of ge){const ie=Z.mountpoint+dt(te);S.some(he=>ie.startsWith(he))||q.push(ie)}S=[Z.mountpoint,...S.filter(te=>!te.startsWith(Z.mountpoint))]}const z=E.maxDepth!==void 0&&!D;return q.filter(Z=>(!z||c_(Z,E.maxDepth))&&u_(Z,y))},async clear(y,E={}){y=io(y),await Promise.all(s(y,!1).map(async P=>{if(P.driver.clear)return Be(P.driver.clear,P.relativeBase,E);if(P.driver.removeItem){const S=await P.driver.getKeys(P.relativeBase||"",E);return Promise.all(S.map(q=>P.driver.removeItem(q,E)))}}))},async dispose(){await Promise.all(Object.values(t.mounts).map(y=>sl(y)))},async watch(y){return await u(),t.watchListeners.push(y),async()=>{t.watchListeners=t.watchListeners.filter(E=>E!==y),t.watchListeners.length===0&&await l()}},async unwatch(){t.watchListeners=[],await l()},mount(y,E){if(y=io(y),y&&t.mounts[y])throw new Error(`already mounted at ${y}`);return y&&(t.mountpoints.push(y),t.mountpoints.sort((P,S)=>S.length-P.length)),t.mounts[y]=E,t.watching&&Promise.resolve(il(E,a,y)).then(P=>{t.unwatch[y]=P}).catch(console.error),w},async unmount(y,E=!0){var P,S;y=io(y),!(!y||!t.mounts[y])&&(t.watching&&y in t.unwatch&&((S=(P=t.unwatch)[y])==null||S.call(P),delete t.unwatch[y]),E&&await sl(t.mounts[y]),t.mountpoints=t.mountpoints.filter(q=>q!==y),delete t.mounts[y])},getMount(y=""){y=dt(y)+":";const E=r(y);return{driver:E.driver,base:E.base}},getMounts(y="",E={}){return y=dt(y),s(y,E.parents).map(S=>({driver:S.driver,base:S.mountpoint}))},keys:(y,E={})=>w.getKeys(y,E),get:(y,E={})=>w.getItem(y,E),set:(y,E,P={})=>w.setItem(y,E,P),has:(y,E={})=>w.hasItem(y,E),del:(y,E={})=>w.removeItem(y,E),remove:(y,E={})=>w.removeItem(y,E)};return w}function il(o,t,r){return o.watch?o.watch((s,a)=>t(s,r+a)):()=>{}}async function sl(o){typeof o.dispose=="function"&&await Be(o.dispose)}const p_="idb-keyval";var d_=(o={})=>{const t=o.base&&o.base.length>0?`${o.base}:`:"",r=a=>t+a;let s;return o.dbName&&o.storeName&&(s=$w(o.dbName,o.storeName)),{name:p_,options:o,async hasItem(a){return!(typeof await Zh(r(a),s)>"u")},async getItem(a){return await Zh(r(a),s)??null},setItem(a,u){return Uw(r(a),u,s)},removeItem(a){return jw(r(a),s)},getKeys(){return qw(s)},clear(){return Dw(s)}}};const g_="WALLET_CONNECT_V2_INDEXED_DB",y_="keyvaluestorage";let v_=class{constructor(){this.indexedDb=f_({driver:d_({dbName:g_,storeName:y_})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(t=>[t.key,t.value])}async getItem(t){const r=await this.indexedDb.getItem(t);if(r!==null)return r}async setItem(t,r){await this.indexedDb.setItem(t,Ji(r))}async removeItem(t){await this.indexedDb.removeItem(t)}};var cc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof de<"u"?de:typeof self<"u"?self:{},uo={exports:{}};(function(){let o;function t(){}o=t,o.prototype.getItem=function(r){return this.hasOwnProperty(r)?String(this[r]):null},o.prototype.setItem=function(r,s){this[r]=String(s)},o.prototype.removeItem=function(r){delete this[r]},o.prototype.clear=function(){const r=this;Object.keys(r).forEach(function(s){r[s]=void 0,delete r[s]})},o.prototype.key=function(r){return r=r||0,Object.keys(this)[r]},o.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof cc<"u"&&cc.localStorage?uo.exports=cc.localStorage:typeof window<"u"&&window.localStorage?uo.exports=window.localStorage:uo.exports=new t})();function m_(o){var t;return[o[0],Hs((t=o[1])!=null?t:"")]}let w_=class{constructor(){this.localStorage=uo.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(m_)}async getItem(t){const r=this.localStorage.getItem(t);if(r!==null)return Hs(r)}async setItem(t,r){this.localStorage.setItem(t,Ji(r))}async removeItem(t){this.localStorage.removeItem(t)}};const __="wc_storage_version",nl=1,b_=async(o,t,r)=>{const s=__,a=await t.getItem(s);if(a&&a>=nl){r(t);return}const u=await o.getKeys();if(!u.length){r(t);return}const l=[];for(;u.length;){const g=u.shift();if(!g)continue;const w=g.toLowerCase();if(w.includes("wc@")||w.includes("walletconnect")||w.includes("wc_")||w.includes("wallet_connect")){const y=await o.getItem(g);await t.setItem(g,y),l.push(g)}}await t.setItem(s,nl),r(t),E_(o,l)},E_=async(o,t)=>{t.length&&t.forEach(async r=>{await o.removeItem(r)})};let I_=class{constructor(){this.initialized=!1,this.setInitialized=r=>{this.storage=r,this.initialized=!0};const t=new w_;this.storage=t;try{const r=new v_;b_(t,r,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(t){return await this.initialize(),this.storage.getItem(t)}async setItem(t,r){return await this.initialize(),this.storage.setItem(t,r)}async removeItem(t){return await this.initialize(),this.storage.removeItem(t)}async initialize(){this.initialized||await new Promise(t=>{const r=setInterval(()=>{this.initialized&&(clearInterval(r),t())},20)})}};var Yi={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Sc=function(o,t){return Sc=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,s){r.__proto__=s}||function(r,s){for(var a in s)s.hasOwnProperty(a)&&(r[a]=s[a])},Sc(o,t)};function P_(o,t){Sc(o,t);function r(){this.constructor=o}o.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}var Oc=function(){return Oc=Object.assign||function(t){for(var r,s=1,a=arguments.length;s<a;s++){r=arguments[s];for(var u in r)Object.prototype.hasOwnProperty.call(r,u)&&(t[u]=r[u])}return t},Oc.apply(this,arguments)};function S_(o,t){var r={};for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&t.indexOf(s)<0&&(r[s]=o[s]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,s=Object.getOwnPropertySymbols(o);a<s.length;a++)t.indexOf(s[a])<0&&Object.prototype.propertyIsEnumerable.call(o,s[a])&&(r[s[a]]=o[s[a]]);return r}function O_(o,t,r,s){var a=arguments.length,u=a<3?t:s===null?s=Object.getOwnPropertyDescriptor(t,r):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(o,t,r,s);else for(var g=o.length-1;g>=0;g--)(l=o[g])&&(u=(a<3?l(u):a>3?l(t,r,u):l(t,r))||u);return a>3&&u&&Object.defineProperty(t,r,u),u}function R_(o,t){return function(r,s){t(r,s,o)}}function T_(o,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(o,t)}function A_(o,t,r,s){function a(u){return u instanceof r?u:new r(function(l){l(u)})}return new(r||(r=Promise))(function(u,l){function g(E){try{y(s.next(E))}catch(P){l(P)}}function w(E){try{y(s.throw(E))}catch(P){l(P)}}function y(E){E.done?u(E.value):a(E.value).then(g,w)}y((s=s.apply(o,t||[])).next())})}function x_(o,t){var r={label:0,sent:function(){if(u[0]&1)throw u[1];return u[1]},trys:[],ops:[]},s,a,u,l;return l={next:g(0),throw:g(1),return:g(2)},typeof Symbol=="function"&&(l[Symbol.iterator]=function(){return this}),l;function g(y){return function(E){return w([y,E])}}function w(y){if(s)throw new TypeError("Generator is already executing.");for(;r;)try{if(s=1,a&&(u=y[0]&2?a.return:y[0]?a.throw||((u=a.return)&&u.call(a),0):a.next)&&!(u=u.call(a,y[1])).done)return u;switch(a=0,u&&(y=[y[0]&2,u.value]),y[0]){case 0:case 1:u=y;break;case 4:return r.label++,{value:y[1],done:!1};case 5:r.label++,a=y[1],y=[0];continue;case 7:y=r.ops.pop(),r.trys.pop();continue;default:if(u=r.trys,!(u=u.length>0&&u[u.length-1])&&(y[0]===6||y[0]===2)){r=0;continue}if(y[0]===3&&(!u||y[1]>u[0]&&y[1]<u[3])){r.label=y[1];break}if(y[0]===6&&r.label<u[1]){r.label=u[1],u=y;break}if(u&&r.label<u[2]){r.label=u[2],r.ops.push(y);break}u[2]&&r.ops.pop(),r.trys.pop();continue}y=t.call(o,r)}catch(E){y=[6,E],a=0}finally{s=u=0}if(y[0]&5)throw y[1];return{value:y[0]?y[1]:void 0,done:!0}}}function C_(o,t,r,s){s===void 0&&(s=r),o[s]=t[r]}function N_(o,t){for(var r in o)r!=="default"&&!t.hasOwnProperty(r)&&(t[r]=o[r])}function Rc(o){var t=typeof Symbol=="function"&&Symbol.iterator,r=t&&o[t],s=0;if(r)return r.call(o);if(o&&typeof o.length=="number")return{next:function(){return o&&s>=o.length&&(o=void 0),{value:o&&o[s++],done:!o}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function bf(o,t){var r=typeof Symbol=="function"&&o[Symbol.iterator];if(!r)return o;var s=r.call(o),a,u=[],l;try{for(;(t===void 0||t-- >0)&&!(a=s.next()).done;)u.push(a.value)}catch(g){l={error:g}}finally{try{a&&!a.done&&(r=s.return)&&r.call(s)}finally{if(l)throw l.error}}return u}function $_(){for(var o=[],t=0;t<arguments.length;t++)o=o.concat(bf(arguments[t]));return o}function D_(){for(var o=0,t=0,r=arguments.length;t<r;t++)o+=arguments[t].length;for(var s=Array(o),a=0,t=0;t<r;t++)for(var u=arguments[t],l=0,g=u.length;l<g;l++,a++)s[a]=u[l];return s}function Ls(o){return this instanceof Ls?(this.v=o,this):new Ls(o)}function q_(o,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s=r.apply(o,t||[]),a,u=[];return a={},l("next"),l("throw"),l("return"),a[Symbol.asyncIterator]=function(){return this},a;function l(S){s[S]&&(a[S]=function(q){return new Promise(function(D,z){u.push([S,q,D,z])>1||g(S,q)})})}function g(S,q){try{w(s[S](q))}catch(D){P(u[0][3],D)}}function w(S){S.value instanceof Ls?Promise.resolve(S.value.v).then(y,E):P(u[0][2],S)}function y(S){g("next",S)}function E(S){g("throw",S)}function P(S,q){S(q),u.shift(),u.length&&g(u[0][0],u[0][1])}}function j_(o){var t,r;return t={},s("next"),s("throw",function(a){throw a}),s("return"),t[Symbol.iterator]=function(){return this},t;function s(a,u){t[a]=o[a]?function(l){return(r=!r)?{value:Ls(o[a](l)),done:a==="return"}:u?u(l):l}:u}}function U_(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=o[Symbol.asyncIterator],r;return t?t.call(o):(o=typeof Rc=="function"?Rc(o):o[Symbol.iterator](),r={},s("next"),s("throw"),s("return"),r[Symbol.asyncIterator]=function(){return this},r);function s(u){r[u]=o[u]&&function(l){return new Promise(function(g,w){l=o[u](l),a(g,w,l.done,l.value)})}}function a(u,l,g,w){Promise.resolve(w).then(function(y){u({value:y,done:g})},l)}}function M_(o,t){return Object.defineProperty?Object.defineProperty(o,"raw",{value:t}):o.raw=t,o}function L_(o){if(o&&o.__esModule)return o;var t={};if(o!=null)for(var r in o)Object.hasOwnProperty.call(o,r)&&(t[r]=o[r]);return t.default=o,t}function z_(o){return o&&o.__esModule?o:{default:o}}function H_(o,t){if(!t.has(o))throw new TypeError("attempted to get private field on non-instance");return t.get(o)}function k_(o,t,r){if(!t.has(o))throw new TypeError("attempted to set private field on non-instance");return t.set(o,r),r}const K_=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return Oc},__asyncDelegator:j_,__asyncGenerator:q_,__asyncValues:U_,__await:Ls,__awaiter:A_,__classPrivateFieldGet:H_,__classPrivateFieldSet:k_,__createBinding:C_,__decorate:O_,__exportStar:N_,__extends:P_,__generator:x_,__importDefault:z_,__importStar:L_,__makeTemplateObject:M_,__metadata:T_,__param:R_,__read:bf,__rest:S_,__spread:$_,__spreadArrays:D_,__values:Rc},Symbol.toStringTag,{value:"Module"})),Io=Lc(K_);var As={},uc={},xs={};const V_=Lc(Jw);var ol;function B_(){if(ol)return xs;ol=1,Object.defineProperty(xs,"__esModule",{value:!0}),xs.IHeartBeat=void 0;const o=V_;class t extends o.IEvents{constructor(s){super()}}return xs.IHeartBeat=t,xs}var al;function Ef(){return al||(al=1,function(o){Object.defineProperty(o,"__esModule",{value:!0}),Io.__exportStar(B_(),o)}(uc)),uc}var hc={},ui={},cl;function F_(){if(cl)return ui;cl=1,Object.defineProperty(ui,"__esModule",{value:!0}),ui.HEARTBEAT_EVENTS=ui.HEARTBEAT_INTERVAL=void 0;const o=k;return ui.HEARTBEAT_INTERVAL=o.FIVE_SECONDS,ui.HEARTBEAT_EVENTS={pulse:"heartbeat_pulse"},ui}var ul;function If(){return ul||(ul=1,function(o){Object.defineProperty(o,"__esModule",{value:!0}),Io.__exportStar(F_(),o)}(hc)),hc}var hl;function G_(){if(hl)return As;hl=1,Object.defineProperty(As,"__esModule",{value:!0}),As.HeartBeat=void 0;const o=Io,t=Ut,r=k,s=Ef(),a=If();class u extends s.IHeartBeat{constructor(g){super(g),this.events=new t.EventEmitter,this.interval=a.HEARTBEAT_INTERVAL,this.interval=(g==null?void 0:g.interval)||a.HEARTBEAT_INTERVAL}static init(g){return o.__awaiter(this,void 0,void 0,function*(){const w=new u(g);return yield w.init(),w})}init(){return o.__awaiter(this,void 0,void 0,function*(){yield this.initialize()})}stop(){clearInterval(this.intervalRef)}on(g,w){this.events.on(g,w)}once(g,w){this.events.once(g,w)}off(g,w){this.events.off(g,w)}removeListener(g,w){this.events.removeListener(g,w)}initialize(){return o.__awaiter(this,void 0,void 0,function*(){this.intervalRef=setInterval(()=>this.pulse(),r.toMiliseconds(this.interval))})}pulse(){this.events.emit(a.HEARTBEAT_EVENTS.pulse)}}return As.HeartBeat=u,As}(function(o){Object.defineProperty(o,"__esModule",{value:!0});const t=Io;t.__exportStar(G_(),o),t.__exportStar(Ef(),o),t.__exportStar(If(),o)})(Yi);class W_ extends fi{constructor(t){super(),this.opts=t,this.protocol="wc",this.version=2}}let Q_=class extends fi{constructor(t,r){super(),this.core=t,this.logger=r,this.records=new Map}},J_=class{constructor(t,r){this.logger=t,this.core=r}},Y_=class extends fi{constructor(t,r){super(),this.relayer=t,this.logger=r}},Z_=class extends fi{constructor(t){super()}},X_=class{constructor(t,r,s,a){this.core=t,this.logger=r,this.name=s}},eb=class extends fi{constructor(t,r){super(),this.relayer=t,this.logger=r}},tb=class extends fi{constructor(t,r){super(),this.core=t,this.logger=r}},rb=class{constructor(t,r){this.projectId=t,this.logger=r}},ib=class{constructor(t,r){this.projectId=t,this.logger=r}},sb=class{constructor(t){this.opts=t,this.protocol="wc",this.version=2}},nb=class{constructor(t){this.client=t}};const ob=":";function ab(o){const[t,r]=o.split(ob);return{namespace:t,reference:r}}function Pf(o,t){return o.includes(":")?[o]:t.chains||[]}const Sf="base10",nt="base16",Tc="base64pad",Vc="utf8",Of=0,pi=1,cb=0,ll=1,Ac=12,Bc=32;function ub(){const o=yf.generateKeyPair();return{privateKey:jt(o.secretKey,nt),publicKey:jt(o.publicKey,nt)}}function xc(){const o=vf.randomBytes(Bc);return jt(o,nt)}function hb(o,t){const r=yf.sharedKey(Gt(o,nt),Gt(t,nt),!0),s=new Lw(zc.SHA256,r).expand(Bc);return jt(s,nt)}function lb(o){const t=zc.hash(Gt(o,nt));return jt(t,nt)}function Wi(o){const t=zc.hash(Gt(o,Vc));return jt(t,nt)}function fb(o){return Gt(`${o}`,Sf)}function ks(o){return Number(jt(o,Sf))}function pb(o){const t=fb(typeof o.type<"u"?o.type:Of);if(ks(t)===pi&&typeof o.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const r=typeof o.senderPublicKey<"u"?Gt(o.senderPublicKey,nt):void 0,s=typeof o.iv<"u"?Gt(o.iv,nt):vf.randomBytes(Ac),a=new mf.ChaCha20Poly1305(Gt(o.symKey,nt)).seal(s,Gt(o.message,Vc));return gb({type:t,sealed:a,iv:s,senderPublicKey:r})}function db(o){const t=new mf.ChaCha20Poly1305(Gt(o.symKey,nt)),{sealed:r,iv:s}=po(o.encoded),a=t.open(s,r);if(a===null)throw new Error("Failed to decrypt");return jt(a,Vc)}function gb(o){if(ks(o.type)===pi){if(typeof o.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return jt(Xh([o.type,o.senderPublicKey,o.iv,o.sealed]),Tc)}return jt(Xh([o.type,o.iv,o.sealed]),Tc)}function po(o){const t=Gt(o,Tc),r=t.slice(cb,ll),s=ll;if(ks(r)===pi){const g=s+Bc,w=g+Ac,y=t.slice(s,g),E=t.slice(g,w),P=t.slice(w);return{type:r,sealed:P,iv:E,senderPublicKey:y}}const a=s+Ac,u=t.slice(s,a),l=t.slice(a);return{type:r,sealed:l,iv:u}}function yb(o,t){const r=po(o);return Rf({type:ks(r.type),senderPublicKey:typeof r.senderPublicKey<"u"?jt(r.senderPublicKey,nt):void 0,receiverPublicKey:t==null?void 0:t.receiverPublicKey})}function Rf(o){const t=(o==null?void 0:o.type)||Of;if(t===pi){if(typeof(o==null?void 0:o.senderPublicKey)>"u")throw new Error("missing sender public key");if(typeof(o==null?void 0:o.receiverPublicKey)>"u")throw new Error("missing receiver public key")}return{type:t,senderPublicKey:o==null?void 0:o.senderPublicKey,receiverPublicKey:o==null?void 0:o.receiverPublicKey}}function fl(o){return o.type===pi&&typeof o.senderPublicKey=="string"&&typeof o.receiverPublicKey=="string"}var vb=Object.defineProperty,pl=Object.getOwnPropertySymbols,mb=Object.prototype.hasOwnProperty,wb=Object.prototype.propertyIsEnumerable,dl=(o,t,r)=>t in o?vb(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,gl=(o,t)=>{for(var r in t||(t={}))mb.call(t,r)&&dl(o,r,t[r]);if(pl)for(var r of pl(t))wb.call(t,r)&&dl(o,r,t[r]);return o};const _b="ReactNative",Pt={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},bb="js";function Fc(){return typeof ac<"u"&&typeof ac.versions<"u"&&typeof ac.versions.node<"u"}function Zi(){return!gf()&&!!df()&&navigator.product===_b}function Xi(){return!Fc()&&!!df()&&!!gf()}function Ks(){return Zi()?Pt.reactNative:Fc()?Pt.node:Xi()?Pt.browser:Pt.unknown}function Eb(){var o;try{return Zi()&&typeof de<"u"&&typeof(de==null?void 0:de.Application)<"u"?(o=de.Application)==null?void 0:o.applicationId:void 0}catch{return}}function Ib(o,t){let r=fo.parse(o);return r=gl(gl({},r),t),o=fo.stringify(r),o}function Pb(){return Mw()||{name:"",description:"",url:"",icons:[""]}}function Sb(){if(Ks()===Pt.reactNative&&typeof de<"u"&&typeof(de==null?void 0:de.Platform)<"u"){const{OS:r,Version:s}=de.Platform;return[r,s].join("-")}const o=Hw();if(o===null)return"unknown";const t=o.os?o.os.replace(" ","").toLowerCase():"unknown";return o.type==="browser"?[t,o.name,o.version].join("-"):[t,o.version].join("-")}function Ob(){var o;const t=Ks();return t===Pt.browser?[t,((o=kw())==null?void 0:o.host)||"unknown"].join(":"):t}function Rb(o,t,r){const s=Sb(),a=Ob();return[[o,t].join("-"),[bb,r].join("-"),s,a].join("/")}function Tb({protocol:o,version:t,relayUrl:r,sdkVersion:s,auth:a,projectId:u,useOnCloseEvent:l,bundleId:g}){const w=r.split("?"),y=Rb(o,t,s),E={auth:a,ua:y,projectId:u,useOnCloseEvent:l,origin:g||void 0},P=Ib(w[1]||"",E);return w[0]+"?"+P}function hi(o,t){return o.filter(r=>t.includes(r)).length===o.length}function Tf(o){return Object.fromEntries(o.entries())}function Af(o){return new Map(Object.entries(o))}function Bi(o=k.FIVE_MINUTES,t){const r=k.toMiliseconds(o||k.FIVE_MINUTES);let s,a,u;return{resolve:l=>{u&&s&&(clearTimeout(u),s(l))},reject:l=>{u&&a&&(clearTimeout(u),a(l))},done:()=>new Promise((l,g)=>{u=setTimeout(()=>{g(new Error(t))},r),s=l,a=g})}}function zs(o,t,r){return new Promise(async(s,a)=>{const u=setTimeout(()=>a(new Error(r)),t);try{const l=await o;s(l)}catch(l){a(l)}clearTimeout(u)})}function xf(o,t){if(typeof t=="string"&&t.startsWith(`${o}:`))return t;if(o.toLowerCase()==="topic"){if(typeof t!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${t}`}else if(o.toLowerCase()==="id"){if(typeof t!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${t}`}throw new Error(`Unknown expirer target type: ${o}`)}function Ab(o){return xf("topic",o)}function xb(o){return xf("id",o)}function Cf(o){const[t,r]=o.split(":"),s={id:void 0,topic:void 0};if(t==="topic"&&typeof r=="string")s.topic=r;else if(t==="id"&&Number.isInteger(Number(r)))s.id=Number(r);else throw new Error(`Invalid target, expected id:number or topic:string, got ${t}:${r}`);return s}function Ft(o,t){return k.fromMiliseconds(Date.now()+k.toMiliseconds(o))}function qr(o){return Date.now()>=k.toMiliseconds(o)}function Ue(o,t){return`${o}${t?`:${t}`:""}`}function lc(o=[],t=[]){return[...new Set([...o,...t])]}async function Cb({id:o,topic:t,wcDeepLink:r}){try{if(!r)return;const s=typeof r=="string"?JSON.parse(r):r;let a=s==null?void 0:s.href;if(typeof a!="string")return;a.endsWith("/")&&(a=a.slice(0,-1));const u=`${a}/wc?requestId=${o}&sessionTopic=${t}`,l=Ks();l===Pt.browser?u.startsWith("https://")?window.open(u,"_blank","noreferrer noopener"):window.open(u,"_self","noreferrer noopener"):l===Pt.reactNative&&typeof(de==null?void 0:de.Linking)<"u"&&await de.Linking.openURL(u)}catch(s){console.error(s)}}async function Nb(o,t){try{return await o.getItem(t)||(Xi()?localStorage.getItem(t):void 0)}catch(r){console.error(r)}}const $b="irn";function Cc(o){return(o==null?void 0:o.relay)||{protocol:$b}}function ho(o){const t=zw[o];if(typeof t>"u")throw new Error(`Relay Protocol not supported: ${o}`);return t}var Db=Object.defineProperty,yl=Object.getOwnPropertySymbols,qb=Object.prototype.hasOwnProperty,jb=Object.prototype.propertyIsEnumerable,vl=(o,t,r)=>t in o?Db(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,Ub=(o,t)=>{for(var r in t||(t={}))qb.call(t,r)&&vl(o,r,t[r]);if(yl)for(var r of yl(t))jb.call(t,r)&&vl(o,r,t[r]);return o};function Mb(o,t="-"){const r={},s="relay"+t;return Object.keys(o).forEach(a=>{if(a.startsWith(s)){const u=a.replace(s,""),l=o[a];r[u]=l}}),r}function ml(o){o=o.includes("wc://")?o.replace("wc://",""):o,o=o.includes("wc:")?o.replace("wc:",""):o;const t=o.indexOf(":"),r=o.indexOf("?")!==-1?o.indexOf("?"):void 0,s=o.substring(0,t),a=o.substring(t+1,r).split("@"),u=typeof r<"u"?o.substring(r):"",l=fo.parse(u);return{protocol:s,topic:Lb(a[0]),version:parseInt(a[1],10),symKey:l.symKey,relay:Mb(l)}}function Lb(o){return o.startsWith("//")?o.substring(2):o}function zb(o,t="-"){const r="relay",s={};return Object.keys(o).forEach(a=>{const u=r+t+a;o[a]&&(s[u]=o[a])}),s}function Hb(o){return`${o.protocol}:${o.topic}@${o.version}?`+fo.stringify(Ub({symKey:o.symKey},zb(o.relay)))}function es(o){const t=[];return o.forEach(r=>{const[s,a]=r.split(":");t.push(`${s}:${a}`)}),t}function kb(o){const t=[];return Object.values(o).forEach(r=>{t.push(...es(r.accounts))}),t}function Kb(o,t){const r=[];return Object.values(o).forEach(s=>{es(s.accounts).includes(t)&&r.push(...s.methods)}),r}function Vb(o,t){const r=[];return Object.values(o).forEach(s=>{es(s.accounts).includes(t)&&r.push(...s.events)}),r}function Bb(o,t){const r=lo(o,t);if(r)throw new Error(r.message);const s={};for(const[a,u]of Object.entries(o))s[a]={methods:u.methods,events:u.events,chains:u.accounts.map(l=>`${l.split(":")[0]}:${l.split(":")[1]}`)};return s}function Gc(o){return o.includes(":")}function js(o){return Gc(o)?o.split(":")[0]:o}const Fb={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},Gb={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function j(o,t){const{message:r,code:s}=Gb[o];return{message:t?`${r} ${t}`:r,code:s}}function De(o,t){const{message:r,code:s}=Fb[o];return{message:t?`${r} ${t}`:r,code:s}}function li(o,t){return!!Array.isArray(o)}function Qi(o){return Object.getPrototypeOf(o)===Object.prototype&&Object.keys(o).length}function st(o){return typeof o>"u"}function Fe(o,t){return t&&st(o)?!0:typeof o=="string"&&!!o.trim().length}function Wc(o,t){return t&&st(o)?!0:typeof o=="number"&&!isNaN(o)}function Wb(o,t){const{requiredNamespaces:r}=t,s=Object.keys(o.namespaces),a=Object.keys(r);let u=!0;return hi(a,s)?(s.forEach(l=>{const{accounts:g,methods:w,events:y}=o.namespaces[l],E=es(g),P=r[l];(!hi(Pf(l,P),E)||!hi(P.methods,w)||!hi(P.events,y))&&(u=!1)}),u):!1}function go(o){return Fe(o,!1)&&o.includes(":")?o.split(":").length===2:!1}function Qb(o){if(Fe(o,!1)&&o.includes(":")){const t=o.split(":");if(t.length===3){const r=t[0]+":"+t[1];return!!t[2]&&go(r)}}return!1}function Jb(o){if(Fe(o,!1))try{return typeof new URL(o)<"u"}catch{return!1}return!1}function Yb(o){var t;return(t=o==null?void 0:o.proposer)==null?void 0:t.publicKey}function Zb(o){return o==null?void 0:o.topic}function Xb(o,t){let r=null;return Fe(o==null?void 0:o.publicKey,!1)||(r=j("MISSING_OR_INVALID",`${t} controller public key should be a string`)),r}function wl(o){let t=!0;return li(o)?o.length&&(t=o.every(r=>Fe(r,!1))):t=!1,t}function e0(o,t,r){let s=null;return li(t)&&t.length?t.forEach(a=>{s||go(a)||(s=De("UNSUPPORTED_CHAINS",`${r}, chain ${a} should be a string and conform to "namespace:chainId" format`))}):go(o)||(s=De("UNSUPPORTED_CHAINS",`${r}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),s}function t0(o,t,r){let s=null;return Object.entries(o).forEach(([a,u])=>{if(s)return;const l=e0(a,Pf(a,u),`${t} ${r}`);l&&(s=l)}),s}function r0(o,t){let r=null;return li(o)?o.forEach(s=>{r||Qb(s)||(r=De("UNSUPPORTED_ACCOUNTS",`${t}, account ${s} should be a string and conform to "namespace:chainId:address" format`))}):r=De("UNSUPPORTED_ACCOUNTS",`${t}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),r}function i0(o,t){let r=null;return Object.values(o).forEach(s=>{if(r)return;const a=r0(s==null?void 0:s.accounts,`${t} namespace`);a&&(r=a)}),r}function s0(o,t){let r=null;return wl(o==null?void 0:o.methods)?wl(o==null?void 0:o.events)||(r=De("UNSUPPORTED_EVENTS",`${t}, events should be an array of strings or empty array for no events`)):r=De("UNSUPPORTED_METHODS",`${t}, methods should be an array of strings or empty array for no methods`),r}function Nf(o,t){let r=null;return Object.values(o).forEach(s=>{if(r)return;const a=s0(s,`${t}, namespace`);a&&(r=a)}),r}function n0(o,t,r){let s=null;if(o&&Qi(o)){const a=Nf(o,t);a&&(s=a);const u=t0(o,t,r);u&&(s=u)}else s=j("MISSING_OR_INVALID",`${t}, ${r} should be an object with data`);return s}function lo(o,t){let r=null;if(o&&Qi(o)){const s=Nf(o,t);s&&(r=s);const a=i0(o,t);a&&(r=a)}else r=j("MISSING_OR_INVALID",`${t}, namespaces should be an object with data`);return r}function $f(o){return Fe(o.protocol,!0)}function o0(o,t){let r=!1;return o?o&&li(o)&&o.length&&o.forEach(s=>{r=$f(s)}):r=!0,r}function a0(o){return typeof o=="number"}function gt(o){return typeof o<"u"&&typeof o!==null}function c0(o){return!(!o||typeof o!="object"||!o.code||!Wc(o.code,!1)||!o.message||!Fe(o.message,!1))}function u0(o){return!(st(o)||!Fe(o.method,!1))}function h0(o){return!(st(o)||st(o.result)&&st(o.error)||!Wc(o.id,!1)||!Fe(o.jsonrpc,!1))}function l0(o){return!(st(o)||!Fe(o.name,!1))}function _l(o,t){return!(!go(t)||!kb(o).includes(t))}function f0(o,t,r){return Fe(r,!1)?Kb(o,t).includes(r):!1}function p0(o,t,r){return Fe(r,!1)?Vb(o,t).includes(r):!1}function bl(o,t,r){let s=null;const a=d0(o),u=g0(t),l=Object.keys(a),g=Object.keys(u),w=El(Object.keys(o)),y=El(Object.keys(t)),E=w.filter(P=>!y.includes(P));return E.length&&(s=j("NON_CONFORMING_NAMESPACES",`${r} namespaces keys don't satisfy requiredNamespaces.
      Required: ${E.toString()}
      Received: ${Object.keys(t).toString()}`)),hi(l,g)||(s=j("NON_CONFORMING_NAMESPACES",`${r} namespaces chains don't satisfy required namespaces.
      Required: ${l.toString()}
      Approved: ${g.toString()}`)),Object.keys(t).forEach(P=>{if(!P.includes(":")||s)return;const S=es(t[P].accounts);S.includes(P)||(s=j("NON_CONFORMING_NAMESPACES",`${r} namespaces accounts don't satisfy namespace accounts for ${P}
        Required: ${P}
        Approved: ${S.toString()}`))}),l.forEach(P=>{s||(hi(a[P].methods,u[P].methods)?hi(a[P].events,u[P].events)||(s=j("NON_CONFORMING_NAMESPACES",`${r} namespaces events don't satisfy namespace events for ${P}`)):s=j("NON_CONFORMING_NAMESPACES",`${r} namespaces methods don't satisfy namespace methods for ${P}`))}),s}function d0(o){const t={};return Object.keys(o).forEach(r=>{var s;r.includes(":")?t[r]=o[r]:(s=o[r].chains)==null||s.forEach(a=>{t[a]={methods:o[r].methods,events:o[r].events}})}),t}function El(o){return[...new Set(o.map(t=>t.includes(":")?t.split(":")[0]:t))]}function g0(o){const t={};return Object.keys(o).forEach(r=>{if(r.includes(":"))t[r]=o[r];else{const s=es(o[r].accounts);s==null||s.forEach(a=>{t[a]={accounts:o[r].accounts.filter(u=>u.includes(`${a}:`)),methods:o[r].methods,events:o[r].events}})}}),t}function y0(o,t){return Wc(o,!1)&&o<=t.max&&o>=t.min}function Il(){const o=Ks();return new Promise(t=>{switch(o){case Pt.browser:t(v0());break;case Pt.reactNative:t(m0());break;case Pt.node:t(w0());break;default:t(!0)}})}function v0(){return Xi()&&(navigator==null?void 0:navigator.onLine)}async function m0(){if(Zi()&&typeof de<"u"&&de!=null&&de.NetInfo){const o=await(de==null?void 0:de.NetInfo.fetch());return o==null?void 0:o.isConnected}return!0}function w0(){return!0}function _0(o){switch(Ks()){case Pt.browser:b0(o);break;case Pt.reactNative:E0(o);break}}function b0(o){!Zi()&&Xi()&&(window.addEventListener("online",()=>o(!0)),window.addEventListener("offline",()=>o(!1)))}function E0(o){var t;Zi()&&typeof de<"u"&&de!=null&&de.NetInfo&&((t=de)==null||t.NetInfo.addEventListener(r=>o(r==null?void 0:r.isConnected)))}const fc={};let so=class{static get(t){return fc[t]}static set(t,r){fc[t]=r}static delete(t){delete fc[t]}};class mr extends Kw{constructor(t){super(t),this.events=new Ut.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(t),this.connection.connected&&this.registerEventListeners()}async connect(t=this.connection){await this.open(t)}async disconnect(){await this.close()}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async request(t,r){return this.requestStrict(Gi(t.method,t.params||[],t.id||wf().toString()),r)}async requestStrict(t,r){return new Promise(async(s,a)=>{if(!this.connection.connected)try{await this.open()}catch(u){a(u)}this.events.on(`${t.id}`,u=>{rr(u)?a(u.error):s(u.result)});try{await this.connection.send(t,r)}catch(u){a(u)}})}setConnection(t=this.connection){return t}onPayload(t){this.events.emit("payload",t),mo(t)?this.events.emit(`${t.id}`,t):this.events.emit("message",{type:t.method,data:t.params})}onClose(t){t&&t.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${t.code} ${t.reason?`(${t.reason})`:""}`)),this.events.emit("disconnect")}async open(t=this.connection){this.connection===t&&this.connection.connected||(this.connection.connected&&this.close(),typeof t=="string"&&(await this.connection.open(t),t=this.connection),this.connection=this.setConnection(t),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",t=>this.onPayload(t)),this.connection.on("close",t=>this.onClose(t)),this.connection.on("error",t=>this.events.emit("error",t)),this.connection.on("register_error",t=>this.onClose()),this.hasRegisteredEventListeners=!0)}}var pc,Pl;function I0(){return Pl||(Pl=1,pc=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}),pc}const P0=()=>typeof WebSocket<"u"?WebSocket:typeof de<"u"&&typeof de.WebSocket<"u"?de.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:I0(),S0=()=>typeof WebSocket<"u"||typeof de<"u"&&typeof de.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",Sl=o=>o.split("?")[0],Ol=10,O0=P0();let R0=class{constructor(t){if(this.url=t,this.events=new Ut.EventEmitter,this.registering=!1,!el(t))throw new Error(`Provided URL is not compatible with WebSocket connection: ${t}`);this.url=t}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async open(t=this.url){await this.register(t)}async close(){return new Promise((t,r)=>{if(typeof this.socket>"u"){r(new Error("Connection already closed"));return}this.socket.onclose=s=>{this.onClose(s),t()},this.socket.close()})}async send(t){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(Ji(t))}catch(r){this.onError(t.id,r)}}register(t=this.url){if(!el(t))throw new Error(`Provided URL is not compatible with WebSocket connection: ${t}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((s,a)=>{this.events.once("register_error",u=>{this.resetMaxListeners(),a(u)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return a(new Error("WebSocket connection is missing or invalid"));s(this.socket)})})}return this.url=t,this.registering=!0,new Promise((r,s)=>{const a=new URLSearchParams(t).get("origin"),u=Vw.isReactNative()?{headers:{origin:a}}:{rejectUnauthorized:!Bw(t)},l=new O0(t,[],u);S0()?l.onerror=g=>{const w=g;s(this.emitError(w.error))}:l.on("error",g=>{s(this.emitError(g))}),l.onopen=()=>{this.onOpen(l),r(l)}})}onOpen(t){t.onmessage=r=>this.onPayload(r),t.onclose=r=>this.onClose(r),this.socket=t,this.registering=!1,this.events.emit("open")}onClose(t){this.socket=void 0,this.registering=!1,this.events.emit("close",t)}onPayload(t){if(typeof t.data>"u")return;const r=typeof t.data=="string"?Hs(t.data):t.data;this.events.emit("payload",r)}onError(t,r){const s=this.parseError(r),a=s.message||s.toString(),u=wo(t,a);this.events.emit("payload",u)}parseError(t,r=this.url){return _f(t,Sl(r),"WS")}resetMaxListeners(){this.events.getMaxListeners()>Ol&&this.events.setMaxListeners(Ol)}emitError(t){const r=this.parseError(new Error((t==null?void 0:t.message)||`WebSocket connection failed for host: ${Sl(this.url)}`));return this.events.emit("register_error",r),r}};var yo={exports:{}};yo.exports;(function(o,t){var r=200,s="__lodash_hash_undefined__",a=1,u=2,l=9007199254740991,g="[object Arguments]",w="[object Array]",y="[object AsyncFunction]",E="[object Boolean]",P="[object Date]",S="[object Error]",q="[object Function]",D="[object GeneratorFunction]",z="[object Map]",ne="[object Number]",Z="[object Null]",ge="[object Object]",te="[object Promise]",ie="[object Proxy]",he="[object RegExp]",Te="[object Set]",Ee="[object String]",Me="[object Symbol]",Le="[object Undefined]",zr="[object WeakMap]",gi="[object ArrayBuffer]",ke="[object DataView]",ts="[object Float32Array]",_r="[object Float64Array]",O="[object Int8Array]",$="[object Int16Array]",F="[object Int32Array]",oe="[object Uint8Array]",ve="[object Uint8ClampedArray]",J="[object Uint16Array]",Ge="[object Uint32Array]",Hr=/[\\^$.*+?()[\]{}|]/g,yi=/^\[object .+?Constructor\]$/,xe=/^(?:0|[1-9]\d*)$/,X={};X[ts]=X[_r]=X[O]=X[$]=X[F]=X[oe]=X[ve]=X[J]=X[Ge]=!0,X[g]=X[w]=X[gi]=X[E]=X[ke]=X[P]=X[S]=X[q]=X[z]=X[ne]=X[ge]=X[he]=X[Te]=X[Ee]=X[zr]=!1;var kr=typeof jr=="object"&&jr&&jr.Object===Object&&jr,Oo=typeof self=="object"&&self&&self.Object===Object&&self,Xe=kr||Oo||Function("return this")(),br=t&&!t.nodeType&&t,Bs=br&&!0&&o&&!o.nodeType&&o,Kr=Bs&&Bs.exports===br,Er=Kr&&kr.process,rs=function(){try{return Er&&Er.binding&&Er.binding("util")}catch{}}(),ot=rs&&rs.isTypedArray;function Vr(d,_){for(var C=-1,M=d==null?0:d.length,we=0,W=[];++C<M;){var Ie=d[C];_(Ie,C,d)&&(W[we++]=Ie)}return W}function Ro(d,_){for(var C=-1,M=_.length,we=d.length;++C<M;)d[we+C]=_[C];return d}function Mt(d,_){for(var C=-1,M=d==null?0:d.length;++C<M;)if(_(d[C],C,d))return!0;return!1}function Fs(d,_){for(var C=-1,M=Array(d);++C<d;)M[C]=_(C);return M}function To(d){return function(_){return d(_)}}function Br(d,_){return d.has(_)}function vt(d,_){return d==null?void 0:d[_]}function Fr(d){var _=-1,C=Array(d.size);return d.forEach(function(M,we){C[++_]=[we,M]}),C}function vi(d,_){return function(C){return d(_(C))}}function Ao(d){var _=-1,C=Array(d.size);return d.forEach(function(M){C[++_]=M}),C}var Gr=Array.prototype,xo=Function.prototype,Wt=Object.prototype,Qt=Xe["__core-js_shared__"],mi=xo.toString,at=Wt.hasOwnProperty,wi=function(){var d=/[^.]+$/.exec(Qt&&Qt.keys&&Qt.keys.IE_PROTO||"");return d?"Symbol(src)_1."+d:""}(),_i=Wt.toString,is=RegExp("^"+mi.call(at).replace(Hr,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),bi=Kr?Xe.Buffer:void 0,Ir=Xe.Symbol,Ei=Xe.Uint8Array,Ii=Wt.propertyIsEnumerable,Co=Gr.splice,ir=Ir?Ir.toStringTag:void 0,Gs=Object.getOwnPropertySymbols,Ws=bi?bi.isBuffer:void 0,Qs=vi(Object.keys,Object),ss=mt(Xe,"DataView"),Wr=mt(Xe,"Map"),ns=mt(Xe,"Promise"),os=mt(Xe,"Set"),Pi=mt(Xe,"WeakMap"),Qr=mt(Object,"create"),No=or(ss),$o=or(Wr),as=or(ns),Do=or(os),cs=or(Pi),Js=Ir?Ir.prototype:void 0,us=Js?Js.valueOf:void 0;function sr(d){var _=-1,C=d==null?0:d.length;for(this.clear();++_<C;){var M=d[_];this.set(M[0],M[1])}}function qo(){this.__data__=Qr?Qr(null):{},this.size=0}function jo(d){var _=this.has(d)&&delete this.__data__[d];return this.size-=_?1:0,_}function Uo(d){var _=this.__data__;if(Qr){var C=_[d];return C===s?void 0:C}return at.call(_,d)?_[d]:void 0}function Mo(d){var _=this.__data__;return Qr?_[d]!==void 0:at.call(_,d)}function Lo(d,_){var C=this.__data__;return this.size+=this.has(d)?0:1,C[d]=Qr&&_===void 0?s:_,this}sr.prototype.clear=qo,sr.prototype.delete=jo,sr.prototype.get=Uo,sr.prototype.has=Mo,sr.prototype.set=Lo;function Ot(d){var _=-1,C=d==null?0:d.length;for(this.clear();++_<C;){var M=d[_];this.set(M[0],M[1])}}function zo(){this.__data__=[],this.size=0}function Ho(d){var _=this.__data__,C=Jr(_,d);if(C<0)return!1;var M=_.length-1;return C==M?_.pop():Co.call(_,C,1),--this.size,!0}function ko(d){var _=this.__data__,C=Jr(_,d);return C<0?void 0:_[C][1]}function Ko(d){return Jr(this.__data__,d)>-1}function Vo(d,_){var C=this.__data__,M=Jr(C,d);return M<0?(++this.size,C.push([d,_])):C[M][1]=_,this}Ot.prototype.clear=zo,Ot.prototype.delete=Ho,Ot.prototype.get=ko,Ot.prototype.has=Ko,Ot.prototype.set=Vo;function nr(d){var _=-1,C=d==null?0:d.length;for(this.clear();++_<C;){var M=d[_];this.set(M[0],M[1])}}function Si(){this.size=0,this.__data__={hash:new sr,map:new(Wr||Ot),string:new sr}}function Bo(d){var _=Pr(this,d).delete(d);return this.size-=_?1:0,_}function Oi(d){return Pr(this,d).get(d)}function Fo(d){return Pr(this,d).has(d)}function Go(d,_){var C=Pr(this,d),M=C.size;return C.set(d,_),this.size+=C.size==M?0:1,this}nr.prototype.clear=Si,nr.prototype.delete=Bo,nr.prototype.get=Oi,nr.prototype.has=Fo,nr.prototype.set=Go;function Ri(d){var _=-1,C=d==null?0:d.length;for(this.__data__=new nr;++_<C;)this.add(d[_])}function Ys(d){return this.__data__.set(d,s),this}function Zs(d){return this.__data__.has(d)}Ri.prototype.add=Ri.prototype.push=Ys,Ri.prototype.has=Zs;function Lt(d){var _=this.__data__=new Ot(d);this.size=_.size}function Wo(){this.__data__=new Ot,this.size=0}function Qo(d){var _=this.__data__,C=_.delete(d);return this.size=_.size,C}function Jo(d){return this.__data__.get(d)}function Yo(d){return this.__data__.has(d)}function Xs(d,_){var C=this.__data__;if(C instanceof Ot){var M=C.__data__;if(!Wr||M.length<r-1)return M.push([d,_]),this.size=++C.size,this;C=this.__data__=new nr(M)}return C.set(d,_),this.size=C.size,this}Lt.prototype.clear=Wo,Lt.prototype.delete=Qo,Lt.prototype.get=Jo,Lt.prototype.has=Yo,Lt.prototype.set=Xs;function en(d,_){var C=xi(d),M=!C&&pn(d),we=!C&&!M&&fs(d),W=!C&&!M&&!we&&yn(d),Ie=C||M||we||W,qe=Ie?Fs(d.length,String):[],ce=qe.length;for(var _e in d)at.call(d,_e)&&!(Ie&&(_e=="length"||we&&(_e=="offset"||_e=="parent")||W&&(_e=="buffer"||_e=="byteLength"||_e=="byteOffset")||cn(_e,ce)))&&qe.push(_e);return qe}function Jr(d,_){for(var C=d.length;C--;)if(fn(d[C][0],_))return C;return-1}function hs(d,_,C){var M=_(d);return xi(d)?M:Ro(M,C(d))}function Yr(d){return d==null?d===void 0?Le:Z:ir&&ir in Object(d)?on(d):ea(d)}function ls(d){return Xr(d)&&Yr(d)==g}function Zr(d,_,C,M,we){return d===_?!0:d==null||_==null||!Xr(d)&&!Xr(_)?d!==d&&_!==_:tn(d,_,C,M,Zr,we)}function tn(d,_,C,M,we,W){var Ie=xi(d),qe=xi(_),ce=Ie?w:Jt(d),_e=qe?w:Jt(_);ce=ce==g?ge:ce,_e=_e==g?ge:_e;var Ce=ce==ge,ct=_e==ge,je=ce==_e;if(je&&fs(d)){if(!fs(_))return!1;Ie=!0,Ce=!1}if(je&&!Ce)return W||(W=new Lt),Ie||yn(d)?Ti(d,_,C,M,we,W):Xo(d,_,ce,C,M,we,W);if(!(C&a)){var Pe=Ce&&at.call(d,"__wrapped__"),et=ct&&at.call(_,"__wrapped__");if(Pe||et){var zt=Pe?d.value():d,Rt=et?_.value():_;return W||(W=new Lt),we(zt,Rt,C,M,W)}}return je?(W||(W=new Lt),nn(d,_,C,M,we,W)):!1}function Zo(d){if(!gn(d)||hn(d))return!1;var _=Ci(d)?is:yi;return _.test(or(d))}function rn(d){return Xr(d)&&dn(d.length)&&!!X[Yr(d)]}function sn(d){if(!ln(d))return Qs(d);var _=[];for(var C in Object(d))at.call(d,C)&&C!="constructor"&&_.push(C);return _}function Ti(d,_,C,M,we,W){var Ie=C&a,qe=d.length,ce=_.length;if(qe!=ce&&!(Ie&&ce>qe))return!1;var _e=W.get(d);if(_e&&W.get(_))return _e==_;var Ce=-1,ct=!0,je=C&u?new Ri:void 0;for(W.set(d,_),W.set(_,d);++Ce<qe;){var Pe=d[Ce],et=_[Ce];if(M)var zt=Ie?M(et,Pe,Ce,_,d,W):M(Pe,et,Ce,d,_,W);if(zt!==void 0){if(zt)continue;ct=!1;break}if(je){if(!Mt(_,function(Rt,Yt){if(!Br(je,Yt)&&(Pe===Rt||we(Pe,Rt,C,M,W)))return je.push(Yt)})){ct=!1;break}}else if(!(Pe===et||we(Pe,et,C,M,W))){ct=!1;break}}return W.delete(d),W.delete(_),ct}function Xo(d,_,C,M,we,W,Ie){switch(C){case ke:if(d.byteLength!=_.byteLength||d.byteOffset!=_.byteOffset)return!1;d=d.buffer,_=_.buffer;case gi:return!(d.byteLength!=_.byteLength||!W(new Ei(d),new Ei(_)));case E:case P:case ne:return fn(+d,+_);case S:return d.name==_.name&&d.message==_.message;case he:case Ee:return d==_+"";case z:var qe=Fr;case Te:var ce=M&a;if(qe||(qe=Ao),d.size!=_.size&&!ce)return!1;var _e=Ie.get(d);if(_e)return _e==_;M|=u,Ie.set(d,_);var Ce=Ti(qe(d),qe(_),M,we,W,Ie);return Ie.delete(d),Ce;case Me:if(us)return us.call(d)==us.call(_)}return!1}function nn(d,_,C,M,we,W){var Ie=C&a,qe=Ai(d),ce=qe.length,_e=Ai(_),Ce=_e.length;if(ce!=Ce&&!Ie)return!1;for(var ct=ce;ct--;){var je=qe[ct];if(!(Ie?je in _:at.call(_,je)))return!1}var Pe=W.get(d);if(Pe&&W.get(_))return Pe==_;var et=!0;W.set(d,_),W.set(_,d);for(var zt=Ie;++ct<ce;){je=qe[ct];var Rt=d[je],Yt=_[je];if(M)var ps=Ie?M(Yt,Rt,je,_,d,W):M(Rt,Yt,je,d,_,W);if(!(ps===void 0?Rt===Yt||we(Rt,Yt,C,M,W):ps)){et=!1;break}zt||(zt=je=="constructor")}if(et&&!zt){var ei=d.constructor,Ke=_.constructor;ei!=Ke&&"constructor"in d&&"constructor"in _&&!(typeof ei=="function"&&ei instanceof ei&&typeof Ke=="function"&&Ke instanceof Ke)&&(et=!1)}return W.delete(d),W.delete(_),et}function Ai(d){return hs(d,ia,an)}function Pr(d,_){var C=d.__data__;return un(_)?C[typeof _=="string"?"string":"hash"]:C.map}function mt(d,_){var C=vt(d,_);return Zo(C)?C:void 0}function on(d){var _=at.call(d,ir),C=d[ir];try{d[ir]=void 0;var M=!0}catch{}var we=_i.call(d);return M&&(_?d[ir]=C:delete d[ir]),we}var an=Gs?function(d){return d==null?[]:(d=Object(d),Vr(Gs(d),function(_){return Ii.call(d,_)}))}:me,Jt=Yr;(ss&&Jt(new ss(new ArrayBuffer(1)))!=ke||Wr&&Jt(new Wr)!=z||ns&&Jt(ns.resolve())!=te||os&&Jt(new os)!=Te||Pi&&Jt(new Pi)!=zr)&&(Jt=function(d){var _=Yr(d),C=_==ge?d.constructor:void 0,M=C?or(C):"";if(M)switch(M){case No:return ke;case $o:return z;case as:return te;case Do:return Te;case cs:return zr}return _});function cn(d,_){return _=_??l,!!_&&(typeof d=="number"||xe.test(d))&&d>-1&&d%1==0&&d<_}function un(d){var _=typeof d;return _=="string"||_=="number"||_=="symbol"||_=="boolean"?d!=="__proto__":d===null}function hn(d){return!!wi&&wi in d}function ln(d){var _=d&&d.constructor,C=typeof _=="function"&&_.prototype||Wt;return d===C}function ea(d){return _i.call(d)}function or(d){if(d!=null){try{return mi.call(d)}catch{}try{return d+""}catch{}}return""}function fn(d,_){return d===_||d!==d&&_!==_}var pn=ls(function(){return arguments}())?ls:function(d){return Xr(d)&&at.call(d,"callee")&&!Ii.call(d,"callee")},xi=Array.isArray;function ta(d){return d!=null&&dn(d.length)&&!Ci(d)}var fs=Ws||ye;function ra(d,_){return Zr(d,_)}function Ci(d){if(!gn(d))return!1;var _=Yr(d);return _==q||_==D||_==y||_==ie}function dn(d){return typeof d=="number"&&d>-1&&d%1==0&&d<=l}function gn(d){var _=typeof d;return d!=null&&(_=="object"||_=="function")}function Xr(d){return d!=null&&typeof d=="object"}var yn=ot?To(ot):rn;function ia(d){return ta(d)?en(d):sn(d)}function me(){return[]}function ye(){return!1}o.exports=ra})(yo,yo.exports);var T0=yo.exports;const A0=Hc(T0);function x0(o,t){return t=t||{},new Promise(function(r,s){var a=new XMLHttpRequest,u=[],l=[],g={},w=function(){return{ok:(a.status/100|0)==2,statusText:a.statusText,status:a.status,url:a.responseURL,text:function(){return Promise.resolve(a.responseText)},json:function(){return Promise.resolve(a.responseText).then(JSON.parse)},blob:function(){return Promise.resolve(new Blob([a.response]))},clone:w,headers:{keys:function(){return u},entries:function(){return l},get:function(E){return g[E.toLowerCase()]},has:function(E){return E.toLowerCase()in g}}}};for(var y in a.open(t.method||"get",o,!0),a.onload=function(){a.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,function(E,P,S){u.push(P=P.toLowerCase()),l.push([P,S]),g[P]=g[P]?g[P]+","+S:S}),r(w())},a.onerror=s,a.withCredentials=t.credentials=="include",t.headers)a.setRequestHeader(y,t.headers[y]);a.send(t.body||null)})}const C0=Object.freeze(Object.defineProperty({__proto__:null,default:x0},Symbol.toStringTag,{value:"Module"})),Rl=Lc(C0);var N0=self.fetch||(self.fetch=Rl.default||Rl);const $0=Hc(N0);var D0={};function q0(o,t){if(o.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),s=0;s<r.length;s++)r[s]=255;for(var a=0;a<o.length;a++){var u=o.charAt(a),l=u.charCodeAt(0);if(r[l]!==255)throw new TypeError(u+" is ambiguous");r[l]=a}var g=o.length,w=o.charAt(0),y=Math.log(g)/Math.log(256),E=Math.log(256)/Math.log(g);function P(D){if(D instanceof Uint8Array||(ArrayBuffer.isView(D)?D=new Uint8Array(D.buffer,D.byteOffset,D.byteLength):Array.isArray(D)&&(D=Uint8Array.from(D))),!(D instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(D.length===0)return"";for(var z=0,ne=0,Z=0,ge=D.length;Z!==ge&&D[Z]===0;)Z++,z++;for(var te=(ge-Z)*E+1>>>0,ie=new Uint8Array(te);Z!==ge;){for(var he=D[Z],Te=0,Ee=te-1;(he!==0||Te<ne)&&Ee!==-1;Ee--,Te++)he+=256*ie[Ee]>>>0,ie[Ee]=he%g>>>0,he=he/g>>>0;if(he!==0)throw new Error("Non-zero carry");ne=Te,Z++}for(var Me=te-ne;Me!==te&&ie[Me]===0;)Me++;for(var Le=w.repeat(z);Me<te;++Me)Le+=o.charAt(ie[Me]);return Le}function S(D){if(typeof D!="string")throw new TypeError("Expected String");if(D.length===0)return new Uint8Array;var z=0;if(D[z]!==" "){for(var ne=0,Z=0;D[z]===w;)ne++,z++;for(var ge=(D.length-z)*y+1>>>0,te=new Uint8Array(ge);D[z];){var ie=r[D.charCodeAt(z)];if(ie===255)return;for(var he=0,Te=ge-1;(ie!==0||he<Z)&&Te!==-1;Te--,he++)ie+=g*te[Te]>>>0,te[Te]=ie%256>>>0,ie=ie/256>>>0;if(ie!==0)throw new Error("Non-zero carry");Z=he,z++}if(D[z]!==" "){for(var Ee=ge-Z;Ee!==ge&&te[Ee]===0;)Ee++;for(var Me=new Uint8Array(ne+(ge-Ee)),Le=ne;Ee!==ge;)Me[Le++]=te[Ee++];return Me}}}function q(D){var z=S(D);if(z)return z;throw new Error(`Non-${t} character`)}return{encode:P,decodeUnsafe:S,decode:q}}var j0=q0,U0=j0;const Df=o=>{if(o instanceof Uint8Array&&o.constructor.name==="Uint8Array")return o;if(o instanceof ArrayBuffer)return new Uint8Array(o);if(ArrayBuffer.isView(o))return new Uint8Array(o.buffer,o.byteOffset,o.byteLength);throw new Error("Unknown type, must be binary type")},M0=o=>new TextEncoder().encode(o),L0=o=>new TextDecoder().decode(o);class z0{constructor(t,r,s){this.name=t,this.prefix=r,this.baseEncode=s}encode(t){if(t instanceof Uint8Array)return`${this.prefix}${this.baseEncode(t)}`;throw Error("Unknown type, must be binary type")}}class H0{constructor(t,r,s){if(this.name=t,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=s}decode(t){if(typeof t=="string"){if(t.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(t)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(t.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(t){return qf(this,t)}}class k0{constructor(t){this.decoders=t}or(t){return qf(this,t)}decode(t){const r=t[0],s=this.decoders[r];if(s)return s.decode(t);throw RangeError(`Unable to decode multibase string ${JSON.stringify(t)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const qf=(o,t)=>new k0({...o.decoders||{[o.prefix]:o},...t.decoders||{[t.prefix]:t}});class K0{constructor(t,r,s,a){this.name=t,this.prefix=r,this.baseEncode=s,this.baseDecode=a,this.encoder=new z0(t,r,s),this.decoder=new H0(t,r,a)}encode(t){return this.encoder.encode(t)}decode(t){return this.decoder.decode(t)}}const Po=({name:o,prefix:t,encode:r,decode:s})=>new K0(o,t,r,s),Vs=({prefix:o,name:t,alphabet:r})=>{const{encode:s,decode:a}=U0(r,t);return Po({prefix:o,name:t,encode:s,decode:u=>Df(a(u))})},V0=(o,t,r,s)=>{const a={};for(let E=0;E<t.length;++E)a[t[E]]=E;let u=o.length;for(;o[u-1]==="=";)--u;const l=new Uint8Array(u*r/8|0);let g=0,w=0,y=0;for(let E=0;E<u;++E){const P=a[o[E]];if(P===void 0)throw new SyntaxError(`Non-${s} character`);w=w<<r|P,g+=r,g>=8&&(g-=8,l[y++]=255&w>>g)}if(g>=r||255&w<<8-g)throw new SyntaxError("Unexpected end of data");return l},B0=(o,t,r)=>{const s=t[t.length-1]==="=",a=(1<<r)-1;let u="",l=0,g=0;for(let w=0;w<o.length;++w)for(g=g<<8|o[w],l+=8;l>r;)l-=r,u+=t[a&g>>l];if(l&&(u+=t[a&g<<r-l]),s)for(;u.length*r&7;)u+="=";return u},Qe=({name:o,prefix:t,bitsPerChar:r,alphabet:s})=>Po({prefix:t,name:o,encode(a){return B0(a,s,r)},decode(a){return V0(a,s,r,o)}}),F0=Po({prefix:"\0",name:"identity",encode:o=>L0(o),decode:o=>M0(o)});var G0=Object.freeze({__proto__:null,identity:F0});const W0=Qe({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var Q0=Object.freeze({__proto__:null,base2:W0});const J0=Qe({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Y0=Object.freeze({__proto__:null,base8:J0});const Z0=Vs({prefix:"9",name:"base10",alphabet:"0123456789"});var X0=Object.freeze({__proto__:null,base10:Z0});const eE=Qe({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),tE=Qe({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var rE=Object.freeze({__proto__:null,base16:eE,base16upper:tE});const iE=Qe({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),sE=Qe({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),nE=Qe({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),oE=Qe({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),aE=Qe({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),cE=Qe({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),uE=Qe({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),hE=Qe({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),lE=Qe({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var fE=Object.freeze({__proto__:null,base32:iE,base32upper:sE,base32pad:nE,base32padupper:oE,base32hex:aE,base32hexupper:cE,base32hexpad:uE,base32hexpadupper:hE,base32z:lE});const pE=Vs({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),dE=Vs({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var gE=Object.freeze({__proto__:null,base36:pE,base36upper:dE});const yE=Vs({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),vE=Vs({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var mE=Object.freeze({__proto__:null,base58btc:yE,base58flickr:vE});const wE=Qe({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),_E=Qe({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),bE=Qe({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),EE=Qe({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var IE=Object.freeze({__proto__:null,base64:wE,base64pad:_E,base64url:bE,base64urlpad:EE});const jf=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),PE=jf.reduce((o,t,r)=>(o[r]=t,o),[]),SE=jf.reduce((o,t,r)=>(o[t.codePointAt(0)]=r,o),[]);function OE(o){return o.reduce((t,r)=>(t+=PE[r],t),"")}function RE(o){const t=[];for(const r of o){const s=SE[r.codePointAt(0)];if(s===void 0)throw new Error(`Non-base256emoji character: ${r}`);t.push(s)}return new Uint8Array(t)}const TE=Po({prefix:"🚀",name:"base256emoji",encode:OE,decode:RE});var AE=Object.freeze({__proto__:null,base256emoji:TE}),xE=Uf,Tl=128,CE=-128,NE=Math.pow(2,31);function Uf(o,t,r){t=t||[],r=r||0;for(var s=r;o>=NE;)t[r++]=o&255|Tl,o/=128;for(;o&CE;)t[r++]=o&255|Tl,o>>>=7;return t[r]=o|0,Uf.bytes=r-s+1,t}var $E=Nc,DE=128,Al=127;function Nc(o,s){var r=0,s=s||0,a=0,u=s,l,g=o.length;do{if(u>=g)throw Nc.bytes=0,new RangeError("Could not decode varint");l=o[u++],r+=a<28?(l&Al)<<a:(l&Al)*Math.pow(2,a),a+=7}while(l>=DE);return Nc.bytes=u-s,r}var qE=Math.pow(2,7),jE=Math.pow(2,14),UE=Math.pow(2,21),ME=Math.pow(2,28),LE=Math.pow(2,35),zE=Math.pow(2,42),HE=Math.pow(2,49),kE=Math.pow(2,56),KE=Math.pow(2,63),VE=function(o){return o<qE?1:o<jE?2:o<UE?3:o<ME?4:o<LE?5:o<zE?6:o<HE?7:o<kE?8:o<KE?9:10},BE={encode:xE,decode:$E,encodingLength:VE},Mf=BE;const xl=(o,t,r=0)=>(Mf.encode(o,t,r),t),Cl=o=>Mf.encodingLength(o),$c=(o,t)=>{const r=t.byteLength,s=Cl(o),a=s+Cl(r),u=new Uint8Array(a+r);return xl(o,u,0),xl(r,u,s),u.set(t,a),new FE(o,r,t,u)};class FE{constructor(t,r,s,a){this.code=t,this.size=r,this.digest=s,this.bytes=a}}const Lf=({name:o,code:t,encode:r})=>new GE(o,t,r);class GE{constructor(t,r,s){this.name=t,this.code=r,this.encode=s}digest(t){if(t instanceof Uint8Array){const r=this.encode(t);return r instanceof Uint8Array?$c(this.code,r):r.then(s=>$c(this.code,s))}else throw Error("Unknown type, must be binary type")}}const zf=o=>async t=>new Uint8Array(await crypto.subtle.digest(o,t)),WE=Lf({name:"sha2-256",code:18,encode:zf("SHA-256")}),QE=Lf({name:"sha2-512",code:19,encode:zf("SHA-512")});var JE=Object.freeze({__proto__:null,sha256:WE,sha512:QE});const Hf=0,YE="identity",kf=Df,ZE=o=>$c(Hf,kf(o)),XE={code:Hf,name:YE,encode:kf,digest:ZE};var eI=Object.freeze({__proto__:null,identity:XE});new TextEncoder,new TextDecoder;const Nl={...G0,...Q0,...Y0,...X0,...rE,...fE,...gE,...mE,...IE,...AE};({...JE,...eI});function Kf(o){return globalThis.Buffer!=null?new Uint8Array(o.buffer,o.byteOffset,o.byteLength):o}function tI(o=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Kf(globalThis.Buffer.allocUnsafe(o)):new Uint8Array(o)}function Vf(o,t,r,s){return{name:o,prefix:t,encoder:{name:o,prefix:t,encode:r},decoder:{decode:s}}}const $l=Vf("utf8","u",o=>"u"+new TextDecoder("utf8").decode(o),o=>new TextEncoder().encode(o.substring(1))),dc=Vf("ascii","a",o=>{let t="a";for(let r=0;r<o.length;r++)t+=String.fromCharCode(o[r]);return t},o=>{o=o.substring(1);const t=tI(o.length);for(let r=0;r<o.length;r++)t[r]=o.charCodeAt(r);return t}),rI={utf8:$l,"utf-8":$l,hex:Nl.base16,latin1:dc,ascii:dc,binary:dc,...Nl};function iI(o,t="utf8"){const r=rI[t];if(!r)throw new Error(`Unsupported encoding "${t}"`);return(t==="utf8"||t==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Kf(globalThis.Buffer.from(o,"utf-8")):r.decoder.decode(`${r.prefix}${o}`)}const Bf="wc",sI=2,Ff="core",Ur=`${Bf}@2:${Ff}:`,nI={logger:"error"},oI={database:":memory:"},aI="crypto",Dl="client_ed25519_seed",cI=k.ONE_DAY,uI="keychain",hI="0.3",lI="messages",fI="0.3",pI=k.SIX_HOURS,dI="publisher",Gf="irn",gI="error",Wf="wss://relay.walletconnect.com",ql="wss://relay.walletconnect.org",yI="relayer",Ze={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},vI="_subscription",yr={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},mI=k.ONE_SECOND,wI="2.11.0",_I=1e4,bI="0.3",EI="WALLETCONNECT_CLIENT_ID",Bt={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},II="subscription",PI="0.3",SI=k.FIVE_SECONDS*1e3,OI="pairing",RI="0.3",Cs={wc_pairingDelete:{req:{ttl:k.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:k.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:k.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:k.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:k.ONE_DAY,prompt:!1,tag:0},res:{ttl:k.ONE_DAY,prompt:!1,tag:0}}},Us={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},tr={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},TI="history",AI="0.3",xI="expirer",qt={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},CI="0.3",gc="verify-api",Fi="https://verify.walletconnect.com",Dc="https://verify.walletconnect.org",NI=[Fi,Dc],$I="echo",DI="https://echo.walletconnect.com";class qI{constructor(t,r){this.core=t,this.logger=r,this.keychain=new Map,this.name=uI,this.version=hI,this.initialized=!1,this.storagePrefix=Ur,this.init=async()=>{if(!this.initialized){const s=await this.getKeyChain();typeof s<"u"&&(this.keychain=s),this.initialized=!0}},this.has=s=>(this.isInitialized(),this.keychain.has(s)),this.set=async(s,a)=>{this.isInitialized(),this.keychain.set(s,a),await this.persist()},this.get=s=>{this.isInitialized();const a=this.keychain.get(s);if(typeof a>"u"){const{message:u}=j("NO_MATCHING_KEY",`${this.name}: ${s}`);throw new Error(u)}return a},this.del=async s=>{this.isInitialized(),this.keychain.delete(s),await this.persist()},this.core=t,this.logger=yt(r,this.name)}get context(){return St(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(t){await this.core.storage.setItem(this.storageKey,Tf(t))}async getKeyChain(){const t=await this.core.storage.getItem(this.storageKey);return typeof t<"u"?Af(t):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:t}=j("NOT_INITIALIZED",this.name);throw new Error(t)}}}class jI{constructor(t,r,s){this.core=t,this.logger=r,this.name=aI,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=a=>(this.isInitialized(),this.keychain.has(a)),this.getClientId=async()=>{this.isInitialized();const a=await this.getClientSeed(),u=tl(a);return Fw(u.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const a=ub();return this.setPrivateKey(a.publicKey,a.privateKey)},this.signJWT=async a=>{this.isInitialized();const u=await this.getClientSeed(),l=tl(u),g=xc();return await Gw(g,a,cI,l)},this.generateSharedKey=(a,u,l)=>{this.isInitialized();const g=this.getPrivateKey(a),w=hb(g,u);return this.setSymKey(w,l)},this.setSymKey=async(a,u)=>{this.isInitialized();const l=u||lb(a);return await this.keychain.set(l,a),l},this.deleteKeyPair=async a=>{this.isInitialized(),await this.keychain.del(a)},this.deleteSymKey=async a=>{this.isInitialized(),await this.keychain.del(a)},this.encode=async(a,u,l)=>{this.isInitialized();const g=Rf(l),w=Ji(u);if(fl(g)){const S=g.senderPublicKey,q=g.receiverPublicKey;a=await this.generateSharedKey(S,q)}const y=this.getSymKey(a),{type:E,senderPublicKey:P}=g;return pb({type:E,symKey:y,message:w,senderPublicKey:P})},this.decode=async(a,u,l)=>{this.isInitialized();const g=yb(u,l);if(fl(g)){const w=g.receiverPublicKey,y=g.senderPublicKey;a=await this.generateSharedKey(w,y)}try{const w=this.getSymKey(a),y=db({symKey:w,encoded:u});return Hs(y)}catch(w){this.logger.error(`Failed to decode message from topic: '${a}', clientId: '${await this.getClientId()}'`),this.logger.error(w)}},this.getPayloadType=a=>{const u=po(a);return ks(u.type)},this.getPayloadSenderPublicKey=a=>{const u=po(a);return u.senderPublicKey?jt(u.senderPublicKey,nt):void 0},this.core=t,this.logger=yt(r,this.name),this.keychain=s||new qI(this.core,this.logger)}get context(){return St(this.logger)}async setPrivateKey(t,r){return await this.keychain.set(t,r),t}getPrivateKey(t){return this.keychain.get(t)}async getClientSeed(){let t="";try{t=this.keychain.get(Dl)}catch{t=xc(),await this.keychain.set(Dl,t)}return iI(t,"base16")}getSymKey(t){return this.keychain.get(t)}isInitialized(){if(!this.initialized){const{message:t}=j("NOT_INITIALIZED",this.name);throw new Error(t)}}}class UI extends J_{constructor(t,r){super(t,r),this.logger=t,this.core=r,this.messages=new Map,this.name=lI,this.version=fI,this.initialized=!1,this.storagePrefix=Ur,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const s=await this.getRelayerMessages();typeof s<"u"&&(this.messages=s),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(s){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(s)}finally{this.initialized=!0}}},this.set=async(s,a)=>{this.isInitialized();const u=Wi(a);let l=this.messages.get(s);return typeof l>"u"&&(l={}),typeof l[u]<"u"||(l[u]=a,this.messages.set(s,l),await this.persist()),u},this.get=s=>{this.isInitialized();let a=this.messages.get(s);return typeof a>"u"&&(a={}),a},this.has=(s,a)=>{this.isInitialized();const u=this.get(s),l=Wi(a);return typeof u[l]<"u"},this.del=async s=>{this.isInitialized(),this.messages.delete(s),await this.persist()},this.logger=yt(t,this.name),this.core=r}get context(){return St(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setRelayerMessages(t){await this.core.storage.setItem(this.storageKey,Tf(t))}async getRelayerMessages(){const t=await this.core.storage.getItem(this.storageKey);return typeof t<"u"?Af(t):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:t}=j("NOT_INITIALIZED",this.name);throw new Error(t)}}}class MI extends Y_{constructor(t,r){super(t,r),this.relayer=t,this.logger=r,this.events=new Ut.EventEmitter,this.name=dI,this.queue=new Map,this.publishTimeout=k.toMiliseconds(k.TEN_SECONDS),this.needsTransportRestart=!1,this.publish=async(s,a,u)=>{var l;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:s,message:a,opts:u}});try{const g=(u==null?void 0:u.ttl)||pI,w=Cc(u),y=(u==null?void 0:u.prompt)||!1,E=(u==null?void 0:u.tag)||0,P=(u==null?void 0:u.id)||wf().toString(),S={topic:s,message:a,opts:{ttl:g,relay:w,prompt:y,tag:E,id:P}},q=setTimeout(()=>this.queue.set(P,S),this.publishTimeout);try{await await zs(this.rpcPublish(s,a,g,w,y,E,P),this.publishTimeout,"Failed to publish payload, please try again."),this.removeRequestFromQueue(P),this.relayer.events.emit(Ze.publish,S)}catch(D){if(this.logger.debug("Publishing Payload stalled"),this.needsTransportRestart=!0,(l=u==null?void 0:u.internal)!=null&&l.throwOnFailedPublish)throw this.removeRequestFromQueue(P),D;return}finally{clearTimeout(q)}this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:s,message:a,opts:u}})}catch(g){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(g),g}},this.on=(s,a)=>{this.events.on(s,a)},this.once=(s,a)=>{this.events.once(s,a)},this.off=(s,a)=>{this.events.off(s,a)},this.removeListener=(s,a)=>{this.events.removeListener(s,a)},this.relayer=t,this.logger=yt(r,this.name),this.registerEventListeners()}get context(){return St(this.logger)}rpcPublish(t,r,s,a,u,l,g){var w,y,E,P;const S={method:ho(a.protocol).publish,params:{topic:t,message:r,ttl:s,prompt:u,tag:l},id:g};return st((w=S.params)==null?void 0:w.prompt)&&((y=S.params)==null||delete y.prompt),st((E=S.params)==null?void 0:E.tag)&&((P=S.params)==null||delete P.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:S}),this.relayer.request(S)}removeRequestFromQueue(t){this.queue.delete(t)}checkQueue(){this.queue.forEach(async t=>{const{topic:r,message:s,opts:a}=t;await this.publish(r,s,a)})}registerEventListeners(){this.relayer.core.heartbeat.on(Yi.HEARTBEAT_EVENTS.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(Ze.connection_stalled);return}this.checkQueue()}),this.relayer.on(Ze.message_ack,t=>{this.removeRequestFromQueue(t.id.toString())})}}class LI{constructor(){this.map=new Map,this.set=(t,r)=>{const s=this.get(t);this.exists(t,r)||this.map.set(t,[...s,r])},this.get=t=>this.map.get(t)||[],this.exists=(t,r)=>this.get(t).includes(r),this.delete=(t,r)=>{if(typeof r>"u"){this.map.delete(t);return}if(!this.map.has(t))return;const s=this.get(t);if(!this.exists(t,r))return;const a=s.filter(u=>u!==r);if(!a.length){this.map.delete(t);return}this.map.set(t,a)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var zI=Object.defineProperty,HI=Object.defineProperties,kI=Object.getOwnPropertyDescriptors,jl=Object.getOwnPropertySymbols,KI=Object.prototype.hasOwnProperty,VI=Object.prototype.propertyIsEnumerable,Ul=(o,t,r)=>t in o?zI(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,Ns=(o,t)=>{for(var r in t||(t={}))KI.call(t,r)&&Ul(o,r,t[r]);if(jl)for(var r of jl(t))VI.call(t,r)&&Ul(o,r,t[r]);return o},yc=(o,t)=>HI(o,kI(t));class BI extends eb{constructor(t,r){super(t,r),this.relayer=t,this.logger=r,this.subscriptions=new Map,this.topicMap=new LI,this.events=new Ut.EventEmitter,this.name=II,this.version=PI,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pollingInterval=20,this.storagePrefix=Ur,this.subscribeTimeout=1e4,this.restartInProgress=!1,this.batchSubscribeTopicsLimit=500,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),this.clientId=await this.relayer.core.crypto.getClientId())},this.subscribe=async(s,a)=>{await this.restartToComplete(),this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:s,opts:a}});try{const u=Cc(a),l={topic:s,relay:u};this.pending.set(s,l);const g=await this.rpcSubscribe(s,u);return this.onSubscribe(g,l),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:s,opts:a}}),g}catch(u){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(u),u}},this.unsubscribe=async(s,a)=>{await this.restartToComplete(),this.isInitialized(),typeof(a==null?void 0:a.id)<"u"?await this.unsubscribeById(s,a.id,a):await this.unsubscribeByTopic(s,a)},this.isSubscribed=async s=>this.topics.includes(s)?!0:await new Promise((a,u)=>{const l=new k.Watch;l.start(this.pendingSubscriptionWatchLabel);const g=setInterval(()=>{!this.pending.has(s)&&this.topics.includes(s)&&(clearInterval(g),l.stop(this.pendingSubscriptionWatchLabel),a(!0)),l.elapsed(this.pendingSubscriptionWatchLabel)>=SI&&(clearInterval(g),l.stop(this.pendingSubscriptionWatchLabel),u(new Error("Subscription resolution timeout")))},this.pollingInterval)}).catch(()=>!1),this.on=(s,a)=>{this.events.on(s,a)},this.once=(s,a)=>{this.events.once(s,a)},this.off=(s,a)=>{this.events.off(s,a)},this.removeListener=(s,a)=>{this.events.removeListener(s,a)},this.restart=async()=>{this.restartInProgress=!0,await this.restore(),await this.reset(),this.restartInProgress=!1},this.relayer=t,this.logger=yt(r,this.name),this.clientId=""}get context(){return St(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(t,r){let s=!1;try{s=this.getSubscription(t).topic===r}catch{}return s}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(t,r){const s=this.topicMap.get(t);await Promise.all(s.map(async a=>await this.unsubscribeById(t,a,r)))}async unsubscribeById(t,r,s){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:t,id:r,opts:s}});try{const a=Cc(s);await this.rpcUnsubscribe(t,r,a);const u=De("USER_DISCONNECTED",`${this.name}, ${t}`);await this.onUnsubscribe(t,r,u),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:t,id:r,opts:s}})}catch(a){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(a),a}}async rpcSubscribe(t,r){const s={method:ho(r.protocol).subscribe,params:{topic:t}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s});try{await await zs(this.relayer.request(s),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(Ze.connection_stalled)}return Wi(t+this.clientId)}async rpcBatchSubscribe(t){if(!t.length)return;const r=t[0].relay,s={method:ho(r.protocol).batchSubscribe,params:{topics:t.map(a=>a.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s});try{return await await zs(this.relayer.request(s),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(Ze.connection_stalled)}}rpcUnsubscribe(t,r,s){const a={method:ho(s.protocol).unsubscribe,params:{topic:t,id:r}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:a}),this.relayer.request(a)}onSubscribe(t,r){this.setSubscription(t,yc(Ns({},r),{id:t})),this.pending.delete(r.topic)}onBatchSubscribe(t){t.length&&t.forEach(r=>{this.setSubscription(r.id,Ns({},r)),this.pending.delete(r.topic)})}async onUnsubscribe(t,r,s){this.events.removeAllListeners(r),this.hasSubscription(r,t)&&this.deleteSubscription(r,s),await this.relayer.messages.del(t)}async setRelayerSubscriptions(t){await this.relayer.core.storage.setItem(this.storageKey,t)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(t,r){this.subscriptions.has(t)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:t,subscription:r}),this.addSubscription(t,r))}addSubscription(t,r){this.subscriptions.set(t,Ns({},r)),this.topicMap.set(r.topic,t),this.events.emit(Bt.created,r)}getSubscription(t){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:t});const r=this.subscriptions.get(t);if(!r){const{message:s}=j("NO_MATCHING_KEY",`${this.name}: ${t}`);throw new Error(s)}return r}deleteSubscription(t,r){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:t,reason:r});const s=this.getSubscription(t);this.subscriptions.delete(t),this.topicMap.delete(s.topic,t),this.events.emit(Bt.deleted,yc(Ns({},s),{reason:r}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(Bt.sync)}async reset(){if(this.cached.length){const t=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let r=0;r<t;r++){const s=this.cached.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(s)}}this.events.emit(Bt.resubscribed)}async restore(){try{const t=await this.getRelayerSubscriptions();if(typeof t>"u"||!t.length)return;if(this.subscriptions.size){const{message:r}=j("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(t){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(t)}}async batchSubscribe(t){if(!t.length)return;const r=await this.rpcBatchSubscribe(t);li(r)&&this.onBatchSubscribe(r.map((s,a)=>yc(Ns({},t[a]),{id:s})))}async onConnect(){this.restartInProgress||(await this.restart(),this.onEnable())}onDisconnect(){this.onDisable()}async checkPending(){if(!this.initialized||this.relayer.transportExplicitlyClosed)return;const t=[];this.pending.forEach(r=>{t.push(r)}),await this.batchSubscribe(t)}registerEventListeners(){this.relayer.core.heartbeat.on(Yi.HEARTBEAT_EVENTS.pulse,async()=>{await this.checkPending()}),this.relayer.on(Ze.connect,async()=>{await this.onConnect()}),this.relayer.on(Ze.disconnect,()=>{this.onDisconnect()}),this.events.on(Bt.created,async t=>{const r=Bt.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),await this.persist()}),this.events.on(Bt.deleted,async t=>{const r=Bt.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:t}=j("NOT_INITIALIZED",this.name);throw new Error(t)}}async restartToComplete(){this.restartInProgress&&await new Promise(t=>{const r=setInterval(()=>{this.restartInProgress||(clearInterval(r),t())},this.pollingInterval)})}}var FI=Object.defineProperty,Ml=Object.getOwnPropertySymbols,GI=Object.prototype.hasOwnProperty,WI=Object.prototype.propertyIsEnumerable,Ll=(o,t,r)=>t in o?FI(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,QI=(o,t)=>{for(var r in t||(t={}))GI.call(t,r)&&Ll(o,r,t[r]);if(Ml)for(var r of Ml(t))WI.call(t,r)&&Ll(o,r,t[r]);return o};class JI extends Z_{constructor(t){super(t),this.protocol="wc",this.version=2,this.events=new Ut.EventEmitter,this.name=yI,this.transportExplicitlyClosed=!1,this.initialized=!1,this.connectionAttemptInProgress=!1,this.connectionStatusPollingInterval=20,this.staleConnectionErrors=["socket hang up","socket stalled"],this.hasExperiencedNetworkDisruption=!1,this.request=async r=>{this.logger.debug("Publishing Request Payload");try{return await this.toEstablishConnection(),await this.provider.request(r)}catch(s){throw this.logger.debug("Failed to Publish Request"),this.logger.error(s),s}},this.onPayloadHandler=r=>{this.onProviderPayload(r)},this.onConnectHandler=()=>{this.events.emit(Ze.connect)},this.onDisconnectHandler=()=>{this.onProviderDisconnect()},this.onProviderErrorHandler=r=>{this.logger.error(r),this.events.emit(Ze.error,r),this.logger.info("Fatal socket error received, closing transport"),this.transportClose()},this.registerProviderListeners=()=>{this.provider.on(yr.payload,this.onPayloadHandler),this.provider.on(yr.connect,this.onConnectHandler),this.provider.on(yr.disconnect,this.onDisconnectHandler),this.provider.on(yr.error,this.onProviderErrorHandler)},this.core=t.core,this.logger=typeof t.logger<"u"&&typeof t.logger!="string"?yt(t.logger,this.name):_o(bo({level:t.logger||gI})),this.messages=new UI(this.logger,t.core),this.subscriber=new BI(this,this.logger),this.publisher=new MI(this,this.logger),this.relayUrl=(t==null?void 0:t.relayUrl)||Wf,this.projectId=t.projectId,this.bundleId=Eb(),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await this.createProvider(),await Promise.all([this.messages.init(),this.subscriber.init()]);try{await this.transportOpen()}catch{this.logger.warn(`Connection via ${this.relayUrl} failed, attempting to connect via failover domain ${ql}...`),await this.restartTransport(ql)}this.initialized=!0,setTimeout(async()=>{this.subscriber.topics.length===0&&(this.logger.info("No topics subscribed to after init, closing transport"),await this.transportClose(),this.transportExplicitlyClosed=!1)},_I)}get context(){return St(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(t,r,s){this.isInitialized(),await this.publisher.publish(t,r,s),await this.recordMessageEvent({topic:t,message:r,publishedAt:Date.now()})}async subscribe(t,r){var s;this.isInitialized();let a=((s=this.subscriber.topicMap.get(t))==null?void 0:s[0])||"";if(a)return a;let u;const l=g=>{g.topic===t&&(this.subscriber.off(Bt.created,l),u())};return await Promise.all([new Promise(g=>{u=g,this.subscriber.on(Bt.created,l)}),new Promise(async g=>{a=await this.subscriber.subscribe(t,r),g()})]),a}async unsubscribe(t,r){this.isInitialized(),await this.subscriber.unsubscribe(t,r)}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async transportClose(){this.transportExplicitlyClosed=!0,this.hasExperiencedNetworkDisruption&&this.connected?await zs(this.provider.disconnect(),1e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.connected&&await this.provider.disconnect()}async transportOpen(t){if(this.transportExplicitlyClosed=!1,await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress){t&&t!==this.relayUrl&&(this.relayUrl=t,await this.transportClose(),await this.createProvider()),this.connectionAttemptInProgress=!0;try{await Promise.all([new Promise(r=>{if(!this.initialized)return r();this.subscriber.once(Bt.resubscribed,()=>{r()})}),new Promise(async(r,s)=>{try{await zs(this.provider.connect(),1e4,`Socket stalled when trying to connect to ${this.relayUrl}`)}catch(a){s(a);return}r()})])}catch(r){this.logger.error(r);const s=r;if(!this.isConnectionStalled(s.message))throw r;this.provider.events.emit(yr.disconnect)}finally{this.connectionAttemptInProgress=!1,this.hasExperiencedNetworkDisruption=!1}}}async restartTransport(t){await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress&&(this.relayUrl=t||this.relayUrl,await this.transportClose(),await this.createProvider(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await Il())throw new Error("No internet connection detected. Please restart your network and try again.")}isConnectionStalled(t){return this.staleConnectionErrors.some(r=>t.includes(r))}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const t=await this.core.crypto.signJWT(this.relayUrl);this.provider=new mr(new R0(Tb({sdkVersion:wI,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:t,useOnCloseEvent:!0,bundleId:this.bundleId}))),this.registerProviderListeners()}async recordMessageEvent(t){const{topic:r,message:s}=t;await this.messages.set(r,s)}async shouldIgnoreMessageEvent(t){const{topic:r,message:s}=t;if(!s||s.length===0)return this.logger.debug(`Ignoring invalid/empty message: ${s}`),!0;if(!await this.subscriber.isSubscribed(r))return this.logger.debug(`Ignoring message for non-subscribed topic ${r}`),!0;const a=this.messages.has(r,s);return a&&this.logger.debug(`Ignoring duplicate message: ${s}`),a}async onProviderPayload(t){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:t}),kc(t)){if(!t.method.endsWith(vI))return;const r=t.params,{topic:s,message:a,publishedAt:u}=r.data,l={topic:s,message:a,publishedAt:u};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(QI({type:"event",event:r.id},l)),this.events.emit(r.id,l),await this.acknowledgePayload(t),await this.onMessageEvent(l)}else mo(t)&&this.events.emit(Ze.message_ack,t)}async onMessageEvent(t){await this.shouldIgnoreMessageEvent(t)||(this.events.emit(Ze.message,t),await this.recordMessageEvent(t))}async acknowledgePayload(t){const r=Eo(t.id,!0);await this.provider.connection.send(r)}unregisterProviderListeners(){this.provider.off(yr.payload,this.onPayloadHandler),this.provider.off(yr.connect,this.onConnectHandler),this.provider.off(yr.disconnect,this.onDisconnectHandler),this.provider.off(yr.error,this.onProviderErrorHandler)}async registerEventListeners(){this.events.on(Ze.connection_stalled,()=>{this.restartTransport().catch(r=>this.logger.error(r))});let t=await Il();_0(async r=>{this.initialized&&t!==r&&(t=r,r?await this.restartTransport().catch(s=>this.logger.error(s)):(this.hasExperiencedNetworkDisruption=!0,await this.transportClose().catch(s=>this.logger.error(s))))})}onProviderDisconnect(){this.events.emit(Ze.disconnect),this.attemptToReconnect()}attemptToReconnect(){this.transportExplicitlyClosed||(this.logger.info("attemptToReconnect called. Connecting..."),setTimeout(async()=>{await this.restartTransport().catch(t=>this.logger.error(t))},k.toMiliseconds(mI)))}isInitialized(){if(!this.initialized){const{message:t}=j("NOT_INITIALIZED",this.name);throw new Error(t)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectionAttemptInProgress)return await new Promise(t=>{const r=setInterval(()=>{this.connected&&(clearInterval(r),t())},this.connectionStatusPollingInterval)});await this.restartTransport()}}}var YI=Object.defineProperty,zl=Object.getOwnPropertySymbols,ZI=Object.prototype.hasOwnProperty,XI=Object.prototype.propertyIsEnumerable,Hl=(o,t,r)=>t in o?YI(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,kl=(o,t)=>{for(var r in t||(t={}))ZI.call(t,r)&&Hl(o,r,t[r]);if(zl)for(var r of zl(t))XI.call(t,r)&&Hl(o,r,t[r]);return o};class So extends X_{constructor(t,r,s,a=Ur,u=void 0){super(t,r,s,a),this.core=t,this.logger=r,this.name=s,this.map=new Map,this.version=bI,this.cached=[],this.initialized=!1,this.storagePrefix=Ur,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(l=>{this.getKey&&l!==null&&!st(l)?this.map.set(this.getKey(l),l):Yb(l)?this.map.set(l.id,l):Zb(l)&&this.map.set(l.topic,l)}),this.cached=[],this.initialized=!0)},this.set=async(l,g)=>{this.isInitialized(),this.map.has(l)?await this.update(l,g):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:l,value:g}),this.map.set(l,g),await this.persist())},this.get=l=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:l}),this.getData(l)),this.getAll=l=>(this.isInitialized(),l?this.values.filter(g=>Object.keys(l).every(w=>A0(g[w],l[w]))):this.values),this.update=async(l,g)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:l,update:g});const w=kl(kl({},this.getData(l)),g);this.map.set(l,w),await this.persist()},this.delete=async(l,g)=>{this.isInitialized(),this.map.has(l)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:l,reason:g}),this.map.delete(l),await this.persist())},this.logger=yt(r,this.name),this.storagePrefix=a,this.getKey=u}get context(){return St(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(t){await this.core.storage.setItem(this.storageKey,t)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(t){const r=this.map.get(t);if(!r){const{message:s}=j("NO_MATCHING_KEY",`${this.name}: ${t}`);throw this.logger.error(s),new Error(s)}return r}async persist(){await this.setDataStore(this.values)}async restore(){try{const t=await this.getDataStore();if(typeof t>"u"||!t.length)return;if(this.map.size){const{message:r}=j("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(t){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(t)}}isInitialized(){if(!this.initialized){const{message:t}=j("NOT_INITIALIZED",this.name);throw new Error(t)}}}class e1{constructor(t,r){this.core=t,this.logger=r,this.name=OI,this.version=RI,this.events=new Kc,this.initialized=!1,this.storagePrefix=Ur,this.ignoredPayloadTypes=[pi],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:s})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...s])]},this.create=async()=>{this.isInitialized();const s=xc(),a=await this.core.crypto.setSymKey(s),u=Ft(k.FIVE_MINUTES),l={protocol:Gf},g={topic:a,expiry:u,relay:l,active:!1},w=Hb({protocol:this.core.protocol,version:this.core.version,topic:a,symKey:s,relay:l});return await this.pairings.set(a,g),await this.core.relayer.subscribe(a),this.core.expirer.set(a,u),{topic:a,uri:w}},this.pair=async s=>{this.isInitialized(),this.isValidPair(s);const{topic:a,symKey:u,relay:l}=ml(s.uri);let g;if(this.pairings.keys.includes(a)&&(g=this.pairings.get(a),g.active))throw new Error(`Pairing already exists: ${a}. Please try again with a new connection URI.`);const w=Ft(k.FIVE_MINUTES),y={topic:a,relay:l,expiry:w,active:!1};return await this.pairings.set(a,y),this.core.expirer.set(a,w),s.activatePairing&&await this.activate({topic:a}),this.events.emit(Us.create,y),this.core.crypto.keychain.has(a)||(await this.core.crypto.setSymKey(u,a),await this.core.relayer.subscribe(a,{relay:l})),y},this.activate=async({topic:s})=>{this.isInitialized();const a=Ft(k.THIRTY_DAYS);await this.pairings.update(s,{active:!0,expiry:a}),this.core.expirer.set(s,a)},this.ping=async s=>{this.isInitialized(),await this.isValidPing(s);const{topic:a}=s;if(this.pairings.keys.includes(a)){const u=await this.sendRequest(a,"wc_pairingPing",{}),{done:l,resolve:g,reject:w}=Bi();this.events.once(Ue("pairing_ping",u),({error:y})=>{y?w(y):g()}),await l()}},this.updateExpiry=async({topic:s,expiry:a})=>{this.isInitialized(),await this.pairings.update(s,{expiry:a})},this.updateMetadata=async({topic:s,metadata:a})=>{this.isInitialized(),await this.pairings.update(s,{peerMetadata:a})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async s=>{this.isInitialized(),await this.isValidDisconnect(s);const{topic:a}=s;this.pairings.keys.includes(a)&&(await this.sendRequest(a,"wc_pairingDelete",De("USER_DISCONNECTED")),await this.deletePairing(a))},this.sendRequest=async(s,a,u)=>{const l=Gi(a,u),g=await this.core.crypto.encode(s,l),w=Cs[a].req;return this.core.history.set(s,l),this.core.relayer.publish(s,g,w),l.id},this.sendResult=async(s,a,u)=>{const l=Eo(s,u),g=await this.core.crypto.encode(a,l),w=await this.core.history.get(a,s),y=Cs[w.request.method].res;await this.core.relayer.publish(a,g,y),await this.core.history.resolve(l)},this.sendError=async(s,a,u)=>{const l=wo(s,u),g=await this.core.crypto.encode(a,l),w=await this.core.history.get(a,s),y=Cs[w.request.method]?Cs[w.request.method].res:Cs.unregistered_method.res;await this.core.relayer.publish(a,g,y),await this.core.history.resolve(l)},this.deletePairing=async(s,a)=>{await this.core.relayer.unsubscribe(s),await Promise.all([this.pairings.delete(s,De("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(s),a?Promise.resolve():this.core.expirer.del(s)])},this.cleanup=async()=>{const s=this.pairings.getAll().filter(a=>qr(a.expiry));await Promise.all(s.map(a=>this.deletePairing(a.topic)))},this.onRelayEventRequest=s=>{const{topic:a,payload:u}=s;switch(u.method){case"wc_pairingPing":return this.onPairingPingRequest(a,u);case"wc_pairingDelete":return this.onPairingDeleteRequest(a,u);default:return this.onUnknownRpcMethodRequest(a,u)}},this.onRelayEventResponse=async s=>{const{topic:a,payload:u}=s,l=(await this.core.history.get(a,u.id)).request.method;switch(l){case"wc_pairingPing":return this.onPairingPingResponse(a,u);default:return this.onUnknownRpcMethodResponse(l)}},this.onPairingPingRequest=async(s,a)=>{const{id:u}=a;try{this.isValidPing({topic:s}),await this.sendResult(u,s,!0),this.events.emit(Us.ping,{id:u,topic:s})}catch(l){await this.sendError(u,s,l),this.logger.error(l)}},this.onPairingPingResponse=(s,a)=>{const{id:u}=a;setTimeout(()=>{Dr(a)?this.events.emit(Ue("pairing_ping",u),{}):rr(a)&&this.events.emit(Ue("pairing_ping",u),{error:a.error})},500)},this.onPairingDeleteRequest=async(s,a)=>{const{id:u}=a;try{this.isValidDisconnect({topic:s}),await this.deletePairing(s),this.events.emit(Us.delete,{id:u,topic:s})}catch(l){await this.sendError(u,s,l),this.logger.error(l)}},this.onUnknownRpcMethodRequest=async(s,a)=>{const{id:u,method:l}=a;try{if(this.registeredMethods.includes(l))return;const g=De("WC_METHOD_UNSUPPORTED",l);await this.sendError(u,s,g),this.logger.error(g)}catch(g){await this.sendError(u,s,g),this.logger.error(g)}},this.onUnknownRpcMethodResponse=s=>{this.registeredMethods.includes(s)||this.logger.error(De("WC_METHOD_UNSUPPORTED",s))},this.isValidPair=s=>{var a;if(!gt(s)){const{message:l}=j("MISSING_OR_INVALID",`pair() params: ${s}`);throw new Error(l)}if(!Jb(s.uri)){const{message:l}=j("MISSING_OR_INVALID",`pair() uri: ${s.uri}`);throw new Error(l)}const u=ml(s.uri);if(!((a=u==null?void 0:u.relay)!=null&&a.protocol)){const{message:l}=j("MISSING_OR_INVALID","pair() uri#relay-protocol");throw new Error(l)}if(!(u!=null&&u.symKey)){const{message:l}=j("MISSING_OR_INVALID","pair() uri#symKey");throw new Error(l)}},this.isValidPing=async s=>{if(!gt(s)){const{message:u}=j("MISSING_OR_INVALID",`ping() params: ${s}`);throw new Error(u)}const{topic:a}=s;await this.isValidPairingTopic(a)},this.isValidDisconnect=async s=>{if(!gt(s)){const{message:u}=j("MISSING_OR_INVALID",`disconnect() params: ${s}`);throw new Error(u)}const{topic:a}=s;await this.isValidPairingTopic(a)},this.isValidPairingTopic=async s=>{if(!Fe(s,!1)){const{message:a}=j("MISSING_OR_INVALID",`pairing topic should be a string: ${s}`);throw new Error(a)}if(!this.pairings.keys.includes(s)){const{message:a}=j("NO_MATCHING_KEY",`pairing topic doesn't exist: ${s}`);throw new Error(a)}if(qr(this.pairings.get(s).expiry)){await this.deletePairing(s);const{message:a}=j("EXPIRED",`pairing topic: ${s}`);throw new Error(a)}},this.core=t,this.logger=yt(r,this.name),this.pairings=new So(this.core,this.logger,this.name,this.storagePrefix)}get context(){return St(this.logger)}isInitialized(){if(!this.initialized){const{message:t}=j("NOT_INITIALIZED",this.name);throw new Error(t)}}registerRelayerEvents(){this.core.relayer.on(Ze.message,async t=>{const{topic:r,message:s}=t;if(!this.pairings.keys.includes(r)||this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(s)))return;const a=await this.core.crypto.decode(r,s);try{kc(a)?(this.core.history.set(r,a),this.onRelayEventRequest({topic:r,payload:a})):mo(a)&&(await this.core.history.resolve(a),await this.onRelayEventResponse({topic:r,payload:a}),this.core.history.delete(r,a.id))}catch(u){this.logger.error(u)}})}registerExpirerEvents(){this.core.expirer.on(qt.expired,async t=>{const{topic:r}=Cf(t.target);r&&this.pairings.keys.includes(r)&&(await this.deletePairing(r,!0),this.events.emit(Us.expire,{topic:r}))})}}class t1 extends Q_{constructor(t,r){super(t,r),this.core=t,this.logger=r,this.records=new Map,this.events=new Ut.EventEmitter,this.name=TI,this.version=AI,this.cached=[],this.initialized=!1,this.storagePrefix=Ur,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(s=>this.records.set(s.id,s)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(s,a,u)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:s,request:a,chainId:u}),this.records.has(a.id))return;const l={id:a.id,topic:s,request:{method:a.method,params:a.params||null},chainId:u,expiry:Ft(k.THIRTY_DAYS)};this.records.set(l.id,l),this.events.emit(tr.created,l)},this.resolve=async s=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:s}),!this.records.has(s.id))return;const a=await this.getRecord(s.id);typeof a.response>"u"&&(a.response=rr(s)?{error:s.error}:{result:s.result},this.records.set(a.id,a),this.events.emit(tr.updated,a))},this.get=async(s,a)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:s,id:a}),await this.getRecord(a)),this.delete=(s,a)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:a}),this.values.forEach(u=>{if(u.topic===s){if(typeof a<"u"&&u.id!==a)return;this.records.delete(u.id),this.events.emit(tr.deleted,u)}})},this.exists=async(s,a)=>(this.isInitialized(),this.records.has(a)?(await this.getRecord(a)).topic===s:!1),this.on=(s,a)=>{this.events.on(s,a)},this.once=(s,a)=>{this.events.once(s,a)},this.off=(s,a)=>{this.events.off(s,a)},this.removeListener=(s,a)=>{this.events.removeListener(s,a)},this.logger=yt(r,this.name)}get context(){return St(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const t=[];return this.values.forEach(r=>{if(typeof r.response<"u")return;const s={topic:r.topic,request:Gi(r.request.method,r.request.params,r.id),chainId:r.chainId};return t.push(s)}),t}async setJsonRpcRecords(t){await this.core.storage.setItem(this.storageKey,t)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(t){this.isInitialized();const r=this.records.get(t);if(!r){const{message:s}=j("NO_MATCHING_KEY",`${this.name}: ${t}`);throw new Error(s)}return r}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(tr.sync)}async restore(){try{const t=await this.getJsonRpcRecords();if(typeof t>"u"||!t.length)return;if(this.records.size){const{message:r}=j("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(t){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(t)}}registerEventListeners(){this.events.on(tr.created,t=>{const r=tr.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:t}),this.persist()}),this.events.on(tr.updated,t=>{const r=tr.updated;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:t}),this.persist()}),this.events.on(tr.deleted,t=>{const r=tr.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:t}),this.persist()}),this.core.heartbeat.on(Yi.HEARTBEAT_EVENTS.pulse,()=>{this.cleanup()})}cleanup(){try{this.records.forEach(t=>{k.toMiliseconds(t.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${t.id}`),this.delete(t.topic,t.id))})}catch(t){this.logger.warn(t)}}isInitialized(){if(!this.initialized){const{message:t}=j("NOT_INITIALIZED",this.name);throw new Error(t)}}}class r1 extends tb{constructor(t,r){super(t,r),this.core=t,this.logger=r,this.expirations=new Map,this.events=new Ut.EventEmitter,this.name=xI,this.version=CI,this.cached=[],this.initialized=!1,this.storagePrefix=Ur,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(s=>this.expirations.set(s.target,s)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=s=>{try{const a=this.formatTarget(s);return typeof this.getExpiration(a)<"u"}catch{return!1}},this.set=(s,a)=>{this.isInitialized();const u=this.formatTarget(s),l={target:u,expiry:a};this.expirations.set(u,l),this.checkExpiry(u,l),this.events.emit(qt.created,{target:u,expiration:l})},this.get=s=>{this.isInitialized();const a=this.formatTarget(s);return this.getExpiration(a)},this.del=s=>{if(this.isInitialized(),this.has(s)){const a=this.formatTarget(s),u=this.getExpiration(a);this.expirations.delete(a),this.events.emit(qt.deleted,{target:a,expiration:u})}},this.on=(s,a)=>{this.events.on(s,a)},this.once=(s,a)=>{this.events.once(s,a)},this.off=(s,a)=>{this.events.off(s,a)},this.removeListener=(s,a)=>{this.events.removeListener(s,a)},this.logger=yt(r,this.name)}get context(){return St(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(t){if(typeof t=="string")return Ab(t);if(typeof t=="number")return xb(t);const{message:r}=j("UNKNOWN_TYPE",`Target type: ${typeof t}`);throw new Error(r)}async setExpirations(t){await this.core.storage.setItem(this.storageKey,t)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(qt.sync)}async restore(){try{const t=await this.getExpirations();if(typeof t>"u"||!t.length)return;if(this.expirations.size){const{message:r}=j("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(t){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(t)}}getExpiration(t){const r=this.expirations.get(t);if(!r){const{message:s}=j("NO_MATCHING_KEY",`${this.name}: ${t}`);throw this.logger.error(s),new Error(s)}return r}checkExpiry(t,r){const{expiry:s}=r;k.toMiliseconds(s)-Date.now()<=0&&this.expire(t,r)}expire(t,r){this.expirations.delete(t),this.events.emit(qt.expired,{target:t,expiration:r})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((t,r)=>this.checkExpiry(r,t))}registerEventListeners(){this.core.heartbeat.on(Yi.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(qt.created,t=>{const r=qt.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),this.persist()}),this.events.on(qt.expired,t=>{const r=qt.expired;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),this.persist()}),this.events.on(qt.deleted,t=>{const r=qt.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),this.persist()})}isInitialized(){if(!this.initialized){const{message:t}=j("NOT_INITIALIZED",this.name);throw new Error(t)}}}class i1 extends rb{constructor(t,r){super(t,r),this.projectId=t,this.logger=r,this.name=gc,this.initialized=!1,this.queue=[],this.verifyDisabled=!1,this.init=async s=>{if(this.verifyDisabled||Zi()||!Xi())return;const a=this.getVerifyUrl(s==null?void 0:s.verifyUrl);this.verifyUrl!==a&&this.removeIframe(),this.verifyUrl=a;try{await this.createIframe()}catch(u){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(u)}if(!this.initialized){this.removeIframe(),this.verifyUrl=Dc;try{await this.createIframe()}catch(u){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(u),this.verifyDisabled=!0}}},this.register=async s=>{this.initialized?this.sendPost(s.attestationId):(this.addToQueue(s.attestationId),await this.init())},this.resolve=async s=>{if(this.isDevEnv)return"";const a=this.getVerifyUrl(s==null?void 0:s.verifyUrl);let u;try{u=await this.fetchAttestation(s.attestationId,a)}catch(l){this.logger.info(`failed to resolve attestation: ${s.attestationId} from url: ${a}`),this.logger.info(l),u=await this.fetchAttestation(s.attestationId,Dc)}return u},this.fetchAttestation=async(s,a)=>{this.logger.info(`resolving attestation: ${s} from url: ${a}`);const u=this.startAbortTimer(k.ONE_SECOND*2),l=await fetch(`${a}/attestation/${s}`,{signal:this.abortController.signal});return clearTimeout(u),l.status===200?await l.json():void 0},this.addToQueue=s=>{this.queue.push(s)},this.processQueue=()=>{this.queue.length!==0&&(this.queue.forEach(s=>this.sendPost(s)),this.queue=[])},this.sendPost=s=>{var a;try{if(!this.iframe)return;(a=this.iframe.contentWindow)==null||a.postMessage(s,"*"),this.logger.info(`postMessage sent: ${s} ${this.verifyUrl}`)}catch{}},this.createIframe=async()=>{let s;const a=u=>{u.data==="verify_ready"&&(this.initialized=!0,this.processQueue(),window.removeEventListener("message",a),s())};await Promise.race([new Promise(u=>{if(document.getElementById(gc))return u();window.addEventListener("message",a);const l=document.createElement("iframe");l.id=gc,l.src=`${this.verifyUrl}/${this.projectId}`,l.style.display="none",document.body.append(l),this.iframe=l,s=u}),new Promise((u,l)=>setTimeout(()=>{window.removeEventListener("message",a),l("verify iframe load timeout")},k.toMiliseconds(k.FIVE_SECONDS)))])},this.removeIframe=()=>{this.iframe&&(this.iframe.remove(),this.iframe=void 0,this.initialized=!1)},this.getVerifyUrl=s=>{let a=s||Fi;return NI.includes(a)||(this.logger.info(`verify url: ${a}, not included in trusted list, assigning default: ${Fi}`),a=Fi),a},this.logger=yt(r,this.name),this.verifyUrl=Fi,this.abortController=new AbortController,this.isDevEnv=Fc()&&D0.IS_VITEST}get context(){return St(this.logger)}startAbortTimer(t){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),k.toMiliseconds(t))}}class s1 extends ib{constructor(t,r){super(t,r),this.projectId=t,this.logger=r,this.context=$I,this.registerDeviceToken=async s=>{const{clientId:a,token:u,notificationType:l,enableEncrypted:g=!1}=s,w=`${DI}/${this.projectId}/clients`;await $0(w,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:a,type:l,token:u,always_raw:g})})},this.logger=yt(r,this.context)}}var n1=Object.defineProperty,Kl=Object.getOwnPropertySymbols,o1=Object.prototype.hasOwnProperty,a1=Object.prototype.propertyIsEnumerable,Vl=(o,t,r)=>t in o?n1(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,Bl=(o,t)=>{for(var r in t||(t={}))o1.call(t,r)&&Vl(o,r,t[r]);if(Kl)for(var r of Kl(t))a1.call(t,r)&&Vl(o,r,t[r]);return o};class Qc extends W_{constructor(t){super(t),this.protocol=Bf,this.version=sI,this.name=Ff,this.events=new Ut.EventEmitter,this.initialized=!1,this.on=(s,a)=>this.events.on(s,a),this.once=(s,a)=>this.events.once(s,a),this.off=(s,a)=>this.events.off(s,a),this.removeListener=(s,a)=>this.events.removeListener(s,a),this.projectId=t==null?void 0:t.projectId,this.relayUrl=(t==null?void 0:t.relayUrl)||Wf,this.customStoragePrefix=t!=null&&t.customStoragePrefix?`:${t.customStoragePrefix}`:"";const r=typeof(t==null?void 0:t.logger)<"u"&&typeof(t==null?void 0:t.logger)!="string"?t.logger:_o(bo({level:(t==null?void 0:t.logger)||nI.logger}));this.logger=yt(r,this.name),this.heartbeat=new Yi.HeartBeat,this.crypto=new jI(this,this.logger,t==null?void 0:t.keychain),this.history=new t1(this,this.logger),this.expirer=new r1(this,this.logger),this.storage=t!=null&&t.storage?t.storage:new I_(Bl(Bl({},oI),t==null?void 0:t.storageOptions)),this.relayer=new JI({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new e1(this,this.logger),this.verify=new i1(this.projectId||"",this.logger),this.echoClient=new s1(this.projectId||"",this.logger)}static async init(t){const r=new Qc(t);await r.initialize();const s=await r.crypto.getClientId();return await r.storage.setItem(EI,s),r}get context(){return St(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(t){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,t),this.logger.error(t.message),t}}}const c1=Qc,Qf="wc",Jf=2,Yf="client",Jc=`${Qf}@${Jf}:${Yf}:`,vc={name:Yf,logger:"error"},Fl="WALLETCONNECT_DEEPLINK_CHOICE",u1="proposal",Zf="Proposal expired",h1="session",no=k.SEVEN_DAYS,l1="engine",$s={wc_sessionPropose:{req:{ttl:k.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:k.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:k.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:k.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:k.ONE_DAY,prompt:!1,tag:1104},res:{ttl:k.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:k.ONE_DAY,prompt:!1,tag:1106},res:{ttl:k.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:k.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:k.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:k.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:k.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:k.ONE_DAY,prompt:!1,tag:1112},res:{ttl:k.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:k.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:k.THIRTY_SECONDS,prompt:!1,tag:1115}}},mc={min:k.FIVE_MINUTES,max:k.SEVEN_DAYS},vr={idle:"IDLE",active:"ACTIVE"},f1="request",p1=["wc_sessionPropose","wc_sessionRequest","wc_authRequest"];var d1=Object.defineProperty,g1=Object.defineProperties,y1=Object.getOwnPropertyDescriptors,Gl=Object.getOwnPropertySymbols,v1=Object.prototype.hasOwnProperty,m1=Object.prototype.propertyIsEnumerable,Wl=(o,t,r)=>t in o?d1(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,pt=(o,t)=>{for(var r in t||(t={}))v1.call(t,r)&&Wl(o,r,t[r]);if(Gl)for(var r of Gl(t))m1.call(t,r)&&Wl(o,r,t[r]);return o},Ds=(o,t)=>g1(o,y1(t));class w1 extends nb{constructor(t){super(t),this.name=l1,this.events=new Kc,this.initialized=!1,this.ignoredPayloadTypes=[pi],this.requestQueue={state:vr.idle,queue:[]},this.sessionRequestQueue={state:vr.idle,queue:[]},this.requestQueueDelay=k.ONE_SECOND,this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),this.client.core.pairing.register({methods:Object.keys($s)}),this.initialized=!0,setTimeout(()=>{this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},k.toMiliseconds(this.requestQueueDelay)))},this.connect=async r=>{await this.isInitialized();const s=Ds(pt({},r),{requiredNamespaces:r.requiredNamespaces||{},optionalNamespaces:r.optionalNamespaces||{}});await this.isValidConnect(s);const{pairingTopic:a,requiredNamespaces:u,optionalNamespaces:l,sessionProperties:g,relays:w}=s;let y=a,E,P=!1;if(y&&(P=this.client.core.pairing.pairings.get(y).active),!y||!P){const{topic:te,uri:ie}=await this.client.core.pairing.create();y=te,E=ie}const S=await this.client.core.crypto.generateKeyPair(),q=pt({requiredNamespaces:u,optionalNamespaces:l,relays:w??[{protocol:Gf}],proposer:{publicKey:S,metadata:this.client.metadata}},g&&{sessionProperties:g}),{reject:D,resolve:z,done:ne}=Bi(k.FIVE_MINUTES,Zf);if(this.events.once(Ue("session_connect"),async({error:te,session:ie})=>{if(te)D(te);else if(ie){ie.self.publicKey=S;const he=Ds(pt({},ie),{requiredNamespaces:ie.requiredNamespaces,optionalNamespaces:ie.optionalNamespaces});await this.client.session.set(ie.topic,he),await this.setExpiry(ie.topic,ie.expiry),y&&await this.client.core.pairing.updateMetadata({topic:y,metadata:ie.peer.metadata}),z(he)}}),!y){const{message:te}=j("NO_MATCHING_KEY",`connect() pairing topic: ${y}`);throw new Error(te)}const Z=await this.sendRequest({topic:y,method:"wc_sessionPropose",params:q}),ge=Ft(k.FIVE_MINUTES);return await this.setProposal(Z,pt({id:Z,expiry:ge},q)),{uri:E,approval:ne}},this.pair=async r=>(await this.isInitialized(),await this.client.core.pairing.pair(r)),this.approve=async r=>{await this.isInitialized(),await this.isValidApprove(r);const{id:s,relayProtocol:a,namespaces:u,sessionProperties:l}=r,g=this.client.proposal.get(s);let{pairingTopic:w,proposer:y,requiredNamespaces:E,optionalNamespaces:P}=g;w=w||"",Qi(E)||(E=Bb(u,"approve()"));const S=await this.client.core.crypto.generateKeyPair(),q=y.publicKey,D=await this.client.core.crypto.generateSharedKey(S,q);w&&s&&(await this.client.core.pairing.updateMetadata({topic:w,metadata:y.metadata}),await this.sendResult({id:s,topic:w,result:{relay:{protocol:a??"irn"},responderPublicKey:S}}),await this.client.proposal.delete(s,De("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:w}));const z=pt({relay:{protocol:a??"irn"},namespaces:u,requiredNamespaces:E,optionalNamespaces:P,pairingTopic:w,controller:{publicKey:S,metadata:this.client.metadata},expiry:Ft(no)},l&&{sessionProperties:l});await this.client.core.relayer.subscribe(D),await this.sendRequest({topic:D,method:"wc_sessionSettle",params:z,throwOnFailedPublish:!0});const ne=Ds(pt({},z),{topic:D,pairingTopic:w,acknowledged:!1,self:z.controller,peer:{publicKey:y.publicKey,metadata:y.metadata},controller:S});return await this.client.session.set(D,ne),await this.setExpiry(D,Ft(no)),{topic:D,acknowledged:()=>new Promise(Z=>setTimeout(()=>Z(this.client.session.get(D)),500))}},this.reject=async r=>{await this.isInitialized(),await this.isValidReject(r);const{id:s,reason:a}=r,{pairingTopic:u}=this.client.proposal.get(s);u&&(await this.sendError(s,u,a),await this.client.proposal.delete(s,De("USER_DISCONNECTED")))},this.update=async r=>{await this.isInitialized(),await this.isValidUpdate(r);const{topic:s,namespaces:a}=r,u=await this.sendRequest({topic:s,method:"wc_sessionUpdate",params:{namespaces:a}}),{done:l,resolve:g,reject:w}=Bi();return this.events.once(Ue("session_update",u),({error:y})=>{y?w(y):g()}),await this.client.session.update(s,{namespaces:a}),{acknowledged:l}},this.extend=async r=>{await this.isInitialized(),await this.isValidExtend(r);const{topic:s}=r,a=await this.sendRequest({topic:s,method:"wc_sessionExtend",params:{}}),{done:u,resolve:l,reject:g}=Bi();return this.events.once(Ue("session_extend",a),({error:w})=>{w?g(w):l()}),await this.setExpiry(s,Ft(no)),{acknowledged:u}},this.request=async r=>{await this.isInitialized(),await this.isValidRequest(r);const{chainId:s,request:a,topic:u,expiry:l}=r,g=Ww(),{done:w,resolve:y,reject:E}=Bi(l,"Request expired. Please try again.");return this.events.once(Ue("session_request",g),({error:P,result:S})=>{P?E(P):y(S)}),await Promise.all([new Promise(async P=>{await this.sendRequest({clientRpcId:g,topic:u,method:"wc_sessionRequest",params:{request:a,chainId:s},expiry:l,throwOnFailedPublish:!0}).catch(S=>E(S)),this.client.events.emit("session_request_sent",{topic:u,request:a,chainId:s,id:g}),P()}),new Promise(async P=>{const S=await Nb(this.client.core.storage,Fl);Cb({id:g,topic:u,wcDeepLink:S}),P()}),w()]).then(P=>P[2])},this.respond=async r=>{await this.isInitialized(),await this.isValidRespond(r);const{topic:s,response:a}=r,{id:u}=a;Dr(a)?await this.sendResult({id:u,topic:s,result:a.result,throwOnFailedPublish:!0}):rr(a)&&await this.sendError(u,s,a.error),this.cleanupAfterResponse(r)},this.ping=async r=>{await this.isInitialized(),await this.isValidPing(r);const{topic:s}=r;if(this.client.session.keys.includes(s)){const a=await this.sendRequest({topic:s,method:"wc_sessionPing",params:{}}),{done:u,resolve:l,reject:g}=Bi();this.events.once(Ue("session_ping",a),({error:w})=>{w?g(w):l()}),await u()}else this.client.core.pairing.pairings.keys.includes(s)&&await this.client.core.pairing.ping({topic:s})},this.emit=async r=>{await this.isInitialized(),await this.isValidEmit(r);const{topic:s,event:a,chainId:u}=r;await this.sendRequest({topic:s,method:"wc_sessionEvent",params:{event:a,chainId:u}})},this.disconnect=async r=>{await this.isInitialized(),await this.isValidDisconnect(r);const{topic:s}=r;this.client.session.keys.includes(s)?(await this.sendRequest({topic:s,method:"wc_sessionDelete",params:De("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession(s)):await this.client.core.pairing.disconnect({topic:s})},this.find=r=>(this.isInitialized(),this.client.session.getAll().filter(s=>Wb(s,r))),this.getPendingSessionRequests=()=>(this.isInitialized(),this.client.pendingRequest.getAll()),this.cleanupDuplicatePairings=async r=>{if(r.pairingTopic)try{const s=this.client.core.pairing.pairings.get(r.pairingTopic),a=this.client.core.pairing.pairings.getAll().filter(u=>{var l,g;return((l=u.peerMetadata)==null?void 0:l.url)&&((g=u.peerMetadata)==null?void 0:g.url)===r.peer.metadata.url&&u.topic&&u.topic!==s.topic});if(a.length===0)return;this.client.logger.info(`Cleaning up ${a.length} duplicate pairing(s)`),await Promise.all(a.map(u=>this.client.core.pairing.disconnect({topic:u.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(s){this.client.logger.error(s)}},this.deleteSession=async(r,s)=>{const{self:a}=this.client.session.get(r);await this.client.core.relayer.unsubscribe(r),this.client.session.delete(r,De("USER_DISCONNECTED")),this.client.core.crypto.keychain.has(a.publicKey)&&await this.client.core.crypto.deleteKeyPair(a.publicKey),this.client.core.crypto.keychain.has(r)&&await this.client.core.crypto.deleteSymKey(r),s||this.client.core.expirer.del(r),this.client.core.storage.removeItem(Fl).catch(u=>this.client.logger.warn(u)),this.getPendingSessionRequests().forEach(u=>{u.topic===r&&this.deletePendingSessionRequest(u.id,De("USER_DISCONNECTED"))})},this.deleteProposal=async(r,s)=>{await Promise.all([this.client.proposal.delete(r,De("USER_DISCONNECTED")),s?Promise.resolve():this.client.core.expirer.del(r)])},this.deletePendingSessionRequest=async(r,s,a=!1)=>{await Promise.all([this.client.pendingRequest.delete(r,s),a?Promise.resolve():this.client.core.expirer.del(r)]),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(u=>u.id!==r),a&&(this.sessionRequestQueue.state=vr.idle)},this.setExpiry=async(r,s)=>{this.client.session.keys.includes(r)&&await this.client.session.update(r,{expiry:s}),this.client.core.expirer.set(r,s)},this.setProposal=async(r,s)=>{await this.client.proposal.set(r,s),this.client.core.expirer.set(r,s.expiry)},this.setPendingSessionRequest=async r=>{const s=$s.wc_sessionRequest.req.ttl,{id:a,topic:u,params:l,verifyContext:g}=r;await this.client.pendingRequest.set(a,{id:a,topic:u,params:l,verifyContext:g}),s&&this.client.core.expirer.set(a,Ft(s))},this.sendRequest=async r=>{const{topic:s,method:a,params:u,expiry:l,relayRpcId:g,clientRpcId:w,throwOnFailedPublish:y}=r,E=Gi(a,u,w);if(Xi()&&p1.includes(a)){const q=Wi(JSON.stringify(E));this.client.core.verify.register({attestationId:q})}const P=await this.client.core.crypto.encode(s,E),S=$s[a].req;return l&&(S.ttl=l),g&&(S.id=g),this.client.core.history.set(s,E),y?(S.internal=Ds(pt({},S.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(s,P,S)):this.client.core.relayer.publish(s,P,S).catch(q=>this.client.logger.error(q)),E.id},this.sendResult=async r=>{const{id:s,topic:a,result:u,throwOnFailedPublish:l}=r,g=Eo(s,u),w=await this.client.core.crypto.encode(a,g),y=await this.client.core.history.get(a,s),E=$s[y.request.method].res;l?(E.internal=Ds(pt({},E.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(a,w,E)):this.client.core.relayer.publish(a,w,E).catch(P=>this.client.logger.error(P)),await this.client.core.history.resolve(g)},this.sendError=async(r,s,a)=>{const u=wo(r,a),l=await this.client.core.crypto.encode(s,u),g=await this.client.core.history.get(s,r),w=$s[g.request.method].res;this.client.core.relayer.publish(s,l,w),await this.client.core.history.resolve(u)},this.cleanup=async()=>{const r=[],s=[];this.client.session.getAll().forEach(a=>{qr(a.expiry)&&r.push(a.topic)}),this.client.proposal.getAll().forEach(a=>{qr(a.expiry)&&s.push(a.id)}),await Promise.all([...r.map(a=>this.deleteSession(a)),...s.map(a=>this.deleteProposal(a))])},this.onRelayEventRequest=async r=>{this.requestQueue.queue.push(r),await this.processRequestsQueue()},this.processRequestsQueue=async()=>{if(this.requestQueue.state===vr.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=vr.active;const r=this.requestQueue.queue.shift();if(r)try{this.processRequest(r),await new Promise(s=>setTimeout(s,300))}catch(s){this.client.logger.warn(s)}}this.requestQueue.state=vr.idle},this.processRequest=r=>{const{topic:s,payload:a}=r,u=a.method;switch(u){case"wc_sessionPropose":return this.onSessionProposeRequest(s,a);case"wc_sessionSettle":return this.onSessionSettleRequest(s,a);case"wc_sessionUpdate":return this.onSessionUpdateRequest(s,a);case"wc_sessionExtend":return this.onSessionExtendRequest(s,a);case"wc_sessionPing":return this.onSessionPingRequest(s,a);case"wc_sessionDelete":return this.onSessionDeleteRequest(s,a);case"wc_sessionRequest":return this.onSessionRequest(s,a);case"wc_sessionEvent":return this.onSessionEventRequest(s,a);default:return this.client.logger.info(`Unsupported request method ${u}`)}},this.onRelayEventResponse=async r=>{const{topic:s,payload:a}=r,u=(await this.client.core.history.get(s,a.id)).request.method;switch(u){case"wc_sessionPropose":return this.onSessionProposeResponse(s,a);case"wc_sessionSettle":return this.onSessionSettleResponse(s,a);case"wc_sessionUpdate":return this.onSessionUpdateResponse(s,a);case"wc_sessionExtend":return this.onSessionExtendResponse(s,a);case"wc_sessionPing":return this.onSessionPingResponse(s,a);case"wc_sessionRequest":return this.onSessionRequestResponse(s,a);default:return this.client.logger.info(`Unsupported response method ${u}`)}},this.onRelayEventUnknownPayload=r=>{const{topic:s}=r,{message:a}=j("MISSING_OR_INVALID",`Decoded payload on topic ${s} is not identifiable as a JSON-RPC request or a response.`);throw new Error(a)},this.onSessionProposeRequest=async(r,s)=>{const{params:a,id:u}=s;try{this.isValidConnect(pt({},s.params));const l=Ft(k.FIVE_MINUTES),g=pt({id:u,pairingTopic:r,expiry:l},a);await this.setProposal(u,g);const w=Wi(JSON.stringify(s)),y=await this.getVerifyContext(w,g.proposer.metadata);this.client.events.emit("session_proposal",{id:u,params:g,verifyContext:y})}catch(l){await this.sendError(u,r,l),this.client.logger.error(l)}},this.onSessionProposeResponse=async(r,s)=>{const{id:a}=s;if(Dr(s)){const{result:u}=s;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:u});const l=this.client.proposal.get(a);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:l});const g=l.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:g});const w=u.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:w});const y=await this.client.core.crypto.generateSharedKey(g,w);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:y});const E=await this.client.core.relayer.subscribe(y);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:E}),await this.client.core.pairing.activate({topic:r})}else rr(s)&&(await this.client.proposal.delete(a,De("USER_DISCONNECTED")),this.events.emit(Ue("session_connect"),{error:s.error}))},this.onSessionSettleRequest=async(r,s)=>{const{id:a,params:u}=s;try{this.isValidSessionSettleRequest(u);const{relay:l,controller:g,expiry:w,namespaces:y,requiredNamespaces:E,optionalNamespaces:P,sessionProperties:S,pairingTopic:q}=s.params,D=pt({topic:r,relay:l,expiry:w,namespaces:y,acknowledged:!0,pairingTopic:q,requiredNamespaces:E,optionalNamespaces:P,controller:g.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:g.publicKey,metadata:g.metadata}},S&&{sessionProperties:S});await this.sendResult({id:s.id,topic:r,result:!0}),this.events.emit(Ue("session_connect"),{session:D}),this.cleanupDuplicatePairings(D)}catch(l){await this.sendError(a,r,l),this.client.logger.error(l)}},this.onSessionSettleResponse=async(r,s)=>{const{id:a}=s;Dr(s)?(await this.client.session.update(r,{acknowledged:!0}),this.events.emit(Ue("session_approve",a),{})):rr(s)&&(await this.client.session.delete(r,De("USER_DISCONNECTED")),this.events.emit(Ue("session_approve",a),{error:s.error}))},this.onSessionUpdateRequest=async(r,s)=>{const{params:a,id:u}=s;try{const l=`${r}_session_update`,g=so.get(l);if(g&&this.isRequestOutOfSync(g,u)){this.client.logger.info(`Discarding out of sync request - ${u}`);return}this.isValidUpdate(pt({topic:r},a)),await this.client.session.update(r,{namespaces:a.namespaces}),await this.sendResult({id:u,topic:r,result:!0}),this.client.events.emit("session_update",{id:u,topic:r,params:a}),so.set(l,u)}catch(l){await this.sendError(u,r,l),this.client.logger.error(l)}},this.isRequestOutOfSync=(r,s)=>parseInt(s.toString().slice(0,-3))<=parseInt(r.toString().slice(0,-3)),this.onSessionUpdateResponse=(r,s)=>{const{id:a}=s;Dr(s)?this.events.emit(Ue("session_update",a),{}):rr(s)&&this.events.emit(Ue("session_update",a),{error:s.error})},this.onSessionExtendRequest=async(r,s)=>{const{id:a}=s;try{this.isValidExtend({topic:r}),await this.setExpiry(r,Ft(no)),await this.sendResult({id:a,topic:r,result:!0}),this.client.events.emit("session_extend",{id:a,topic:r})}catch(u){await this.sendError(a,r,u),this.client.logger.error(u)}},this.onSessionExtendResponse=(r,s)=>{const{id:a}=s;Dr(s)?this.events.emit(Ue("session_extend",a),{}):rr(s)&&this.events.emit(Ue("session_extend",a),{error:s.error})},this.onSessionPingRequest=async(r,s)=>{const{id:a}=s;try{this.isValidPing({topic:r}),await this.sendResult({id:a,topic:r,result:!0}),this.client.events.emit("session_ping",{id:a,topic:r})}catch(u){await this.sendError(a,r,u),this.client.logger.error(u)}},this.onSessionPingResponse=(r,s)=>{const{id:a}=s;setTimeout(()=>{Dr(s)?this.events.emit(Ue("session_ping",a),{}):rr(s)&&this.events.emit(Ue("session_ping",a),{error:s.error})},500)},this.onSessionDeleteRequest=async(r,s)=>{const{id:a}=s;try{this.isValidDisconnect({topic:r,reason:s.params}),await Promise.all([new Promise(u=>{this.client.core.relayer.once(Ze.publish,async()=>{u(await this.deleteSession(r))})}),this.sendResult({id:a,topic:r,result:!0})]),this.client.events.emit("session_delete",{id:a,topic:r})}catch(u){this.client.logger.error(u)}},this.onSessionRequest=async(r,s)=>{const{id:a,params:u}=s;try{this.isValidRequest(pt({topic:r},u));const l=Wi(JSON.stringify(Gi("wc_sessionRequest",u,a))),g=this.client.session.get(r),w=await this.getVerifyContext(l,g.peer.metadata),y={id:a,topic:r,params:u,verifyContext:w};await this.setPendingSessionRequest(y),this.addSessionRequestToSessionRequestQueue(y),this.processSessionRequestQueue()}catch(l){await this.sendError(a,r,l),this.client.logger.error(l)}},this.onSessionRequestResponse=(r,s)=>{const{id:a}=s;Dr(s)?this.events.emit(Ue("session_request",a),{result:s.result}):rr(s)&&this.events.emit(Ue("session_request",a),{error:s.error})},this.onSessionEventRequest=async(r,s)=>{const{id:a,params:u}=s;try{const l=`${r}_session_event_${u.event.name}`,g=so.get(l);if(g&&this.isRequestOutOfSync(g,a)){this.client.logger.info(`Discarding out of sync request - ${a}`);return}this.isValidEmit(pt({topic:r},u)),this.client.events.emit("session_event",{id:a,topic:r,params:u}),so.set(l,a)}catch(l){await this.sendError(a,r,l),this.client.logger.error(l)}},this.addSessionRequestToSessionRequestQueue=r=>{this.sessionRequestQueue.queue.push(r)},this.cleanupAfterResponse=r=>{this.deletePendingSessionRequest(r.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=vr.idle,this.processSessionRequestQueue()},k.toMiliseconds(this.requestQueueDelay))},this.processSessionRequestQueue=()=>{if(this.sessionRequestQueue.state===vr.active){this.client.logger.info("session request queue is already active.");return}const r=this.sessionRequestQueue.queue[0];if(!r){this.client.logger.info("session request queue is empty.");return}try{this.sessionRequestQueue.state=vr.active,this.client.events.emit("session_request",r)}catch(s){this.client.logger.error(s)}},this.onPairingCreated=r=>{if(r.active)return;const s=this.client.proposal.getAll().find(a=>a.pairingTopic===r.topic);s&&this.onSessionProposeRequest(r.topic,Gi("wc_sessionPropose",{requiredNamespaces:s.requiredNamespaces,optionalNamespaces:s.optionalNamespaces,relays:s.relays,proposer:s.proposer,sessionProperties:s.sessionProperties},s.id))},this.isValidConnect=async r=>{if(!gt(r)){const{message:w}=j("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(r)}`);throw new Error(w)}const{pairingTopic:s,requiredNamespaces:a,optionalNamespaces:u,sessionProperties:l,relays:g}=r;if(st(s)||await this.isValidPairingTopic(s),!o0(g)){const{message:w}=j("MISSING_OR_INVALID",`connect() relays: ${g}`);throw new Error(w)}!st(a)&&Qi(a)!==0&&this.validateNamespaces(a,"requiredNamespaces"),!st(u)&&Qi(u)!==0&&this.validateNamespaces(u,"optionalNamespaces"),st(l)||this.validateSessionProps(l,"sessionProperties")},this.validateNamespaces=(r,s)=>{const a=n0(r,"connect()",s);if(a)throw new Error(a.message)},this.isValidApprove=async r=>{if(!gt(r))throw new Error(j("MISSING_OR_INVALID",`approve() params: ${r}`).message);const{id:s,namespaces:a,relayProtocol:u,sessionProperties:l}=r;await this.isValidProposalId(s);const g=this.client.proposal.get(s),w=lo(a,"approve()");if(w)throw new Error(w.message);const y=bl(g.requiredNamespaces,a,"approve()");if(y)throw new Error(y.message);if(!Fe(u,!0)){const{message:E}=j("MISSING_OR_INVALID",`approve() relayProtocol: ${u}`);throw new Error(E)}st(l)||this.validateSessionProps(l,"sessionProperties")},this.isValidReject=async r=>{if(!gt(r)){const{message:u}=j("MISSING_OR_INVALID",`reject() params: ${r}`);throw new Error(u)}const{id:s,reason:a}=r;if(await this.isValidProposalId(s),!c0(a)){const{message:u}=j("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(a)}`);throw new Error(u)}},this.isValidSessionSettleRequest=r=>{if(!gt(r)){const{message:y}=j("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${r}`);throw new Error(y)}const{relay:s,controller:a,namespaces:u,expiry:l}=r;if(!$f(s)){const{message:y}=j("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(y)}const g=Xb(a,"onSessionSettleRequest()");if(g)throw new Error(g.message);const w=lo(u,"onSessionSettleRequest()");if(w)throw new Error(w.message);if(qr(l)){const{message:y}=j("EXPIRED","onSessionSettleRequest()");throw new Error(y)}},this.isValidUpdate=async r=>{if(!gt(r)){const{message:w}=j("MISSING_OR_INVALID",`update() params: ${r}`);throw new Error(w)}const{topic:s,namespaces:a}=r;await this.isValidSessionTopic(s);const u=this.client.session.get(s),l=lo(a,"update()");if(l)throw new Error(l.message);const g=bl(u.requiredNamespaces,a,"update()");if(g)throw new Error(g.message)},this.isValidExtend=async r=>{if(!gt(r)){const{message:a}=j("MISSING_OR_INVALID",`extend() params: ${r}`);throw new Error(a)}const{topic:s}=r;await this.isValidSessionTopic(s)},this.isValidRequest=async r=>{if(!gt(r)){const{message:w}=j("MISSING_OR_INVALID",`request() params: ${r}`);throw new Error(w)}const{topic:s,request:a,chainId:u,expiry:l}=r;await this.isValidSessionTopic(s);const{namespaces:g}=this.client.session.get(s);if(!_l(g,u)){const{message:w}=j("MISSING_OR_INVALID",`request() chainId: ${u}`);throw new Error(w)}if(!u0(a)){const{message:w}=j("MISSING_OR_INVALID",`request() ${JSON.stringify(a)}`);throw new Error(w)}if(!f0(g,u,a.method)){const{message:w}=j("MISSING_OR_INVALID",`request() method: ${a.method}`);throw new Error(w)}if(l&&!y0(l,mc)){const{message:w}=j("MISSING_OR_INVALID",`request() expiry: ${l}. Expiry must be a number (in seconds) between ${mc.min} and ${mc.max}`);throw new Error(w)}},this.isValidRespond=async r=>{var s;if(!gt(r)){const{message:l}=j("MISSING_OR_INVALID",`respond() params: ${r}`);throw new Error(l)}const{topic:a,response:u}=r;try{await this.isValidSessionTopic(a)}catch(l){throw(s=r==null?void 0:r.response)!=null&&s.id&&this.cleanupAfterResponse(r),l}if(!h0(u)){const{message:l}=j("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(u)}`);throw new Error(l)}},this.isValidPing=async r=>{if(!gt(r)){const{message:a}=j("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(a)}const{topic:s}=r;await this.isValidSessionOrPairingTopic(s)},this.isValidEmit=async r=>{if(!gt(r)){const{message:g}=j("MISSING_OR_INVALID",`emit() params: ${r}`);throw new Error(g)}const{topic:s,event:a,chainId:u}=r;await this.isValidSessionTopic(s);const{namespaces:l}=this.client.session.get(s);if(!_l(l,u)){const{message:g}=j("MISSING_OR_INVALID",`emit() chainId: ${u}`);throw new Error(g)}if(!l0(a)){const{message:g}=j("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(a)}`);throw new Error(g)}if(!p0(l,u,a.name)){const{message:g}=j("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(a)}`);throw new Error(g)}},this.isValidDisconnect=async r=>{if(!gt(r)){const{message:a}=j("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(a)}const{topic:s}=r;await this.isValidSessionOrPairingTopic(s)},this.getVerifyContext=async(r,s)=>{const a={verified:{verifyUrl:s.verifyUrl||Fi,validation:"UNKNOWN",origin:s.url||""}};try{const u=await this.client.core.verify.resolve({attestationId:r,verifyUrl:s.verifyUrl});u&&(a.verified.origin=u.origin,a.verified.isScam=u.isScam,a.verified.validation=u.origin===new URL(s.url).origin?"VALID":"INVALID")}catch(u){this.client.logger.info(u)}return this.client.logger.info(`Verify context: ${JSON.stringify(a)}`),a},this.validateSessionProps=(r,s)=>{Object.values(r).forEach(a=>{if(!Fe(a,!1)){const{message:u}=j("MISSING_OR_INVALID",`${s} must be in Record<string, string> format. Received: ${JSON.stringify(a)}`);throw new Error(u)}})}}async isInitialized(){if(!this.initialized){const{message:t}=j("NOT_INITIALIZED",this.name);throw new Error(t)}await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(Ze.message,async t=>{const{topic:r,message:s}=t;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(s)))return;const a=await this.client.core.crypto.decode(r,s);try{kc(a)?(this.client.core.history.set(r,a),this.onRelayEventRequest({topic:r,payload:a})):mo(a)?(await this.client.core.history.resolve(a),await this.onRelayEventResponse({topic:r,payload:a}),this.client.core.history.delete(r,a.id)):this.onRelayEventUnknownPayload({topic:r,payload:a})}catch(u){this.client.logger.error(u)}})}registerExpirerEvents(){this.client.core.expirer.on(qt.expired,async t=>{const{topic:r,id:s}=Cf(t.target);if(s&&this.client.pendingRequest.keys.includes(s))return await this.deletePendingSessionRequest(s,j("EXPIRED"),!0);r?this.client.session.keys.includes(r)&&(await this.deleteSession(r,!0),this.client.events.emit("session_expire",{topic:r})):s&&(await this.deleteProposal(s,!0),this.client.events.emit("proposal_expire",{id:s}))})}registerPairingEvents(){this.client.core.pairing.events.on(Us.create,t=>this.onPairingCreated(t))}isValidPairingTopic(t){if(!Fe(t,!1)){const{message:r}=j("MISSING_OR_INVALID",`pairing topic should be a string: ${t}`);throw new Error(r)}if(!this.client.core.pairing.pairings.keys.includes(t)){const{message:r}=j("NO_MATCHING_KEY",`pairing topic doesn't exist: ${t}`);throw new Error(r)}if(qr(this.client.core.pairing.pairings.get(t).expiry)){const{message:r}=j("EXPIRED",`pairing topic: ${t}`);throw new Error(r)}}async isValidSessionTopic(t){if(!Fe(t,!1)){const{message:r}=j("MISSING_OR_INVALID",`session topic should be a string: ${t}`);throw new Error(r)}if(!this.client.session.keys.includes(t)){const{message:r}=j("NO_MATCHING_KEY",`session topic doesn't exist: ${t}`);throw new Error(r)}if(qr(this.client.session.get(t).expiry)){await this.deleteSession(t);const{message:r}=j("EXPIRED",`session topic: ${t}`);throw new Error(r)}}async isValidSessionOrPairingTopic(t){if(this.client.session.keys.includes(t))await this.isValidSessionTopic(t);else if(this.client.core.pairing.pairings.keys.includes(t))this.isValidPairingTopic(t);else if(Fe(t,!1)){const{message:r}=j("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${t}`);throw new Error(r)}else{const{message:r}=j("MISSING_OR_INVALID",`session or pairing topic should be a string: ${t}`);throw new Error(r)}}async isValidProposalId(t){if(!a0(t)){const{message:r}=j("MISSING_OR_INVALID",`proposal id should be a number: ${t}`);throw new Error(r)}if(!this.client.proposal.keys.includes(t)){const{message:r}=j("NO_MATCHING_KEY",`proposal id doesn't exist: ${t}`);throw new Error(r)}if(qr(this.client.proposal.get(t).expiry)){await this.deleteProposal(t);const{message:r}=j("EXPIRED",`proposal id: ${t}`);throw new Error(r)}}}class _1 extends So{constructor(t,r){super(t,r,u1,Jc),this.core=t,this.logger=r}}class b1 extends So{constructor(t,r){super(t,r,h1,Jc),this.core=t,this.logger=r}}class E1 extends So{constructor(t,r){super(t,r,f1,Jc,s=>s.id),this.core=t,this.logger=r}}let I1=class Xf extends sb{constructor(t){super(t),this.protocol=Qf,this.version=Jf,this.name=vc.name,this.events=new Ut.EventEmitter,this.on=(s,a)=>this.events.on(s,a),this.once=(s,a)=>this.events.once(s,a),this.off=(s,a)=>this.events.off(s,a),this.removeListener=(s,a)=>this.events.removeListener(s,a),this.removeAllListeners=s=>this.events.removeAllListeners(s),this.connect=async s=>{try{return await this.engine.connect(s)}catch(a){throw this.logger.error(a.message),a}},this.pair=async s=>{try{return await this.engine.pair(s)}catch(a){throw this.logger.error(a.message),a}},this.approve=async s=>{try{return await this.engine.approve(s)}catch(a){throw this.logger.error(a.message),a}},this.reject=async s=>{try{return await this.engine.reject(s)}catch(a){throw this.logger.error(a.message),a}},this.update=async s=>{try{return await this.engine.update(s)}catch(a){throw this.logger.error(a.message),a}},this.extend=async s=>{try{return await this.engine.extend(s)}catch(a){throw this.logger.error(a.message),a}},this.request=async s=>{try{return await this.engine.request(s)}catch(a){throw this.logger.error(a.message),a}},this.respond=async s=>{try{return await this.engine.respond(s)}catch(a){throw this.logger.error(a.message),a}},this.ping=async s=>{try{return await this.engine.ping(s)}catch(a){throw this.logger.error(a.message),a}},this.emit=async s=>{try{return await this.engine.emit(s)}catch(a){throw this.logger.error(a.message),a}},this.disconnect=async s=>{try{return await this.engine.disconnect(s)}catch(a){throw this.logger.error(a.message),a}},this.find=s=>{try{return this.engine.find(s)}catch(a){throw this.logger.error(a.message),a}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(s){throw this.logger.error(s.message),s}},this.name=(t==null?void 0:t.name)||vc.name,this.metadata=(t==null?void 0:t.metadata)||Pb();const r=typeof(t==null?void 0:t.logger)<"u"&&typeof(t==null?void 0:t.logger)!="string"?t.logger:_o(bo({level:(t==null?void 0:t.logger)||vc.logger}));this.core=(t==null?void 0:t.core)||new c1(t),this.logger=yt(r,this.name),this.session=new b1(this.core,this.logger),this.proposal=new _1(this.core,this.logger),this.pendingRequest=new E1(this.core,this.logger),this.engine=new w1(this)}static async init(t){const r=new Xf(t);return await r.initialize(),r}get context(){return St(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.core.verify.init({verifyUrl:this.metadata.verifyUrl}),this.logger.info("SignClient Initialization Success")}catch(t){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(t.message),t}}};var qc={exports:{}};(function(o,t){var r=typeof globalThis<"u"&&globalThis||typeof self<"u"&&self||typeof jr<"u"&&jr,s=function(){function u(){this.fetch=!1,this.DOMException=r.DOMException}return u.prototype=r,new u}();(function(u){(function(l){var g=typeof u<"u"&&u||typeof self<"u"&&self||typeof jr<"u"&&jr||{},w={searchParams:"URLSearchParams"in g,iterable:"Symbol"in g&&"iterator"in Symbol,blob:"FileReader"in g&&"Blob"in g&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in g,arrayBuffer:"ArrayBuffer"in g};function y(O){return O&&DataView.prototype.isPrototypeOf(O)}if(w.arrayBuffer)var E=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],P=ArrayBuffer.isView||function(O){return O&&E.indexOf(Object.prototype.toString.call(O))>-1};function S(O){if(typeof O!="string"&&(O=String(O)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(O)||O==="")throw new TypeError('Invalid character in header field name: "'+O+'"');return O.toLowerCase()}function q(O){return typeof O!="string"&&(O=String(O)),O}function D(O){var $={next:function(){var F=O.shift();return{done:F===void 0,value:F}}};return w.iterable&&($[Symbol.iterator]=function(){return $}),$}function z(O){this.map={},O instanceof z?O.forEach(function($,F){this.append(F,$)},this):Array.isArray(O)?O.forEach(function($){if($.length!=2)throw new TypeError("Headers constructor: expected name/value pair to be length 2, found"+$.length);this.append($[0],$[1])},this):O&&Object.getOwnPropertyNames(O).forEach(function($){this.append($,O[$])},this)}z.prototype.append=function(O,$){O=S(O),$=q($);var F=this.map[O];this.map[O]=F?F+", "+$:$},z.prototype.delete=function(O){delete this.map[S(O)]},z.prototype.get=function(O){return O=S(O),this.has(O)?this.map[O]:null},z.prototype.has=function(O){return this.map.hasOwnProperty(S(O))},z.prototype.set=function(O,$){this.map[S(O)]=q($)},z.prototype.forEach=function(O,$){for(var F in this.map)this.map.hasOwnProperty(F)&&O.call($,this.map[F],F,this)},z.prototype.keys=function(){var O=[];return this.forEach(function($,F){O.push(F)}),D(O)},z.prototype.values=function(){var O=[];return this.forEach(function($){O.push($)}),D(O)},z.prototype.entries=function(){var O=[];return this.forEach(function($,F){O.push([F,$])}),D(O)},w.iterable&&(z.prototype[Symbol.iterator]=z.prototype.entries);function ne(O){if(!O._noBody){if(O.bodyUsed)return Promise.reject(new TypeError("Already read"));O.bodyUsed=!0}}function Z(O){return new Promise(function($,F){O.onload=function(){$(O.result)},O.onerror=function(){F(O.error)}})}function ge(O){var $=new FileReader,F=Z($);return $.readAsArrayBuffer(O),F}function te(O){var $=new FileReader,F=Z($),oe=/charset=([A-Za-z0-9_-]+)/.exec(O.type),ve=oe?oe[1]:"utf-8";return $.readAsText(O,ve),F}function ie(O){for(var $=new Uint8Array(O),F=new Array($.length),oe=0;oe<$.length;oe++)F[oe]=String.fromCharCode($[oe]);return F.join("")}function he(O){if(O.slice)return O.slice(0);var $=new Uint8Array(O.byteLength);return $.set(new Uint8Array(O)),$.buffer}function Te(){return this.bodyUsed=!1,this._initBody=function(O){this.bodyUsed=this.bodyUsed,this._bodyInit=O,O?typeof O=="string"?this._bodyText=O:w.blob&&Blob.prototype.isPrototypeOf(O)?this._bodyBlob=O:w.formData&&FormData.prototype.isPrototypeOf(O)?this._bodyFormData=O:w.searchParams&&URLSearchParams.prototype.isPrototypeOf(O)?this._bodyText=O.toString():w.arrayBuffer&&w.blob&&y(O)?(this._bodyArrayBuffer=he(O.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):w.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(O)||P(O))?this._bodyArrayBuffer=he(O):this._bodyText=O=Object.prototype.toString.call(O):(this._noBody=!0,this._bodyText=""),this.headers.get("content-type")||(typeof O=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):w.searchParams&&URLSearchParams.prototype.isPrototypeOf(O)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},w.blob&&(this.blob=function(){var O=ne(this);if(O)return O;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))}),this.arrayBuffer=function(){if(this._bodyArrayBuffer){var O=ne(this);return O||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}else{if(w.blob)return this.blob().then(ge);throw new Error("could not read as ArrayBuffer")}},this.text=function(){var O=ne(this);if(O)return O;if(this._bodyBlob)return te(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(ie(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},w.formData&&(this.formData=function(){return this.text().then(zr)}),this.json=function(){return this.text().then(JSON.parse)},this}var Ee=["CONNECT","DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT","TRACE"];function Me(O){var $=O.toUpperCase();return Ee.indexOf($)>-1?$:O}function Le(O,$){if(!(this instanceof Le))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');$=$||{};var F=$.body;if(O instanceof Le){if(O.bodyUsed)throw new TypeError("Already read");this.url=O.url,this.credentials=O.credentials,$.headers||(this.headers=new z(O.headers)),this.method=O.method,this.mode=O.mode,this.signal=O.signal,!F&&O._bodyInit!=null&&(F=O._bodyInit,O.bodyUsed=!0)}else this.url=String(O);if(this.credentials=$.credentials||this.credentials||"same-origin",($.headers||!this.headers)&&(this.headers=new z($.headers)),this.method=Me($.method||this.method||"GET"),this.mode=$.mode||this.mode||null,this.signal=$.signal||this.signal||function(){if("AbortController"in g){var J=new AbortController;return J.signal}}(),this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&F)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(F),(this.method==="GET"||this.method==="HEAD")&&($.cache==="no-store"||$.cache==="no-cache")){var oe=/([?&])_=[^&]*/;if(oe.test(this.url))this.url=this.url.replace(oe,"$1_="+new Date().getTime());else{var ve=/\?/;this.url+=(ve.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}Le.prototype.clone=function(){return new Le(this,{body:this._bodyInit})};function zr(O){var $=new FormData;return O.trim().split("&").forEach(function(F){if(F){var oe=F.split("="),ve=oe.shift().replace(/\+/g," "),J=oe.join("=").replace(/\+/g," ");$.append(decodeURIComponent(ve),decodeURIComponent(J))}}),$}function gi(O){var $=new z,F=O.replace(/\r?\n[\t ]+/g," ");return F.split("\r").map(function(oe){return oe.indexOf(`
`)===0?oe.substr(1,oe.length):oe}).forEach(function(oe){var ve=oe.split(":"),J=ve.shift().trim();if(J){var Ge=ve.join(":").trim();try{$.append(J,Ge)}catch(Hr){console.warn("Response "+Hr.message)}}}),$}Te.call(Le.prototype);function ke(O,$){if(!(this instanceof ke))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');if($||($={}),this.type="default",this.status=$.status===void 0?200:$.status,this.status<200||this.status>599)throw new RangeError("Failed to construct 'Response': The status provided (0) is outside the range [200, 599].");this.ok=this.status>=200&&this.status<300,this.statusText=$.statusText===void 0?"":""+$.statusText,this.headers=new z($.headers),this.url=$.url||"",this._initBody(O)}Te.call(ke.prototype),ke.prototype.clone=function(){return new ke(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new z(this.headers),url:this.url})},ke.error=function(){var O=new ke(null,{status:200,statusText:""});return O.ok=!1,O.status=0,O.type="error",O};var ts=[301,302,303,307,308];ke.redirect=function(O,$){if(ts.indexOf($)===-1)throw new RangeError("Invalid status code");return new ke(null,{status:$,headers:{location:O}})},l.DOMException=g.DOMException;try{new l.DOMException}catch{l.DOMException=function($,F){this.message=$,this.name=F;var oe=Error($);this.stack=oe.stack},l.DOMException.prototype=Object.create(Error.prototype),l.DOMException.prototype.constructor=l.DOMException}function _r(O,$){return new Promise(function(F,oe){var ve=new Le(O,$);if(ve.signal&&ve.signal.aborted)return oe(new l.DOMException("Aborted","AbortError"));var J=new XMLHttpRequest;function Ge(){J.abort()}J.onload=function(){var xe={statusText:J.statusText,headers:gi(J.getAllResponseHeaders()||"")};ve.url.indexOf("file://")===0&&(J.status<200||J.status>599)?xe.status=200:xe.status=J.status,xe.url="responseURL"in J?J.responseURL:xe.headers.get("X-Request-URL");var X="response"in J?J.response:J.responseText;setTimeout(function(){F(new ke(X,xe))},0)},J.onerror=function(){setTimeout(function(){oe(new TypeError("Network request failed"))},0)},J.ontimeout=function(){setTimeout(function(){oe(new TypeError("Network request timed out"))},0)},J.onabort=function(){setTimeout(function(){oe(new l.DOMException("Aborted","AbortError"))},0)};function Hr(xe){try{return xe===""&&g.location.href?g.location.href:xe}catch{return xe}}if(J.open(ve.method,Hr(ve.url),!0),ve.credentials==="include"?J.withCredentials=!0:ve.credentials==="omit"&&(J.withCredentials=!1),"responseType"in J&&(w.blob?J.responseType="blob":w.arrayBuffer&&(J.responseType="arraybuffer")),$&&typeof $.headers=="object"&&!($.headers instanceof z||g.Headers&&$.headers instanceof g.Headers)){var yi=[];Object.getOwnPropertyNames($.headers).forEach(function(xe){yi.push(S(xe)),J.setRequestHeader(xe,q($.headers[xe]))}),ve.headers.forEach(function(xe,X){yi.indexOf(X)===-1&&J.setRequestHeader(X,xe)})}else ve.headers.forEach(function(xe,X){J.setRequestHeader(X,xe)});ve.signal&&(ve.signal.addEventListener("abort",Ge),J.onreadystatechange=function(){J.readyState===4&&ve.signal.removeEventListener("abort",Ge)}),J.send(typeof ve._bodyInit>"u"?null:ve._bodyInit)})}return _r.polyfill=!0,g.fetch||(g.fetch=_r,g.Headers=z,g.Request=Le,g.Response=ke),l.Headers=z,l.Request=Le,l.Response=ke,l.fetch=_r,Object.defineProperty(l,"__esModule",{value:!0}),l})({})})(s),s.fetch.ponyfill=!0,delete s.fetch.polyfill;var a=r.fetch?r:s;t=a.fetch,t.default=a.fetch,t.fetch=a.fetch,t.Headers=a.Headers,t.Request=a.Request,t.Response=a.Response,o.exports=t})(qc,qc.exports);var P1=qc.exports;const Ql=Hc(P1);var S1=Object.defineProperty,O1=Object.defineProperties,R1=Object.getOwnPropertyDescriptors,Jl=Object.getOwnPropertySymbols,T1=Object.prototype.hasOwnProperty,A1=Object.prototype.propertyIsEnumerable,Yl=(o,t,r)=>t in o?S1(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,Zl=(o,t)=>{for(var r in t||(t={}))T1.call(t,r)&&Yl(o,r,t[r]);if(Jl)for(var r of Jl(t))A1.call(t,r)&&Yl(o,r,t[r]);return o},Xl=(o,t)=>O1(o,R1(t));const x1={Accept:"application/json","Content-Type":"application/json"},C1="POST",ef={headers:x1,method:C1},tf=10;let Lr=class{constructor(t,r=!1){if(this.url=t,this.disableProviderPing=r,this.events=new Ut.EventEmitter,this.isAvailable=!1,this.registering=!1,!rl(t))throw new Error(`Provided URL is not compatible with HTTP connection: ${t}`);this.url=t,this.disableProviderPing=r}get connected(){return this.isAvailable}get connecting(){return this.registering}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async open(t=this.url){await this.register(t)}async close(){if(!this.isAvailable)throw new Error("Connection already closed");this.onClose()}async send(t){this.isAvailable||await this.register();try{const r=Ji(t),s=await(await Ql(this.url,Xl(Zl({},ef),{body:r}))).json();this.onPayload({data:s})}catch(r){this.onError(t.id,r)}}async register(t=this.url){if(!rl(t))throw new Error(`Provided URL is not compatible with HTTP connection: ${t}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((s,a)=>{this.events.once("register_error",u=>{this.resetMaxListeners(),a(u)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.isAvailable>"u")return a(new Error("HTTP connection is missing or invalid"));s()})})}this.url=t,this.registering=!0;try{if(!this.disableProviderPing){const r=Ji({id:1,jsonrpc:"2.0",method:"test",params:[]});await Ql(t,Xl(Zl({},ef),{body:r}))}this.onOpen()}catch(r){const s=this.parseError(r);throw this.events.emit("register_error",s),this.onClose(),s}}onOpen(){this.isAvailable=!0,this.registering=!1,this.events.emit("open")}onClose(){this.isAvailable=!1,this.registering=!1,this.events.emit("close")}onPayload(t){if(typeof t.data>"u")return;const r=typeof t.data=="string"?Hs(t.data):t.data;this.events.emit("payload",r)}onError(t,r){const s=this.parseError(r),a=s.message||s.toString(),u=wo(t,a);this.events.emit("payload",u)}parseError(t,r=this.url){return _f(t,r,"HTTP")}resetMaxListeners(){this.events.getMaxListeners()>tf&&this.events.setMaxListeners(tf)}};const rf="error",N1="wss://relay.walletconnect.com",$1="wc",D1="universal_provider",sf=`${$1}@2:${D1}:`,q1="https://rpc.walletconnect.com/v1/",wr={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};var qs=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof de<"u"?de:typeof self<"u"?self:{},jc={exports:{}};/**
* @license
* Lodash <https://lodash.com/>
* Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
* Released under MIT license <https://lodash.com/license>
* Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
* Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
*/(function(o,t){(function(){var r,s="4.17.21",a=200,u="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",l="Expected a function",g="Invalid `variable` option passed into `_.template`",w="__lodash_hash_undefined__",y=500,E="__lodash_placeholder__",P=1,S=2,q=4,D=1,z=2,ne=1,Z=2,ge=4,te=8,ie=16,he=32,Te=64,Ee=128,Me=256,Le=512,zr=30,gi="...",ke=800,ts=16,_r=1,O=2,$=3,F=1/0,oe=9007199254740991,ve=17976931348623157e292,J=NaN,Ge=4294967295,Hr=Ge-1,yi=Ge>>>1,xe=[["ary",Ee],["bind",ne],["bindKey",Z],["curry",te],["curryRight",ie],["flip",Le],["partial",he],["partialRight",Te],["rearg",Me]],X="[object Arguments]",kr="[object Array]",Oo="[object AsyncFunction]",Xe="[object Boolean]",br="[object Date]",Bs="[object DOMException]",Kr="[object Error]",Er="[object Function]",rs="[object GeneratorFunction]",ot="[object Map]",Vr="[object Number]",Ro="[object Null]",Mt="[object Object]",Fs="[object Promise]",To="[object Proxy]",Br="[object RegExp]",vt="[object Set]",Fr="[object String]",vi="[object Symbol]",Ao="[object Undefined]",Gr="[object WeakMap]",xo="[object WeakSet]",Wt="[object ArrayBuffer]",Qt="[object DataView]",mi="[object Float32Array]",at="[object Float64Array]",wi="[object Int8Array]",_i="[object Int16Array]",is="[object Int32Array]",bi="[object Uint8Array]",Ir="[object Uint8ClampedArray]",Ei="[object Uint16Array]",Ii="[object Uint32Array]",Co=/\b__p \+= '';/g,ir=/\b(__p \+=) '' \+/g,Gs=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Ws=/&(?:amp|lt|gt|quot|#39);/g,Qs=/[&<>"']/g,ss=RegExp(Ws.source),Wr=RegExp(Qs.source),ns=/<%-([\s\S]+?)%>/g,os=/<%([\s\S]+?)%>/g,Pi=/<%=([\s\S]+?)%>/g,Qr=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,No=/^\w*$/,$o=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,as=/[\\^$.*+?()[\]{}|]/g,Do=RegExp(as.source),cs=/^\s+/,Js=/\s/,us=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,sr=/\{\n\/\* \[wrapped with (.+)\] \*/,qo=/,? & /,jo=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Uo=/[()=,{}\[\]\/\s]/,Mo=/\\(\\)?/g,Lo=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Ot=/\w*$/,zo=/^[-+]0x[0-9a-f]+$/i,Ho=/^0b[01]+$/i,ko=/^\[object .+?Constructor\]$/,Ko=/^0o[0-7]+$/i,Vo=/^(?:0|[1-9]\d*)$/,nr=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Si=/($^)/,Bo=/['\n\r\u2028\u2029\\]/g,Oi="\\ud800-\\udfff",Fo="\\u0300-\\u036f",Go="\\ufe20-\\ufe2f",Ri="\\u20d0-\\u20ff",Ys=Fo+Go+Ri,Zs="\\u2700-\\u27bf",Lt="a-z\\xdf-\\xf6\\xf8-\\xff",Wo="\\xac\\xb1\\xd7\\xf7",Qo="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Jo="\\u2000-\\u206f",Yo=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Xs="A-Z\\xc0-\\xd6\\xd8-\\xde",en="\\ufe0e\\ufe0f",Jr=Wo+Qo+Jo+Yo,hs="['’]",Yr="["+Oi+"]",ls="["+Jr+"]",Zr="["+Ys+"]",tn="\\d+",Zo="["+Zs+"]",rn="["+Lt+"]",sn="[^"+Oi+Jr+tn+Zs+Lt+Xs+"]",Ti="\\ud83c[\\udffb-\\udfff]",Xo="(?:"+Zr+"|"+Ti+")",nn="[^"+Oi+"]",Ai="(?:\\ud83c[\\udde6-\\uddff]){2}",Pr="[\\ud800-\\udbff][\\udc00-\\udfff]",mt="["+Xs+"]",on="\\u200d",an="(?:"+rn+"|"+sn+")",Jt="(?:"+mt+"|"+sn+")",cn="(?:"+hs+"(?:d|ll|m|re|s|t|ve))?",un="(?:"+hs+"(?:D|LL|M|RE|S|T|VE))?",hn=Xo+"?",ln="["+en+"]?",ea="(?:"+on+"(?:"+[nn,Ai,Pr].join("|")+")"+ln+hn+")*",or="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",fn="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",pn=ln+hn+ea,xi="(?:"+[Zo,Ai,Pr].join("|")+")"+pn,ta="(?:"+[nn+Zr+"?",Zr,Ai,Pr,Yr].join("|")+")",fs=RegExp(hs,"g"),ra=RegExp(Zr,"g"),Ci=RegExp(Ti+"(?="+Ti+")|"+ta+pn,"g"),dn=RegExp([mt+"?"+rn+"+"+cn+"(?="+[ls,mt,"$"].join("|")+")",Jt+"+"+un+"(?="+[ls,mt+an,"$"].join("|")+")",mt+"?"+an+"+"+cn,mt+"+"+un,fn,or,tn,xi].join("|"),"g"),gn=RegExp("["+on+Oi+Ys+en+"]"),Xr=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,yn=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],ia=-1,me={};me[mi]=me[at]=me[wi]=me[_i]=me[is]=me[bi]=me[Ir]=me[Ei]=me[Ii]=!0,me[X]=me[kr]=me[Wt]=me[Xe]=me[Qt]=me[br]=me[Kr]=me[Er]=me[ot]=me[Vr]=me[Mt]=me[Br]=me[vt]=me[Fr]=me[Gr]=!1;var ye={};ye[X]=ye[kr]=ye[Wt]=ye[Qt]=ye[Xe]=ye[br]=ye[mi]=ye[at]=ye[wi]=ye[_i]=ye[is]=ye[ot]=ye[Vr]=ye[Mt]=ye[Br]=ye[vt]=ye[Fr]=ye[vi]=ye[bi]=ye[Ir]=ye[Ei]=ye[Ii]=!0,ye[Kr]=ye[Er]=ye[Gr]=!1;var d={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"},_={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},C={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},M={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},we=parseFloat,W=parseInt,Ie=typeof qs=="object"&&qs&&qs.Object===Object&&qs,qe=typeof self=="object"&&self&&self.Object===Object&&self,ce=Ie||qe||Function("return this")(),_e=t&&!t.nodeType&&t,Ce=_e&&!0&&o&&!o.nodeType&&o,ct=Ce&&Ce.exports===_e,je=ct&&Ie.process,Pe=function(){try{var b=Ce&&Ce.require&&Ce.require("util").types;return b||je&&je.binding&&je.binding("util")}catch{}}(),et=Pe&&Pe.isArrayBuffer,zt=Pe&&Pe.isDate,Rt=Pe&&Pe.isMap,Yt=Pe&&Pe.isRegExp,ps=Pe&&Pe.isSet,ei=Pe&&Pe.isTypedArray;function Ke(b,T,R){switch(R.length){case 0:return b.call(T);case 1:return b.call(T,R[0]);case 2:return b.call(T,R[0],R[1]);case 3:return b.call(T,R[0],R[1],R[2])}return b.apply(T,R)}function rp(b,T,R,L){for(var G=-1,le=b==null?0:b.length;++G<le;){var ze=b[G];T(L,ze,R(ze),b)}return L}function Tt(b,T){for(var R=-1,L=b==null?0:b.length;++R<L&&T(b[R],R,b)!==!1;);return b}function ip(b,T){for(var R=b==null?0:b.length;R--&&T(b[R],R,b)!==!1;);return b}function Xc(b,T){for(var R=-1,L=b==null?0:b.length;++R<L;)if(!T(b[R],R,b))return!1;return!0}function Sr(b,T){for(var R=-1,L=b==null?0:b.length,G=0,le=[];++R<L;){var ze=b[R];T(ze,R,b)&&(le[G++]=ze)}return le}function vn(b,T){var R=b==null?0:b.length;return!!R&&Ni(b,T,0)>-1}function sa(b,T,R){for(var L=-1,G=b==null?0:b.length;++L<G;)if(R(T,b[L]))return!0;return!1}function Se(b,T){for(var R=-1,L=b==null?0:b.length,G=Array(L);++R<L;)G[R]=T(b[R],R,b);return G}function Or(b,T){for(var R=-1,L=T.length,G=b.length;++R<L;)b[G+R]=T[R];return b}function na(b,T,R,L){var G=-1,le=b==null?0:b.length;for(L&&le&&(R=b[++G]);++G<le;)R=T(R,b[G],G,b);return R}function sp(b,T,R,L){var G=b==null?0:b.length;for(L&&G&&(R=b[--G]);G--;)R=T(R,b[G],G,b);return R}function oa(b,T){for(var R=-1,L=b==null?0:b.length;++R<L;)if(T(b[R],R,b))return!0;return!1}var np=aa("length");function op(b){return b.split("")}function ap(b){return b.match(jo)||[]}function eu(b,T,R){var L;return R(b,function(G,le,ze){if(T(G,le,ze))return L=le,!1}),L}function mn(b,T,R,L){for(var G=b.length,le=R+(L?1:-1);L?le--:++le<G;)if(T(b[le],le,b))return le;return-1}function Ni(b,T,R){return T===T?wp(b,T,R):mn(b,tu,R)}function cp(b,T,R,L){for(var G=R-1,le=b.length;++G<le;)if(L(b[G],T))return G;return-1}function tu(b){return b!==b}function ru(b,T){var R=b==null?0:b.length;return R?ua(b,T)/R:J}function aa(b){return function(T){return T==null?r:T[b]}}function ca(b){return function(T){return b==null?r:b[T]}}function iu(b,T,R,L,G){return G(b,function(le,ze,be){R=L?(L=!1,le):T(R,le,ze,be)}),R}function up(b,T){var R=b.length;for(b.sort(T);R--;)b[R]=b[R].value;return b}function ua(b,T){for(var R,L=-1,G=b.length;++L<G;){var le=T(b[L]);le!==r&&(R=R===r?le:R+le)}return R}function ha(b,T){for(var R=-1,L=Array(b);++R<b;)L[R]=T(R);return L}function hp(b,T){return Se(T,function(R){return[R,b[R]]})}function su(b){return b&&b.slice(0,cu(b)+1).replace(cs,"")}function wt(b){return function(T){return b(T)}}function la(b,T){return Se(T,function(R){return b[R]})}function ds(b,T){return b.has(T)}function nu(b,T){for(var R=-1,L=b.length;++R<L&&Ni(T,b[R],0)>-1;);return R}function ou(b,T){for(var R=b.length;R--&&Ni(T,b[R],0)>-1;);return R}function lp(b,T){for(var R=b.length,L=0;R--;)b[R]===T&&++L;return L}var fp=ca(d),pp=ca(_);function dp(b){return"\\"+M[b]}function gp(b,T){return b==null?r:b[T]}function $i(b){return gn.test(b)}function yp(b){return Xr.test(b)}function vp(b){for(var T,R=[];!(T=b.next()).done;)R.push(T.value);return R}function fa(b){var T=-1,R=Array(b.size);return b.forEach(function(L,G){R[++T]=[G,L]}),R}function au(b,T){return function(R){return b(T(R))}}function Rr(b,T){for(var R=-1,L=b.length,G=0,le=[];++R<L;){var ze=b[R];(ze===T||ze===E)&&(b[R]=E,le[G++]=R)}return le}function wn(b){var T=-1,R=Array(b.size);return b.forEach(function(L){R[++T]=L}),R}function mp(b){var T=-1,R=Array(b.size);return b.forEach(function(L){R[++T]=[L,L]}),R}function wp(b,T,R){for(var L=R-1,G=b.length;++L<G;)if(b[L]===T)return L;return-1}function _p(b,T,R){for(var L=R+1;L--;)if(b[L]===T)return L;return L}function Di(b){return $i(b)?Ep(b):np(b)}function Ht(b){return $i(b)?Ip(b):op(b)}function cu(b){for(var T=b.length;T--&&Js.test(b.charAt(T)););return T}var bp=ca(C);function Ep(b){for(var T=Ci.lastIndex=0;Ci.test(b);)++T;return T}function Ip(b){return b.match(Ci)||[]}function Pp(b){return b.match(dn)||[]}var Sp=function b(T){T=T==null?ce:qi.defaults(ce.Object(),T,qi.pick(ce,yn));var R=T.Array,L=T.Date,G=T.Error,le=T.Function,ze=T.Math,be=T.Object,pa=T.RegExp,Op=T.String,At=T.TypeError,_n=R.prototype,Rp=le.prototype,ji=be.prototype,bn=T["__core-js_shared__"],En=Rp.toString,pe=ji.hasOwnProperty,Tp=0,uu=function(){var e=/[^.]+$/.exec(bn&&bn.keys&&bn.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),In=ji.toString,Ap=En.call(be),xp=ce._,Cp=pa("^"+En.call(pe).replace(as,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Pn=ct?T.Buffer:r,Tr=T.Symbol,Sn=T.Uint8Array,hu=Pn?Pn.allocUnsafe:r,On=au(be.getPrototypeOf,be),lu=be.create,fu=ji.propertyIsEnumerable,Rn=_n.splice,pu=Tr?Tr.isConcatSpreadable:r,gs=Tr?Tr.iterator:r,ti=Tr?Tr.toStringTag:r,Tn=function(){try{var e=oi(be,"defineProperty");return e({},"",{}),e}catch{}}(),Np=T.clearTimeout!==ce.clearTimeout&&T.clearTimeout,$p=L&&L.now!==ce.Date.now&&L.now,Dp=T.setTimeout!==ce.setTimeout&&T.setTimeout,An=ze.ceil,xn=ze.floor,da=be.getOwnPropertySymbols,qp=Pn?Pn.isBuffer:r,du=T.isFinite,jp=_n.join,Up=au(be.keys,be),He=ze.max,Je=ze.min,Mp=L.now,Lp=T.parseInt,gu=ze.random,zp=_n.reverse,ga=oi(T,"DataView"),ys=oi(T,"Map"),ya=oi(T,"Promise"),Ui=oi(T,"Set"),vs=oi(T,"WeakMap"),ms=oi(be,"create"),Cn=vs&&new vs,Mi={},Hp=ai(ga),kp=ai(ys),Kp=ai(ya),Vp=ai(Ui),Bp=ai(vs),Nn=Tr?Tr.prototype:r,ws=Nn?Nn.valueOf:r,yu=Nn?Nn.toString:r;function f(e){if(Ae(e)&&!Q(e)&&!(e instanceof ae)){if(e instanceof xt)return e;if(pe.call(e,"__wrapped__"))return vh(e)}return new xt(e)}var Li=function(){function e(){}return function(i){if(!Re(i))return{};if(lu)return lu(i);e.prototype=i;var n=new e;return e.prototype=r,n}}();function $n(){}function xt(e,i){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!i,this.__index__=0,this.__values__=r}f.templateSettings={escape:ns,evaluate:os,interpolate:Pi,variable:"",imports:{_:f}},f.prototype=$n.prototype,f.prototype.constructor=f,xt.prototype=Li($n.prototype),xt.prototype.constructor=xt;function ae(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=Ge,this.__views__=[]}function Fp(){var e=new ae(this.__wrapped__);return e.__actions__=ut(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=ut(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=ut(this.__views__),e}function Gp(){if(this.__filtered__){var e=new ae(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e}function Wp(){var e=this.__wrapped__.value(),i=this.__dir__,n=Q(e),c=i<0,h=n?e.length:0,p=og(0,h,this.__views__),v=p.start,m=p.end,I=m-v,A=c?m:v-1,x=this.__iteratees__,N=x.length,U=0,H=Je(I,this.__takeCount__);if(!n||!c&&h==I&&H==I)return zu(e,this.__actions__);var V=[];e:for(;I--&&U<H;){A+=i;for(var ee=-1,B=e[A];++ee<N;){var se=x[ee],ue=se.iteratee,Et=se.type,it=ue(B);if(Et==O)B=it;else if(!it){if(Et==_r)continue e;break e}}V[U++]=B}return V}ae.prototype=Li($n.prototype),ae.prototype.constructor=ae;function ri(e){var i=-1,n=e==null?0:e.length;for(this.clear();++i<n;){var c=e[i];this.set(c[0],c[1])}}function Qp(){this.__data__=ms?ms(null):{},this.size=0}function Jp(e){var i=this.has(e)&&delete this.__data__[e];return this.size-=i?1:0,i}function Yp(e){var i=this.__data__;if(ms){var n=i[e];return n===w?r:n}return pe.call(i,e)?i[e]:r}function Zp(e){var i=this.__data__;return ms?i[e]!==r:pe.call(i,e)}function Xp(e,i){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=ms&&i===r?w:i,this}ri.prototype.clear=Qp,ri.prototype.delete=Jp,ri.prototype.get=Yp,ri.prototype.has=Zp,ri.prototype.set=Xp;function ar(e){var i=-1,n=e==null?0:e.length;for(this.clear();++i<n;){var c=e[i];this.set(c[0],c[1])}}function ed(){this.__data__=[],this.size=0}function td(e){var i=this.__data__,n=Dn(i,e);if(n<0)return!1;var c=i.length-1;return n==c?i.pop():Rn.call(i,n,1),--this.size,!0}function rd(e){var i=this.__data__,n=Dn(i,e);return n<0?r:i[n][1]}function id(e){return Dn(this.__data__,e)>-1}function sd(e,i){var n=this.__data__,c=Dn(n,e);return c<0?(++this.size,n.push([e,i])):n[c][1]=i,this}ar.prototype.clear=ed,ar.prototype.delete=td,ar.prototype.get=rd,ar.prototype.has=id,ar.prototype.set=sd;function cr(e){var i=-1,n=e==null?0:e.length;for(this.clear();++i<n;){var c=e[i];this.set(c[0],c[1])}}function nd(){this.size=0,this.__data__={hash:new ri,map:new(ys||ar),string:new ri}}function od(e){var i=Fn(this,e).delete(e);return this.size-=i?1:0,i}function ad(e){return Fn(this,e).get(e)}function cd(e){return Fn(this,e).has(e)}function ud(e,i){var n=Fn(this,e),c=n.size;return n.set(e,i),this.size+=n.size==c?0:1,this}cr.prototype.clear=nd,cr.prototype.delete=od,cr.prototype.get=ad,cr.prototype.has=cd,cr.prototype.set=ud;function ii(e){var i=-1,n=e==null?0:e.length;for(this.__data__=new cr;++i<n;)this.add(e[i])}function hd(e){return this.__data__.set(e,w),this}function ld(e){return this.__data__.has(e)}ii.prototype.add=ii.prototype.push=hd,ii.prototype.has=ld;function kt(e){var i=this.__data__=new ar(e);this.size=i.size}function fd(){this.__data__=new ar,this.size=0}function pd(e){var i=this.__data__,n=i.delete(e);return this.size=i.size,n}function dd(e){return this.__data__.get(e)}function gd(e){return this.__data__.has(e)}function yd(e,i){var n=this.__data__;if(n instanceof ar){var c=n.__data__;if(!ys||c.length<a-1)return c.push([e,i]),this.size=++n.size,this;n=this.__data__=new cr(c)}return n.set(e,i),this.size=n.size,this}kt.prototype.clear=fd,kt.prototype.delete=pd,kt.prototype.get=dd,kt.prototype.has=gd,kt.prototype.set=yd;function vu(e,i){var n=Q(e),c=!n&&ci(e),h=!n&&!c&&$r(e),p=!n&&!c&&!h&&Ki(e),v=n||c||h||p,m=v?ha(e.length,Op):[],I=m.length;for(var A in e)(i||pe.call(e,A))&&!(v&&(A=="length"||h&&(A=="offset"||A=="parent")||p&&(A=="buffer"||A=="byteLength"||A=="byteOffset")||fr(A,I)))&&m.push(A);return m}function mu(e){var i=e.length;return i?e[Ra(0,i-1)]:r}function vd(e,i){return Gn(ut(e),si(i,0,e.length))}function md(e){return Gn(ut(e))}function va(e,i,n){(n!==r&&!Kt(e[i],n)||n===r&&!(i in e))&&ur(e,i,n)}function _s(e,i,n){var c=e[i];(!(pe.call(e,i)&&Kt(c,n))||n===r&&!(i in e))&&ur(e,i,n)}function Dn(e,i){for(var n=e.length;n--;)if(Kt(e[n][0],i))return n;return-1}function wd(e,i,n,c){return Ar(e,function(h,p,v){i(c,h,n(h),v)}),c}function wu(e,i){return e&&Xt(i,Ve(i),e)}function _d(e,i){return e&&Xt(i,lt(i),e)}function ur(e,i,n){i=="__proto__"&&Tn?Tn(e,i,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[i]=n}function ma(e,i){for(var n=-1,c=i.length,h=R(c),p=e==null;++n<c;)h[n]=p?r:Za(e,i[n]);return h}function si(e,i,n){return e===e&&(n!==r&&(e=e<=n?e:n),i!==r&&(e=e>=i?e:i)),e}function Ct(e,i,n,c,h,p){var v,m=i&P,I=i&S,A=i&q;if(n&&(v=h?n(e,c,h,p):n(e)),v!==r)return v;if(!Re(e))return e;var x=Q(e);if(x){if(v=cg(e),!m)return ut(e,v)}else{var N=Ye(e),U=N==Er||N==rs;if($r(e))return Ku(e,m);if(N==Mt||N==X||U&&!h){if(v=I||U?{}:ch(e),!m)return I?Yd(e,_d(v,e)):Jd(e,wu(v,e))}else{if(!ye[N])return h?e:{};v=ug(e,N,m)}}p||(p=new kt);var H=p.get(e);if(H)return H;p.set(e,v),Uh(e)?e.forEach(function(B){v.add(Ct(B,i,n,B,e,p))}):qh(e)&&e.forEach(function(B,se){v.set(se,Ct(B,i,n,se,e,p))});var V=A?I?Ma:Ua:I?lt:Ve,ee=x?r:V(e);return Tt(ee||e,function(B,se){ee&&(se=B,B=e[se]),_s(v,se,Ct(B,i,n,se,e,p))}),v}function bd(e){var i=Ve(e);return function(n){return _u(n,e,i)}}function _u(e,i,n){var c=n.length;if(e==null)return!c;for(e=be(e);c--;){var h=n[c],p=i[h],v=e[h];if(v===r&&!(h in e)||!p(v))return!1}return!0}function bu(e,i,n){if(typeof e!="function")throw new At(l);return Rs(function(){e.apply(r,n)},i)}function bs(e,i,n,c){var h=-1,p=vn,v=!0,m=e.length,I=[],A=i.length;if(!m)return I;n&&(i=Se(i,wt(n))),c?(p=sa,v=!1):i.length>=a&&(p=ds,v=!1,i=new ii(i));e:for(;++h<m;){var x=e[h],N=n==null?x:n(x);if(x=c||x!==0?x:0,v&&N===N){for(var U=A;U--;)if(i[U]===N)continue e;I.push(x)}else p(i,N,c)||I.push(x)}return I}var Ar=Wu(Zt),Eu=Wu(_a,!0);function Ed(e,i){var n=!0;return Ar(e,function(c,h,p){return n=!!i(c,h,p),n}),n}function qn(e,i,n){for(var c=-1,h=e.length;++c<h;){var p=e[c],v=i(p);if(v!=null&&(m===r?v===v&&!bt(v):n(v,m)))var m=v,I=p}return I}function Id(e,i,n,c){var h=e.length;for(n=Y(n),n<0&&(n=-n>h?0:h+n),c=c===r||c>h?h:Y(c),c<0&&(c+=h),c=n>c?0:Lh(c);n<c;)e[n++]=i;return e}function Iu(e,i){var n=[];return Ar(e,function(c,h,p){i(c,h,p)&&n.push(c)}),n}function We(e,i,n,c,h){var p=-1,v=e.length;for(n||(n=lg),h||(h=[]);++p<v;){var m=e[p];i>0&&n(m)?i>1?We(m,i-1,n,c,h):Or(h,m):c||(h[h.length]=m)}return h}var wa=Qu(),Pu=Qu(!0);function Zt(e,i){return e&&wa(e,i,Ve)}function _a(e,i){return e&&Pu(e,i,Ve)}function jn(e,i){return Sr(i,function(n){return pr(e[n])})}function ni(e,i){i=Cr(i,e);for(var n=0,c=i.length;e!=null&&n<c;)e=e[er(i[n++])];return n&&n==c?e:r}function Su(e,i,n){var c=i(e);return Q(e)?c:Or(c,n(e))}function tt(e){return e==null?e===r?Ao:Ro:ti&&ti in be(e)?ng(e):mg(e)}function ba(e,i){return e>i}function Pd(e,i){return e!=null&&pe.call(e,i)}function Sd(e,i){return e!=null&&i in be(e)}function Od(e,i,n){return e>=Je(i,n)&&e<He(i,n)}function Ea(e,i,n){for(var c=n?sa:vn,h=e[0].length,p=e.length,v=p,m=R(p),I=1/0,A=[];v--;){var x=e[v];v&&i&&(x=Se(x,wt(i))),I=Je(x.length,I),m[v]=!n&&(i||h>=120&&x.length>=120)?new ii(v&&x):r}x=e[0];var N=-1,U=m[0];e:for(;++N<h&&A.length<I;){var H=x[N],V=i?i(H):H;if(H=n||H!==0?H:0,!(U?ds(U,V):c(A,V,n))){for(v=p;--v;){var ee=m[v];if(!(ee?ds(ee,V):c(e[v],V,n)))continue e}U&&U.push(V),A.push(H)}}return A}function Rd(e,i,n,c){return Zt(e,function(h,p,v){i(c,n(h),p,v)}),c}function Es(e,i,n){i=Cr(i,e),e=fh(e,i);var c=e==null?e:e[er($t(i))];return c==null?r:Ke(c,e,n)}function Ou(e){return Ae(e)&&tt(e)==X}function Td(e){return Ae(e)&&tt(e)==Wt}function Ad(e){return Ae(e)&&tt(e)==br}function Is(e,i,n,c,h){return e===i?!0:e==null||i==null||!Ae(e)&&!Ae(i)?e!==e&&i!==i:xd(e,i,n,c,Is,h)}function xd(e,i,n,c,h,p){var v=Q(e),m=Q(i),I=v?kr:Ye(e),A=m?kr:Ye(i);I=I==X?Mt:I,A=A==X?Mt:A;var x=I==Mt,N=A==Mt,U=I==A;if(U&&$r(e)){if(!$r(i))return!1;v=!0,x=!1}if(U&&!x)return p||(p=new kt),v||Ki(e)?nh(e,i,n,c,h,p):ig(e,i,I,n,c,h,p);if(!(n&D)){var H=x&&pe.call(e,"__wrapped__"),V=N&&pe.call(i,"__wrapped__");if(H||V){var ee=H?e.value():e,B=V?i.value():i;return p||(p=new kt),h(ee,B,n,c,p)}}return U?(p||(p=new kt),sg(e,i,n,c,h,p)):!1}function Cd(e){return Ae(e)&&Ye(e)==ot}function Ia(e,i,n,c){var h=n.length,p=h,v=!c;if(e==null)return!p;for(e=be(e);h--;){var m=n[h];if(v&&m[2]?m[1]!==e[m[0]]:!(m[0]in e))return!1}for(;++h<p;){m=n[h];var I=m[0],A=e[I],x=m[1];if(v&&m[2]){if(A===r&&!(I in e))return!1}else{var N=new kt;if(c)var U=c(A,x,I,e,i,N);if(!(U===r?Is(x,A,D|z,c,N):U))return!1}}return!0}function Ru(e){if(!Re(e)||pg(e))return!1;var i=pr(e)?Cp:ko;return i.test(ai(e))}function Nd(e){return Ae(e)&&tt(e)==Br}function $d(e){return Ae(e)&&Ye(e)==vt}function Dd(e){return Ae(e)&&Xn(e.length)&&!!me[tt(e)]}function Tu(e){return typeof e=="function"?e:e==null?ft:typeof e=="object"?Q(e)?Cu(e[0],e[1]):xu(e):Jh(e)}function Pa(e){if(!Os(e))return Up(e);var i=[];for(var n in be(e))pe.call(e,n)&&n!="constructor"&&i.push(n);return i}function qd(e){if(!Re(e))return vg(e);var i=Os(e),n=[];for(var c in e)c=="constructor"&&(i||!pe.call(e,c))||n.push(c);return n}function Sa(e,i){return e<i}function Au(e,i){var n=-1,c=ht(e)?R(e.length):[];return Ar(e,function(h,p,v){c[++n]=i(h,p,v)}),c}function xu(e){var i=za(e);return i.length==1&&i[0][2]?hh(i[0][0],i[0][1]):function(n){return n===e||Ia(n,e,i)}}function Cu(e,i){return ka(e)&&uh(i)?hh(er(e),i):function(n){var c=Za(n,e);return c===r&&c===i?Xa(n,e):Is(i,c,D|z)}}function Un(e,i,n,c,h){e!==i&&wa(i,function(p,v){if(h||(h=new kt),Re(p))jd(e,i,v,n,Un,c,h);else{var m=c?c(Va(e,v),p,v+"",e,i,h):r;m===r&&(m=p),va(e,v,m)}},lt)}function jd(e,i,n,c,h,p,v){var m=Va(e,n),I=Va(i,n),A=v.get(I);if(A){va(e,n,A);return}var x=p?p(m,I,n+"",e,i,v):r,N=x===r;if(N){var U=Q(I),H=!U&&$r(I),V=!U&&!H&&Ki(I);x=I,U||H||V?Q(m)?x=m:Ne(m)?x=ut(m):H?(N=!1,x=Ku(I,!0)):V?(N=!1,x=Vu(I,!0)):x=[]:Ts(I)||ci(I)?(x=m,ci(m)?x=zh(m):(!Re(m)||pr(m))&&(x=ch(I))):N=!1}N&&(v.set(I,x),h(x,I,c,p,v),v.delete(I)),va(e,n,x)}function Nu(e,i){var n=e.length;if(n)return i+=i<0?n:0,fr(i,n)?e[i]:r}function $u(e,i,n){i.length?i=Se(i,function(p){return Q(p)?function(v){return ni(v,p.length===1?p[0]:p)}:p}):i=[ft];var c=-1;i=Se(i,wt(K()));var h=Au(e,function(p,v,m){var I=Se(i,function(A){return A(p)});return{criteria:I,index:++c,value:p}});return up(h,function(p,v){return Qd(p,v,n)})}function Ud(e,i){return Du(e,i,function(n,c){return Xa(e,c)})}function Du(e,i,n){for(var c=-1,h=i.length,p={};++c<h;){var v=i[c],m=ni(e,v);n(m,v)&&Ps(p,Cr(v,e),m)}return p}function Md(e){return function(i){return ni(i,e)}}function Oa(e,i,n,c){var h=c?cp:Ni,p=-1,v=i.length,m=e;for(e===i&&(i=ut(i)),n&&(m=Se(e,wt(n)));++p<v;)for(var I=0,A=i[p],x=n?n(A):A;(I=h(m,x,I,c))>-1;)m!==e&&Rn.call(m,I,1),Rn.call(e,I,1);return e}function qu(e,i){for(var n=e?i.length:0,c=n-1;n--;){var h=i[n];if(n==c||h!==p){var p=h;fr(h)?Rn.call(e,h,1):xa(e,h)}}return e}function Ra(e,i){return e+xn(gu()*(i-e+1))}function Ld(e,i,n,c){for(var h=-1,p=He(An((i-e)/(n||1)),0),v=R(p);p--;)v[c?p:++h]=e,e+=n;return v}function Ta(e,i){var n="";if(!e||i<1||i>oe)return n;do i%2&&(n+=e),i=xn(i/2),i&&(e+=e);while(i);return n}function re(e,i){return Ba(lh(e,i,ft),e+"")}function zd(e){return mu(Vi(e))}function Hd(e,i){var n=Vi(e);return Gn(n,si(i,0,n.length))}function Ps(e,i,n,c){if(!Re(e))return e;i=Cr(i,e);for(var h=-1,p=i.length,v=p-1,m=e;m!=null&&++h<p;){var I=er(i[h]),A=n;if(I==="__proto__"||I==="constructor"||I==="prototype")return e;if(h!=v){var x=m[I];A=c?c(x,I,m):r,A===r&&(A=Re(x)?x:fr(i[h+1])?[]:{})}_s(m,I,A),m=m[I]}return e}var ju=Cn?function(e,i){return Cn.set(e,i),e}:ft,kd=Tn?function(e,i){return Tn(e,"toString",{configurable:!0,enumerable:!1,value:tc(i),writable:!0})}:ft;function Kd(e){return Gn(Vi(e))}function Nt(e,i,n){var c=-1,h=e.length;i<0&&(i=-i>h?0:h+i),n=n>h?h:n,n<0&&(n+=h),h=i>n?0:n-i>>>0,i>>>=0;for(var p=R(h);++c<h;)p[c]=e[c+i];return p}function Vd(e,i){var n;return Ar(e,function(c,h,p){return n=i(c,h,p),!n}),!!n}function Mn(e,i,n){var c=0,h=e==null?c:e.length;if(typeof i=="number"&&i===i&&h<=yi){for(;c<h;){var p=c+h>>>1,v=e[p];v!==null&&!bt(v)&&(n?v<=i:v<i)?c=p+1:h=p}return h}return Aa(e,i,ft,n)}function Aa(e,i,n,c){var h=0,p=e==null?0:e.length;if(p===0)return 0;i=n(i);for(var v=i!==i,m=i===null,I=bt(i),A=i===r;h<p;){var x=xn((h+p)/2),N=n(e[x]),U=N!==r,H=N===null,V=N===N,ee=bt(N);if(v)var B=c||V;else A?B=V&&(c||U):m?B=V&&U&&(c||!H):I?B=V&&U&&!H&&(c||!ee):H||ee?B=!1:B=c?N<=i:N<i;B?h=x+1:p=x}return Je(p,Hr)}function Uu(e,i){for(var n=-1,c=e.length,h=0,p=[];++n<c;){var v=e[n],m=i?i(v):v;if(!n||!Kt(m,I)){var I=m;p[h++]=v===0?0:v}}return p}function Mu(e){return typeof e=="number"?e:bt(e)?J:+e}function _t(e){if(typeof e=="string")return e;if(Q(e))return Se(e,_t)+"";if(bt(e))return yu?yu.call(e):"";var i=e+"";return i=="0"&&1/e==-1/0?"-0":i}function xr(e,i,n){var c=-1,h=vn,p=e.length,v=!0,m=[],I=m;if(n)v=!1,h=sa;else if(p>=a){var A=i?null:tg(e);if(A)return wn(A);v=!1,h=ds,I=new ii}else I=i?[]:m;e:for(;++c<p;){var x=e[c],N=i?i(x):x;if(x=n||x!==0?x:0,v&&N===N){for(var U=I.length;U--;)if(I[U]===N)continue e;i&&I.push(N),m.push(x)}else h(I,N,n)||(I!==m&&I.push(N),m.push(x))}return m}function xa(e,i){return i=Cr(i,e),e=fh(e,i),e==null||delete e[er($t(i))]}function Lu(e,i,n,c){return Ps(e,i,n(ni(e,i)),c)}function Ln(e,i,n,c){for(var h=e.length,p=c?h:-1;(c?p--:++p<h)&&i(e[p],p,e););return n?Nt(e,c?0:p,c?p+1:h):Nt(e,c?p+1:0,c?h:p)}function zu(e,i){var n=e;return n instanceof ae&&(n=n.value()),na(i,function(c,h){return h.func.apply(h.thisArg,Or([c],h.args))},n)}function Ca(e,i,n){var c=e.length;if(c<2)return c?xr(e[0]):[];for(var h=-1,p=R(c);++h<c;)for(var v=e[h],m=-1;++m<c;)m!=h&&(p[h]=bs(p[h]||v,e[m],i,n));return xr(We(p,1),i,n)}function Hu(e,i,n){for(var c=-1,h=e.length,p=i.length,v={};++c<h;){var m=c<p?i[c]:r;n(v,e[c],m)}return v}function Na(e){return Ne(e)?e:[]}function $a(e){return typeof e=="function"?e:ft}function Cr(e,i){return Q(e)?e:ka(e,i)?[e]:yh(fe(e))}var Bd=re;function Nr(e,i,n){var c=e.length;return n=n===r?c:n,!i&&n>=c?e:Nt(e,i,n)}var ku=Np||function(e){return ce.clearTimeout(e)};function Ku(e,i){if(i)return e.slice();var n=e.length,c=hu?hu(n):new e.constructor(n);return e.copy(c),c}function Da(e){var i=new e.constructor(e.byteLength);return new Sn(i).set(new Sn(e)),i}function Fd(e,i){var n=i?Da(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}function Gd(e){var i=new e.constructor(e.source,Ot.exec(e));return i.lastIndex=e.lastIndex,i}function Wd(e){return ws?be(ws.call(e)):{}}function Vu(e,i){var n=i?Da(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}function Bu(e,i){if(e!==i){var n=e!==r,c=e===null,h=e===e,p=bt(e),v=i!==r,m=i===null,I=i===i,A=bt(i);if(!m&&!A&&!p&&e>i||p&&v&&I&&!m&&!A||c&&v&&I||!n&&I||!h)return 1;if(!c&&!p&&!A&&e<i||A&&n&&h&&!c&&!p||m&&n&&h||!v&&h||!I)return-1}return 0}function Qd(e,i,n){for(var c=-1,h=e.criteria,p=i.criteria,v=h.length,m=n.length;++c<v;){var I=Bu(h[c],p[c]);if(I){if(c>=m)return I;var A=n[c];return I*(A=="desc"?-1:1)}}return e.index-i.index}function Fu(e,i,n,c){for(var h=-1,p=e.length,v=n.length,m=-1,I=i.length,A=He(p-v,0),x=R(I+A),N=!c;++m<I;)x[m]=i[m];for(;++h<v;)(N||h<p)&&(x[n[h]]=e[h]);for(;A--;)x[m++]=e[h++];return x}function Gu(e,i,n,c){for(var h=-1,p=e.length,v=-1,m=n.length,I=-1,A=i.length,x=He(p-m,0),N=R(x+A),U=!c;++h<x;)N[h]=e[h];for(var H=h;++I<A;)N[H+I]=i[I];for(;++v<m;)(U||h<p)&&(N[H+n[v]]=e[h++]);return N}function ut(e,i){var n=-1,c=e.length;for(i||(i=R(c));++n<c;)i[n]=e[n];return i}function Xt(e,i,n,c){var h=!n;n||(n={});for(var p=-1,v=i.length;++p<v;){var m=i[p],I=c?c(n[m],e[m],m,n,e):r;I===r&&(I=e[m]),h?ur(n,m,I):_s(n,m,I)}return n}function Jd(e,i){return Xt(e,Ha(e),i)}function Yd(e,i){return Xt(e,oh(e),i)}function zn(e,i){return function(n,c){var h=Q(n)?rp:wd,p=i?i():{};return h(n,e,K(c,2),p)}}function zi(e){return re(function(i,n){var c=-1,h=n.length,p=h>1?n[h-1]:r,v=h>2?n[2]:r;for(p=e.length>3&&typeof p=="function"?(h--,p):r,v&&rt(n[0],n[1],v)&&(p=h<3?r:p,h=1),i=be(i);++c<h;){var m=n[c];m&&e(i,m,c,p)}return i})}function Wu(e,i){return function(n,c){if(n==null)return n;if(!ht(n))return e(n,c);for(var h=n.length,p=i?h:-1,v=be(n);(i?p--:++p<h)&&c(v[p],p,v)!==!1;);return n}}function Qu(e){return function(i,n,c){for(var h=-1,p=be(i),v=c(i),m=v.length;m--;){var I=v[e?m:++h];if(n(p[I],I,p)===!1)break}return i}}function Zd(e,i,n){var c=i&ne,h=Ss(e);function p(){var v=this&&this!==ce&&this instanceof p?h:e;return v.apply(c?n:this,arguments)}return p}function Ju(e){return function(i){i=fe(i);var n=$i(i)?Ht(i):r,c=n?n[0]:i.charAt(0),h=n?Nr(n,1).join(""):i.slice(1);return c[e]()+h}}function Hi(e){return function(i){return na(Wh(Gh(i).replace(fs,"")),e,"")}}function Ss(e){return function(){var i=arguments;switch(i.length){case 0:return new e;case 1:return new e(i[0]);case 2:return new e(i[0],i[1]);case 3:return new e(i[0],i[1],i[2]);case 4:return new e(i[0],i[1],i[2],i[3]);case 5:return new e(i[0],i[1],i[2],i[3],i[4]);case 6:return new e(i[0],i[1],i[2],i[3],i[4],i[5]);case 7:return new e(i[0],i[1],i[2],i[3],i[4],i[5],i[6])}var n=Li(e.prototype),c=e.apply(n,i);return Re(c)?c:n}}function Xd(e,i,n){var c=Ss(e);function h(){for(var p=arguments.length,v=R(p),m=p,I=ki(h);m--;)v[m]=arguments[m];var A=p<3&&v[0]!==I&&v[p-1]!==I?[]:Rr(v,I);if(p-=A.length,p<n)return th(e,i,Hn,h.placeholder,r,v,A,r,r,n-p);var x=this&&this!==ce&&this instanceof h?c:e;return Ke(x,this,v)}return h}function Yu(e){return function(i,n,c){var h=be(i);if(!ht(i)){var p=K(n,3);i=Ve(i),n=function(m){return p(h[m],m,h)}}var v=e(i,n,c);return v>-1?h[p?i[v]:v]:r}}function Zu(e){return lr(function(i){var n=i.length,c=n,h=xt.prototype.thru;for(e&&i.reverse();c--;){var p=i[c];if(typeof p!="function")throw new At(l);if(h&&!v&&Bn(p)=="wrapper")var v=new xt([],!0)}for(c=v?c:n;++c<n;){p=i[c];var m=Bn(p),I=m=="wrapper"?La(p):r;I&&Ka(I[0])&&I[1]==(Ee|te|he|Me)&&!I[4].length&&I[9]==1?v=v[Bn(I[0])].apply(v,I[3]):v=p.length==1&&Ka(p)?v[m]():v.thru(p)}return function(){var A=arguments,x=A[0];if(v&&A.length==1&&Q(x))return v.plant(x).value();for(var N=0,U=n?i[N].apply(this,A):x;++N<n;)U=i[N].call(this,U);return U}})}function Hn(e,i,n,c,h,p,v,m,I,A){var x=i&Ee,N=i&ne,U=i&Z,H=i&(te|ie),V=i&Le,ee=U?r:Ss(e);function B(){for(var se=arguments.length,ue=R(se),Et=se;Et--;)ue[Et]=arguments[Et];if(H)var it=ki(B),It=lp(ue,it);if(c&&(ue=Fu(ue,c,h,H)),p&&(ue=Gu(ue,p,v,H)),se-=It,H&&se<A){var $e=Rr(ue,it);return th(e,i,Hn,B.placeholder,n,ue,$e,m,I,A-se)}var Vt=N?n:this,gr=U?Vt[e]:e;return se=ue.length,m?ue=wg(ue,m):V&&se>1&&ue.reverse(),x&&I<se&&(ue.length=I),this&&this!==ce&&this instanceof B&&(gr=ee||Ss(gr)),gr.apply(Vt,ue)}return B}function Xu(e,i){return function(n,c){return Rd(n,e,i(c),{})}}function kn(e,i){return function(n,c){var h;if(n===r&&c===r)return i;if(n!==r&&(h=n),c!==r){if(h===r)return c;typeof n=="string"||typeof c=="string"?(n=_t(n),c=_t(c)):(n=Mu(n),c=Mu(c)),h=e(n,c)}return h}}function qa(e){return lr(function(i){return i=Se(i,wt(K())),re(function(n){var c=this;return e(i,function(h){return Ke(h,c,n)})})})}function Kn(e,i){i=i===r?" ":_t(i);var n=i.length;if(n<2)return n?Ta(i,e):i;var c=Ta(i,An(e/Di(i)));return $i(i)?Nr(Ht(c),0,e).join(""):c.slice(0,e)}function eg(e,i,n,c){var h=i&ne,p=Ss(e);function v(){for(var m=-1,I=arguments.length,A=-1,x=c.length,N=R(x+I),U=this&&this!==ce&&this instanceof v?p:e;++A<x;)N[A]=c[A];for(;I--;)N[A++]=arguments[++m];return Ke(U,h?n:this,N)}return v}function eh(e){return function(i,n,c){return c&&typeof c!="number"&&rt(i,n,c)&&(n=c=r),i=dr(i),n===r?(n=i,i=0):n=dr(n),c=c===r?i<n?1:-1:dr(c),Ld(i,n,c,e)}}function Vn(e){return function(i,n){return typeof i=="string"&&typeof n=="string"||(i=Dt(i),n=Dt(n)),e(i,n)}}function th(e,i,n,c,h,p,v,m,I,A){var x=i&te,N=x?v:r,U=x?r:v,H=x?p:r,V=x?r:p;i|=x?he:Te,i&=~(x?Te:he),i&ge||(i&=-4);var ee=[e,i,h,H,N,V,U,m,I,A],B=n.apply(r,ee);return Ka(e)&&ph(B,ee),B.placeholder=c,dh(B,e,i)}function ja(e){var i=ze[e];return function(n,c){if(n=Dt(n),c=c==null?0:Je(Y(c),292),c&&du(n)){var h=(fe(n)+"e").split("e"),p=i(h[0]+"e"+(+h[1]+c));return h=(fe(p)+"e").split("e"),+(h[0]+"e"+(+h[1]-c))}return i(n)}}var tg=Ui&&1/wn(new Ui([,-0]))[1]==F?function(e){return new Ui(e)}:sc;function rh(e){return function(i){var n=Ye(i);return n==ot?fa(i):n==vt?mp(i):hp(i,e(i))}}function hr(e,i,n,c,h,p,v,m){var I=i&Z;if(!I&&typeof e!="function")throw new At(l);var A=c?c.length:0;if(A||(i&=-97,c=h=r),v=v===r?v:He(Y(v),0),m=m===r?m:Y(m),A-=h?h.length:0,i&Te){var x=c,N=h;c=h=r}var U=I?r:La(e),H=[e,i,n,c,h,x,N,p,v,m];if(U&&yg(H,U),e=H[0],i=H[1],n=H[2],c=H[3],h=H[4],m=H[9]=H[9]===r?I?0:e.length:He(H[9]-A,0),!m&&i&(te|ie)&&(i&=-25),!i||i==ne)var V=Zd(e,i,n);else i==te||i==ie?V=Xd(e,i,m):(i==he||i==(ne|he))&&!h.length?V=eg(e,i,n,c):V=Hn.apply(r,H);var ee=U?ju:ph;return dh(ee(V,H),e,i)}function ih(e,i,n,c){return e===r||Kt(e,ji[n])&&!pe.call(c,n)?i:e}function sh(e,i,n,c,h,p){return Re(e)&&Re(i)&&(p.set(i,e),Un(e,i,r,sh,p),p.delete(i)),e}function rg(e){return Ts(e)?r:e}function nh(e,i,n,c,h,p){var v=n&D,m=e.length,I=i.length;if(m!=I&&!(v&&I>m))return!1;var A=p.get(e),x=p.get(i);if(A&&x)return A==i&&x==e;var N=-1,U=!0,H=n&z?new ii:r;for(p.set(e,i),p.set(i,e);++N<m;){var V=e[N],ee=i[N];if(c)var B=v?c(ee,V,N,i,e,p):c(V,ee,N,e,i,p);if(B!==r){if(B)continue;U=!1;break}if(H){if(!oa(i,function(se,ue){if(!ds(H,ue)&&(V===se||h(V,se,n,c,p)))return H.push(ue)})){U=!1;break}}else if(!(V===ee||h(V,ee,n,c,p))){U=!1;break}}return p.delete(e),p.delete(i),U}function ig(e,i,n,c,h,p,v){switch(n){case Qt:if(e.byteLength!=i.byteLength||e.byteOffset!=i.byteOffset)return!1;e=e.buffer,i=i.buffer;case Wt:return!(e.byteLength!=i.byteLength||!p(new Sn(e),new Sn(i)));case Xe:case br:case Vr:return Kt(+e,+i);case Kr:return e.name==i.name&&e.message==i.message;case Br:case Fr:return e==i+"";case ot:var m=fa;case vt:var I=c&D;if(m||(m=wn),e.size!=i.size&&!I)return!1;var A=v.get(e);if(A)return A==i;c|=z,v.set(e,i);var x=nh(m(e),m(i),c,h,p,v);return v.delete(e),x;case vi:if(ws)return ws.call(e)==ws.call(i)}return!1}function sg(e,i,n,c,h,p){var v=n&D,m=Ua(e),I=m.length,A=Ua(i),x=A.length;if(I!=x&&!v)return!1;for(var N=I;N--;){var U=m[N];if(!(v?U in i:pe.call(i,U)))return!1}var H=p.get(e),V=p.get(i);if(H&&V)return H==i&&V==e;var ee=!0;p.set(e,i),p.set(i,e);for(var B=v;++N<I;){U=m[N];var se=e[U],ue=i[U];if(c)var Et=v?c(ue,se,U,i,e,p):c(se,ue,U,e,i,p);if(!(Et===r?se===ue||h(se,ue,n,c,p):Et)){ee=!1;break}B||(B=U=="constructor")}if(ee&&!B){var it=e.constructor,It=i.constructor;it!=It&&"constructor"in e&&"constructor"in i&&!(typeof it=="function"&&it instanceof it&&typeof It=="function"&&It instanceof It)&&(ee=!1)}return p.delete(e),p.delete(i),ee}function lr(e){return Ba(lh(e,r,_h),e+"")}function Ua(e){return Su(e,Ve,Ha)}function Ma(e){return Su(e,lt,oh)}var La=Cn?function(e){return Cn.get(e)}:sc;function Bn(e){for(var i=e.name+"",n=Mi[i],c=pe.call(Mi,i)?n.length:0;c--;){var h=n[c],p=h.func;if(p==null||p==e)return h.name}return i}function ki(e){var i=pe.call(f,"placeholder")?f:e;return i.placeholder}function K(){var e=f.iteratee||rc;return e=e===rc?Tu:e,arguments.length?e(arguments[0],arguments[1]):e}function Fn(e,i){var n=e.__data__;return fg(i)?n[typeof i=="string"?"string":"hash"]:n.map}function za(e){for(var i=Ve(e),n=i.length;n--;){var c=i[n],h=e[c];i[n]=[c,h,uh(h)]}return i}function oi(e,i){var n=gp(e,i);return Ru(n)?n:r}function ng(e){var i=pe.call(e,ti),n=e[ti];try{e[ti]=r;var c=!0}catch{}var h=In.call(e);return c&&(i?e[ti]=n:delete e[ti]),h}var Ha=da?function(e){return e==null?[]:(e=be(e),Sr(da(e),function(i){return fu.call(e,i)}))}:nc,oh=da?function(e){for(var i=[];e;)Or(i,Ha(e)),e=On(e);return i}:nc,Ye=tt;(ga&&Ye(new ga(new ArrayBuffer(1)))!=Qt||ys&&Ye(new ys)!=ot||ya&&Ye(ya.resolve())!=Fs||Ui&&Ye(new Ui)!=vt||vs&&Ye(new vs)!=Gr)&&(Ye=function(e){var i=tt(e),n=i==Mt?e.constructor:r,c=n?ai(n):"";if(c)switch(c){case Hp:return Qt;case kp:return ot;case Kp:return Fs;case Vp:return vt;case Bp:return Gr}return i});function og(e,i,n){for(var c=-1,h=n.length;++c<h;){var p=n[c],v=p.size;switch(p.type){case"drop":e+=v;break;case"dropRight":i-=v;break;case"take":i=Je(i,e+v);break;case"takeRight":e=He(e,i-v);break}}return{start:e,end:i}}function ag(e){var i=e.match(sr);return i?i[1].split(qo):[]}function ah(e,i,n){i=Cr(i,e);for(var c=-1,h=i.length,p=!1;++c<h;){var v=er(i[c]);if(!(p=e!=null&&n(e,v)))break;e=e[v]}return p||++c!=h?p:(h=e==null?0:e.length,!!h&&Xn(h)&&fr(v,h)&&(Q(e)||ci(e)))}function cg(e){var i=e.length,n=new e.constructor(i);return i&&typeof e[0]=="string"&&pe.call(e,"index")&&(n.index=e.index,n.input=e.input),n}function ch(e){return typeof e.constructor=="function"&&!Os(e)?Li(On(e)):{}}function ug(e,i,n){var c=e.constructor;switch(i){case Wt:return Da(e);case Xe:case br:return new c(+e);case Qt:return Fd(e,n);case mi:case at:case wi:case _i:case is:case bi:case Ir:case Ei:case Ii:return Vu(e,n);case ot:return new c;case Vr:case Fr:return new c(e);case Br:return Gd(e);case vt:return new c;case vi:return Wd(e)}}function hg(e,i){var n=i.length;if(!n)return e;var c=n-1;return i[c]=(n>1?"& ":"")+i[c],i=i.join(n>2?", ":" "),e.replace(us,`{
/* [wrapped with `+i+`] */
`)}function lg(e){return Q(e)||ci(e)||!!(pu&&e&&e[pu])}function fr(e,i){var n=typeof e;return i=i??oe,!!i&&(n=="number"||n!="symbol"&&Vo.test(e))&&e>-1&&e%1==0&&e<i}function rt(e,i,n){if(!Re(n))return!1;var c=typeof i;return(c=="number"?ht(n)&&fr(i,n.length):c=="string"&&i in n)?Kt(n[i],e):!1}function ka(e,i){if(Q(e))return!1;var n=typeof e;return n=="number"||n=="symbol"||n=="boolean"||e==null||bt(e)?!0:No.test(e)||!Qr.test(e)||i!=null&&e in be(i)}function fg(e){var i=typeof e;return i=="string"||i=="number"||i=="symbol"||i=="boolean"?e!=="__proto__":e===null}function Ka(e){var i=Bn(e),n=f[i];if(typeof n!="function"||!(i in ae.prototype))return!1;if(e===n)return!0;var c=La(n);return!!c&&e===c[0]}function pg(e){return!!uu&&uu in e}var dg=bn?pr:oc;function Os(e){var i=e&&e.constructor,n=typeof i=="function"&&i.prototype||ji;return e===n}function uh(e){return e===e&&!Re(e)}function hh(e,i){return function(n){return n==null?!1:n[e]===i&&(i!==r||e in be(n))}}function gg(e){var i=Yn(e,function(c){return n.size===y&&n.clear(),c}),n=i.cache;return i}function yg(e,i){var n=e[1],c=i[1],h=n|c,p=h<(ne|Z|Ee),v=c==Ee&&n==te||c==Ee&&n==Me&&e[7].length<=i[8]||c==(Ee|Me)&&i[7].length<=i[8]&&n==te;if(!(p||v))return e;c&ne&&(e[2]=i[2],h|=n&ne?0:ge);var m=i[3];if(m){var I=e[3];e[3]=I?Fu(I,m,i[4]):m,e[4]=I?Rr(e[3],E):i[4]}return m=i[5],m&&(I=e[5],e[5]=I?Gu(I,m,i[6]):m,e[6]=I?Rr(e[5],E):i[6]),m=i[7],m&&(e[7]=m),c&Ee&&(e[8]=e[8]==null?i[8]:Je(e[8],i[8])),e[9]==null&&(e[9]=i[9]),e[0]=i[0],e[1]=h,e}function vg(e){var i=[];if(e!=null)for(var n in be(e))i.push(n);return i}function mg(e){return In.call(e)}function lh(e,i,n){return i=He(i===r?e.length-1:i,0),function(){for(var c=arguments,h=-1,p=He(c.length-i,0),v=R(p);++h<p;)v[h]=c[i+h];h=-1;for(var m=R(i+1);++h<i;)m[h]=c[h];return m[i]=n(v),Ke(e,this,m)}}function fh(e,i){return i.length<2?e:ni(e,Nt(i,0,-1))}function wg(e,i){for(var n=e.length,c=Je(i.length,n),h=ut(e);c--;){var p=i[c];e[c]=fr(p,n)?h[p]:r}return e}function Va(e,i){if(!(i==="constructor"&&typeof e[i]=="function")&&i!="__proto__")return e[i]}var ph=gh(ju),Rs=Dp||function(e,i){return ce.setTimeout(e,i)},Ba=gh(kd);function dh(e,i,n){var c=i+"";return Ba(e,hg(c,_g(ag(c),n)))}function gh(e){var i=0,n=0;return function(){var c=Mp(),h=ts-(c-n);if(n=c,h>0){if(++i>=ke)return arguments[0]}else i=0;return e.apply(r,arguments)}}function Gn(e,i){var n=-1,c=e.length,h=c-1;for(i=i===r?c:i;++n<i;){var p=Ra(n,h),v=e[p];e[p]=e[n],e[n]=v}return e.length=i,e}var yh=gg(function(e){var i=[];return e.charCodeAt(0)===46&&i.push(""),e.replace($o,function(n,c,h,p){i.push(h?p.replace(Mo,"$1"):c||n)}),i});function er(e){if(typeof e=="string"||bt(e))return e;var i=e+"";return i=="0"&&1/e==-1/0?"-0":i}function ai(e){if(e!=null){try{return En.call(e)}catch{}try{return e+""}catch{}}return""}function _g(e,i){return Tt(xe,function(n){var c="_."+n[0];i&n[1]&&!vn(e,c)&&e.push(c)}),e.sort()}function vh(e){if(e instanceof ae)return e.clone();var i=new xt(e.__wrapped__,e.__chain__);return i.__actions__=ut(e.__actions__),i.__index__=e.__index__,i.__values__=e.__values__,i}function bg(e,i,n){(n?rt(e,i,n):i===r)?i=1:i=He(Y(i),0);var c=e==null?0:e.length;if(!c||i<1)return[];for(var h=0,p=0,v=R(An(c/i));h<c;)v[p++]=Nt(e,h,h+=i);return v}function Eg(e){for(var i=-1,n=e==null?0:e.length,c=0,h=[];++i<n;){var p=e[i];p&&(h[c++]=p)}return h}function Ig(){var e=arguments.length;if(!e)return[];for(var i=R(e-1),n=arguments[0],c=e;c--;)i[c-1]=arguments[c];return Or(Q(n)?ut(n):[n],We(i,1))}var Pg=re(function(e,i){return Ne(e)?bs(e,We(i,1,Ne,!0)):[]}),Sg=re(function(e,i){var n=$t(i);return Ne(n)&&(n=r),Ne(e)?bs(e,We(i,1,Ne,!0),K(n,2)):[]}),Og=re(function(e,i){var n=$t(i);return Ne(n)&&(n=r),Ne(e)?bs(e,We(i,1,Ne,!0),r,n):[]});function Rg(e,i,n){var c=e==null?0:e.length;return c?(i=n||i===r?1:Y(i),Nt(e,i<0?0:i,c)):[]}function Tg(e,i,n){var c=e==null?0:e.length;return c?(i=n||i===r?1:Y(i),i=c-i,Nt(e,0,i<0?0:i)):[]}function Ag(e,i){return e&&e.length?Ln(e,K(i,3),!0,!0):[]}function xg(e,i){return e&&e.length?Ln(e,K(i,3),!0):[]}function Cg(e,i,n,c){var h=e==null?0:e.length;return h?(n&&typeof n!="number"&&rt(e,i,n)&&(n=0,c=h),Id(e,i,n,c)):[]}function mh(e,i,n){var c=e==null?0:e.length;if(!c)return-1;var h=n==null?0:Y(n);return h<0&&(h=He(c+h,0)),mn(e,K(i,3),h)}function wh(e,i,n){var c=e==null?0:e.length;if(!c)return-1;var h=c-1;return n!==r&&(h=Y(n),h=n<0?He(c+h,0):Je(h,c-1)),mn(e,K(i,3),h,!0)}function _h(e){var i=e==null?0:e.length;return i?We(e,1):[]}function Ng(e){var i=e==null?0:e.length;return i?We(e,F):[]}function $g(e,i){var n=e==null?0:e.length;return n?(i=i===r?1:Y(i),We(e,i)):[]}function Dg(e){for(var i=-1,n=e==null?0:e.length,c={};++i<n;){var h=e[i];c[h[0]]=h[1]}return c}function bh(e){return e&&e.length?e[0]:r}function qg(e,i,n){var c=e==null?0:e.length;if(!c)return-1;var h=n==null?0:Y(n);return h<0&&(h=He(c+h,0)),Ni(e,i,h)}function jg(e){var i=e==null?0:e.length;return i?Nt(e,0,-1):[]}var Ug=re(function(e){var i=Se(e,Na);return i.length&&i[0]===e[0]?Ea(i):[]}),Mg=re(function(e){var i=$t(e),n=Se(e,Na);return i===$t(n)?i=r:n.pop(),n.length&&n[0]===e[0]?Ea(n,K(i,2)):[]}),Lg=re(function(e){var i=$t(e),n=Se(e,Na);return i=typeof i=="function"?i:r,i&&n.pop(),n.length&&n[0]===e[0]?Ea(n,r,i):[]});function zg(e,i){return e==null?"":jp.call(e,i)}function $t(e){var i=e==null?0:e.length;return i?e[i-1]:r}function Hg(e,i,n){var c=e==null?0:e.length;if(!c)return-1;var h=c;return n!==r&&(h=Y(n),h=h<0?He(c+h,0):Je(h,c-1)),i===i?_p(e,i,h):mn(e,tu,h,!0)}function kg(e,i){return e&&e.length?Nu(e,Y(i)):r}var Kg=re(Eh);function Eh(e,i){return e&&e.length&&i&&i.length?Oa(e,i):e}function Vg(e,i,n){return e&&e.length&&i&&i.length?Oa(e,i,K(n,2)):e}function Bg(e,i,n){return e&&e.length&&i&&i.length?Oa(e,i,r,n):e}var Fg=lr(function(e,i){var n=e==null?0:e.length,c=ma(e,i);return qu(e,Se(i,function(h){return fr(h,n)?+h:h}).sort(Bu)),c});function Gg(e,i){var n=[];if(!(e&&e.length))return n;var c=-1,h=[],p=e.length;for(i=K(i,3);++c<p;){var v=e[c];i(v,c,e)&&(n.push(v),h.push(c))}return qu(e,h),n}function Fa(e){return e==null?e:zp.call(e)}function Wg(e,i,n){var c=e==null?0:e.length;return c?(n&&typeof n!="number"&&rt(e,i,n)?(i=0,n=c):(i=i==null?0:Y(i),n=n===r?c:Y(n)),Nt(e,i,n)):[]}function Qg(e,i){return Mn(e,i)}function Jg(e,i,n){return Aa(e,i,K(n,2))}function Yg(e,i){var n=e==null?0:e.length;if(n){var c=Mn(e,i);if(c<n&&Kt(e[c],i))return c}return-1}function Zg(e,i){return Mn(e,i,!0)}function Xg(e,i,n){return Aa(e,i,K(n,2),!0)}function ey(e,i){var n=e==null?0:e.length;if(n){var c=Mn(e,i,!0)-1;if(Kt(e[c],i))return c}return-1}function ty(e){return e&&e.length?Uu(e):[]}function ry(e,i){return e&&e.length?Uu(e,K(i,2)):[]}function iy(e){var i=e==null?0:e.length;return i?Nt(e,1,i):[]}function sy(e,i,n){return e&&e.length?(i=n||i===r?1:Y(i),Nt(e,0,i<0?0:i)):[]}function ny(e,i,n){var c=e==null?0:e.length;return c?(i=n||i===r?1:Y(i),i=c-i,Nt(e,i<0?0:i,c)):[]}function oy(e,i){return e&&e.length?Ln(e,K(i,3),!1,!0):[]}function ay(e,i){return e&&e.length?Ln(e,K(i,3)):[]}var cy=re(function(e){return xr(We(e,1,Ne,!0))}),uy=re(function(e){var i=$t(e);return Ne(i)&&(i=r),xr(We(e,1,Ne,!0),K(i,2))}),hy=re(function(e){var i=$t(e);return i=typeof i=="function"?i:r,xr(We(e,1,Ne,!0),r,i)});function ly(e){return e&&e.length?xr(e):[]}function fy(e,i){return e&&e.length?xr(e,K(i,2)):[]}function py(e,i){return i=typeof i=="function"?i:r,e&&e.length?xr(e,r,i):[]}function Ga(e){if(!(e&&e.length))return[];var i=0;return e=Sr(e,function(n){if(Ne(n))return i=He(n.length,i),!0}),ha(i,function(n){return Se(e,aa(n))})}function Ih(e,i){if(!(e&&e.length))return[];var n=Ga(e);return i==null?n:Se(n,function(c){return Ke(i,r,c)})}var dy=re(function(e,i){return Ne(e)?bs(e,i):[]}),gy=re(function(e){return Ca(Sr(e,Ne))}),yy=re(function(e){var i=$t(e);return Ne(i)&&(i=r),Ca(Sr(e,Ne),K(i,2))}),vy=re(function(e){var i=$t(e);return i=typeof i=="function"?i:r,Ca(Sr(e,Ne),r,i)}),my=re(Ga);function wy(e,i){return Hu(e||[],i||[],_s)}function _y(e,i){return Hu(e||[],i||[],Ps)}var by=re(function(e){var i=e.length,n=i>1?e[i-1]:r;return n=typeof n=="function"?(e.pop(),n):r,Ih(e,n)});function Ph(e){var i=f(e);return i.__chain__=!0,i}function Ey(e,i){return i(e),e}function Wn(e,i){return i(e)}var Iy=lr(function(e){var i=e.length,n=i?e[0]:0,c=this.__wrapped__,h=function(p){return ma(p,e)};return i>1||this.__actions__.length||!(c instanceof ae)||!fr(n)?this.thru(h):(c=c.slice(n,+n+(i?1:0)),c.__actions__.push({func:Wn,args:[h],thisArg:r}),new xt(c,this.__chain__).thru(function(p){return i&&!p.length&&p.push(r),p}))});function Py(){return Ph(this)}function Sy(){return new xt(this.value(),this.__chain__)}function Oy(){this.__values__===r&&(this.__values__=Mh(this.value()));var e=this.__index__>=this.__values__.length,i=e?r:this.__values__[this.__index__++];return{done:e,value:i}}function Ry(){return this}function Ty(e){for(var i,n=this;n instanceof $n;){var c=vh(n);c.__index__=0,c.__values__=r,i?h.__wrapped__=c:i=c;var h=c;n=n.__wrapped__}return h.__wrapped__=e,i}function Ay(){var e=this.__wrapped__;if(e instanceof ae){var i=e;return this.__actions__.length&&(i=new ae(this)),i=i.reverse(),i.__actions__.push({func:Wn,args:[Fa],thisArg:r}),new xt(i,this.__chain__)}return this.thru(Fa)}function xy(){return zu(this.__wrapped__,this.__actions__)}var Cy=zn(function(e,i,n){pe.call(e,n)?++e[n]:ur(e,n,1)});function Ny(e,i,n){var c=Q(e)?Xc:Ed;return n&&rt(e,i,n)&&(i=r),c(e,K(i,3))}function $y(e,i){var n=Q(e)?Sr:Iu;return n(e,K(i,3))}var Dy=Yu(mh),qy=Yu(wh);function jy(e,i){return We(Qn(e,i),1)}function Uy(e,i){return We(Qn(e,i),F)}function My(e,i,n){return n=n===r?1:Y(n),We(Qn(e,i),n)}function Sh(e,i){var n=Q(e)?Tt:Ar;return n(e,K(i,3))}function Oh(e,i){var n=Q(e)?ip:Eu;return n(e,K(i,3))}var Ly=zn(function(e,i,n){pe.call(e,n)?e[n].push(i):ur(e,n,[i])});function zy(e,i,n,c){e=ht(e)?e:Vi(e),n=n&&!c?Y(n):0;var h=e.length;return n<0&&(n=He(h+n,0)),eo(e)?n<=h&&e.indexOf(i,n)>-1:!!h&&Ni(e,i,n)>-1}var Hy=re(function(e,i,n){var c=-1,h=typeof i=="function",p=ht(e)?R(e.length):[];return Ar(e,function(v){p[++c]=h?Ke(i,v,n):Es(v,i,n)}),p}),ky=zn(function(e,i,n){ur(e,n,i)});function Qn(e,i){var n=Q(e)?Se:Au;return n(e,K(i,3))}function Ky(e,i,n,c){return e==null?[]:(Q(i)||(i=i==null?[]:[i]),n=c?r:n,Q(n)||(n=n==null?[]:[n]),$u(e,i,n))}var Vy=zn(function(e,i,n){e[n?0:1].push(i)},function(){return[[],[]]});function By(e,i,n){var c=Q(e)?na:iu,h=arguments.length<3;return c(e,K(i,4),n,h,Ar)}function Fy(e,i,n){var c=Q(e)?sp:iu,h=arguments.length<3;return c(e,K(i,4),n,h,Eu)}function Gy(e,i){var n=Q(e)?Sr:Iu;return n(e,Zn(K(i,3)))}function Wy(e){var i=Q(e)?mu:zd;return i(e)}function Qy(e,i,n){(n?rt(e,i,n):i===r)?i=1:i=Y(i);var c=Q(e)?vd:Hd;return c(e,i)}function Jy(e){var i=Q(e)?md:Kd;return i(e)}function Yy(e){if(e==null)return 0;if(ht(e))return eo(e)?Di(e):e.length;var i=Ye(e);return i==ot||i==vt?e.size:Pa(e).length}function Zy(e,i,n){var c=Q(e)?oa:Vd;return n&&rt(e,i,n)&&(i=r),c(e,K(i,3))}var Xy=re(function(e,i){if(e==null)return[];var n=i.length;return n>1&&rt(e,i[0],i[1])?i=[]:n>2&&rt(i[0],i[1],i[2])&&(i=[i[0]]),$u(e,We(i,1),[])}),Jn=$p||function(){return ce.Date.now()};function ev(e,i){if(typeof i!="function")throw new At(l);return e=Y(e),function(){if(--e<1)return i.apply(this,arguments)}}function Rh(e,i,n){return i=n?r:i,i=e&&i==null?e.length:i,hr(e,Ee,r,r,r,r,i)}function Th(e,i){var n;if(typeof i!="function")throw new At(l);return e=Y(e),function(){return--e>0&&(n=i.apply(this,arguments)),e<=1&&(i=r),n}}var Wa=re(function(e,i,n){var c=ne;if(n.length){var h=Rr(n,ki(Wa));c|=he}return hr(e,c,i,n,h)}),Ah=re(function(e,i,n){var c=ne|Z;if(n.length){var h=Rr(n,ki(Ah));c|=he}return hr(i,c,e,n,h)});function xh(e,i,n){i=n?r:i;var c=hr(e,te,r,r,r,r,r,i);return c.placeholder=xh.placeholder,c}function Ch(e,i,n){i=n?r:i;var c=hr(e,ie,r,r,r,r,r,i);return c.placeholder=Ch.placeholder,c}function Nh(e,i,n){var c,h,p,v,m,I,A=0,x=!1,N=!1,U=!0;if(typeof e!="function")throw new At(l);i=Dt(i)||0,Re(n)&&(x=!!n.leading,N="maxWait"in n,p=N?He(Dt(n.maxWait)||0,i):p,U="trailing"in n?!!n.trailing:U);function H($e){var Vt=c,gr=h;return c=h=r,A=$e,v=e.apply(gr,Vt),v}function V($e){return A=$e,m=Rs(se,i),x?H($e):v}function ee($e){var Vt=$e-I,gr=$e-A,Yh=i-Vt;return N?Je(Yh,p-gr):Yh}function B($e){var Vt=$e-I,gr=$e-A;return I===r||Vt>=i||Vt<0||N&&gr>=p}function se(){var $e=Jn();if(B($e))return ue($e);m=Rs(se,ee($e))}function ue($e){return m=r,U&&c?H($e):(c=h=r,v)}function Et(){m!==r&&ku(m),A=0,c=I=h=m=r}function it(){return m===r?v:ue(Jn())}function It(){var $e=Jn(),Vt=B($e);if(c=arguments,h=this,I=$e,Vt){if(m===r)return V(I);if(N)return ku(m),m=Rs(se,i),H(I)}return m===r&&(m=Rs(se,i)),v}return It.cancel=Et,It.flush=it,It}var tv=re(function(e,i){return bu(e,1,i)}),rv=re(function(e,i,n){return bu(e,Dt(i)||0,n)});function iv(e){return hr(e,Le)}function Yn(e,i){if(typeof e!="function"||i!=null&&typeof i!="function")throw new At(l);var n=function(){var c=arguments,h=i?i.apply(this,c):c[0],p=n.cache;if(p.has(h))return p.get(h);var v=e.apply(this,c);return n.cache=p.set(h,v)||p,v};return n.cache=new(Yn.Cache||cr),n}Yn.Cache=cr;function Zn(e){if(typeof e!="function")throw new At(l);return function(){var i=arguments;switch(i.length){case 0:return!e.call(this);case 1:return!e.call(this,i[0]);case 2:return!e.call(this,i[0],i[1]);case 3:return!e.call(this,i[0],i[1],i[2])}return!e.apply(this,i)}}function sv(e){return Th(2,e)}var nv=Bd(function(e,i){i=i.length==1&&Q(i[0])?Se(i[0],wt(K())):Se(We(i,1),wt(K()));var n=i.length;return re(function(c){for(var h=-1,p=Je(c.length,n);++h<p;)c[h]=i[h].call(this,c[h]);return Ke(e,this,c)})}),Qa=re(function(e,i){var n=Rr(i,ki(Qa));return hr(e,he,r,i,n)}),$h=re(function(e,i){var n=Rr(i,ki($h));return hr(e,Te,r,i,n)}),ov=lr(function(e,i){return hr(e,Me,r,r,r,i)});function av(e,i){if(typeof e!="function")throw new At(l);return i=i===r?i:Y(i),re(e,i)}function cv(e,i){if(typeof e!="function")throw new At(l);return i=i==null?0:He(Y(i),0),re(function(n){var c=n[i],h=Nr(n,0,i);return c&&Or(h,c),Ke(e,this,h)})}function uv(e,i,n){var c=!0,h=!0;if(typeof e!="function")throw new At(l);return Re(n)&&(c="leading"in n?!!n.leading:c,h="trailing"in n?!!n.trailing:h),Nh(e,i,{leading:c,maxWait:i,trailing:h})}function hv(e){return Rh(e,1)}function lv(e,i){return Qa($a(i),e)}function fv(){if(!arguments.length)return[];var e=arguments[0];return Q(e)?e:[e]}function pv(e){return Ct(e,q)}function dv(e,i){return i=typeof i=="function"?i:r,Ct(e,q,i)}function gv(e){return Ct(e,P|q)}function yv(e,i){return i=typeof i=="function"?i:r,Ct(e,P|q,i)}function vv(e,i){return i==null||_u(e,i,Ve(i))}function Kt(e,i){return e===i||e!==e&&i!==i}var mv=Vn(ba),wv=Vn(function(e,i){return e>=i}),ci=Ou(function(){return arguments}())?Ou:function(e){return Ae(e)&&pe.call(e,"callee")&&!fu.call(e,"callee")},Q=R.isArray,_v=et?wt(et):Td;function ht(e){return e!=null&&Xn(e.length)&&!pr(e)}function Ne(e){return Ae(e)&&ht(e)}function bv(e){return e===!0||e===!1||Ae(e)&&tt(e)==Xe}var $r=qp||oc,Ev=zt?wt(zt):Ad;function Iv(e){return Ae(e)&&e.nodeType===1&&!Ts(e)}function Pv(e){if(e==null)return!0;if(ht(e)&&(Q(e)||typeof e=="string"||typeof e.splice=="function"||$r(e)||Ki(e)||ci(e)))return!e.length;var i=Ye(e);if(i==ot||i==vt)return!e.size;if(Os(e))return!Pa(e).length;for(var n in e)if(pe.call(e,n))return!1;return!0}function Sv(e,i){return Is(e,i)}function Ov(e,i,n){n=typeof n=="function"?n:r;var c=n?n(e,i):r;return c===r?Is(e,i,r,n):!!c}function Ja(e){if(!Ae(e))return!1;var i=tt(e);return i==Kr||i==Bs||typeof e.message=="string"&&typeof e.name=="string"&&!Ts(e)}function Rv(e){return typeof e=="number"&&du(e)}function pr(e){if(!Re(e))return!1;var i=tt(e);return i==Er||i==rs||i==Oo||i==To}function Dh(e){return typeof e=="number"&&e==Y(e)}function Xn(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=oe}function Re(e){var i=typeof e;return e!=null&&(i=="object"||i=="function")}function Ae(e){return e!=null&&typeof e=="object"}var qh=Rt?wt(Rt):Cd;function Tv(e,i){return e===i||Ia(e,i,za(i))}function Av(e,i,n){return n=typeof n=="function"?n:r,Ia(e,i,za(i),n)}function xv(e){return jh(e)&&e!=+e}function Cv(e){if(dg(e))throw new G(u);return Ru(e)}function Nv(e){return e===null}function $v(e){return e==null}function jh(e){return typeof e=="number"||Ae(e)&&tt(e)==Vr}function Ts(e){if(!Ae(e)||tt(e)!=Mt)return!1;var i=On(e);if(i===null)return!0;var n=pe.call(i,"constructor")&&i.constructor;return typeof n=="function"&&n instanceof n&&En.call(n)==Ap}var Ya=Yt?wt(Yt):Nd;function Dv(e){return Dh(e)&&e>=-9007199254740991&&e<=oe}var Uh=ps?wt(ps):$d;function eo(e){return typeof e=="string"||!Q(e)&&Ae(e)&&tt(e)==Fr}function bt(e){return typeof e=="symbol"||Ae(e)&&tt(e)==vi}var Ki=ei?wt(ei):Dd;function qv(e){return e===r}function jv(e){return Ae(e)&&Ye(e)==Gr}function Uv(e){return Ae(e)&&tt(e)==xo}var Mv=Vn(Sa),Lv=Vn(function(e,i){return e<=i});function Mh(e){if(!e)return[];if(ht(e))return eo(e)?Ht(e):ut(e);if(gs&&e[gs])return vp(e[gs]());var i=Ye(e),n=i==ot?fa:i==vt?wn:Vi;return n(e)}function dr(e){if(!e)return e===0?e:0;if(e=Dt(e),e===F||e===-1/0){var i=e<0?-1:1;return i*ve}return e===e?e:0}function Y(e){var i=dr(e),n=i%1;return i===i?n?i-n:i:0}function Lh(e){return e?si(Y(e),0,Ge):0}function Dt(e){if(typeof e=="number")return e;if(bt(e))return J;if(Re(e)){var i=typeof e.valueOf=="function"?e.valueOf():e;e=Re(i)?i+"":i}if(typeof e!="string")return e===0?e:+e;e=su(e);var n=Ho.test(e);return n||Ko.test(e)?W(e.slice(2),n?2:8):zo.test(e)?J:+e}function zh(e){return Xt(e,lt(e))}function zv(e){return e?si(Y(e),-9007199254740991,oe):e===0?e:0}function fe(e){return e==null?"":_t(e)}var Hv=zi(function(e,i){if(Os(i)||ht(i)){Xt(i,Ve(i),e);return}for(var n in i)pe.call(i,n)&&_s(e,n,i[n])}),Hh=zi(function(e,i){Xt(i,lt(i),e)}),to=zi(function(e,i,n,c){Xt(i,lt(i),e,c)}),kv=zi(function(e,i,n,c){Xt(i,Ve(i),e,c)}),Kv=lr(ma);function Vv(e,i){var n=Li(e);return i==null?n:wu(n,i)}var Bv=re(function(e,i){e=be(e);var n=-1,c=i.length,h=c>2?i[2]:r;for(h&&rt(i[0],i[1],h)&&(c=1);++n<c;)for(var p=i[n],v=lt(p),m=-1,I=v.length;++m<I;){var A=v[m],x=e[A];(x===r||Kt(x,ji[A])&&!pe.call(e,A))&&(e[A]=p[A])}return e}),Fv=re(function(e){return e.push(r,sh),Ke(kh,r,e)});function Gv(e,i){return eu(e,K(i,3),Zt)}function Wv(e,i){return eu(e,K(i,3),_a)}function Qv(e,i){return e==null?e:wa(e,K(i,3),lt)}function Jv(e,i){return e==null?e:Pu(e,K(i,3),lt)}function Yv(e,i){return e&&Zt(e,K(i,3))}function Zv(e,i){return e&&_a(e,K(i,3))}function Xv(e){return e==null?[]:jn(e,Ve(e))}function em(e){return e==null?[]:jn(e,lt(e))}function Za(e,i,n){var c=e==null?r:ni(e,i);return c===r?n:c}function tm(e,i){return e!=null&&ah(e,i,Pd)}function Xa(e,i){return e!=null&&ah(e,i,Sd)}var rm=Xu(function(e,i,n){i!=null&&typeof i.toString!="function"&&(i=In.call(i)),e[i]=n},tc(ft)),im=Xu(function(e,i,n){i!=null&&typeof i.toString!="function"&&(i=In.call(i)),pe.call(e,i)?e[i].push(n):e[i]=[n]},K),sm=re(Es);function Ve(e){return ht(e)?vu(e):Pa(e)}function lt(e){return ht(e)?vu(e,!0):qd(e)}function nm(e,i){var n={};return i=K(i,3),Zt(e,function(c,h,p){ur(n,i(c,h,p),c)}),n}function om(e,i){var n={};return i=K(i,3),Zt(e,function(c,h,p){ur(n,h,i(c,h,p))}),n}var am=zi(function(e,i,n){Un(e,i,n)}),kh=zi(function(e,i,n,c){Un(e,i,n,c)}),cm=lr(function(e,i){var n={};if(e==null)return n;var c=!1;i=Se(i,function(p){return p=Cr(p,e),c||(c=p.length>1),p}),Xt(e,Ma(e),n),c&&(n=Ct(n,P|S|q,rg));for(var h=i.length;h--;)xa(n,i[h]);return n});function um(e,i){return Kh(e,Zn(K(i)))}var hm=lr(function(e,i){return e==null?{}:Ud(e,i)});function Kh(e,i){if(e==null)return{};var n=Se(Ma(e),function(c){return[c]});return i=K(i),Du(e,n,function(c,h){return i(c,h[0])})}function lm(e,i,n){i=Cr(i,e);var c=-1,h=i.length;for(h||(h=1,e=r);++c<h;){var p=e==null?r:e[er(i[c])];p===r&&(c=h,p=n),e=pr(p)?p.call(e):p}return e}function fm(e,i,n){return e==null?e:Ps(e,i,n)}function pm(e,i,n,c){return c=typeof c=="function"?c:r,e==null?e:Ps(e,i,n,c)}var Vh=rh(Ve),Bh=rh(lt);function dm(e,i,n){var c=Q(e),h=c||$r(e)||Ki(e);if(i=K(i,4),n==null){var p=e&&e.constructor;h?n=c?new p:[]:Re(e)?n=pr(p)?Li(On(e)):{}:n={}}return(h?Tt:Zt)(e,function(v,m,I){return i(n,v,m,I)}),n}function gm(e,i){return e==null?!0:xa(e,i)}function ym(e,i,n){return e==null?e:Lu(e,i,$a(n))}function vm(e,i,n,c){return c=typeof c=="function"?c:r,e==null?e:Lu(e,i,$a(n),c)}function Vi(e){return e==null?[]:la(e,Ve(e))}function mm(e){return e==null?[]:la(e,lt(e))}function wm(e,i,n){return n===r&&(n=i,i=r),n!==r&&(n=Dt(n),n=n===n?n:0),i!==r&&(i=Dt(i),i=i===i?i:0),si(Dt(e),i,n)}function _m(e,i,n){return i=dr(i),n===r?(n=i,i=0):n=dr(n),e=Dt(e),Od(e,i,n)}function bm(e,i,n){if(n&&typeof n!="boolean"&&rt(e,i,n)&&(i=n=r),n===r&&(typeof i=="boolean"?(n=i,i=r):typeof e=="boolean"&&(n=e,e=r)),e===r&&i===r?(e=0,i=1):(e=dr(e),i===r?(i=e,e=0):i=dr(i)),e>i){var c=e;e=i,i=c}if(n||e%1||i%1){var h=gu();return Je(e+h*(i-e+we("1e-"+((h+"").length-1))),i)}return Ra(e,i)}var Em=Hi(function(e,i,n){return i=i.toLowerCase(),e+(n?Fh(i):i)});function Fh(e){return ec(fe(e).toLowerCase())}function Gh(e){return e=fe(e),e&&e.replace(nr,fp).replace(ra,"")}function Im(e,i,n){e=fe(e),i=_t(i);var c=e.length;n=n===r?c:si(Y(n),0,c);var h=n;return n-=i.length,n>=0&&e.slice(n,h)==i}function Pm(e){return e=fe(e),e&&Wr.test(e)?e.replace(Qs,pp):e}function Sm(e){return e=fe(e),e&&Do.test(e)?e.replace(as,"\\$&"):e}var Om=Hi(function(e,i,n){return e+(n?"-":"")+i.toLowerCase()}),Rm=Hi(function(e,i,n){return e+(n?" ":"")+i.toLowerCase()}),Tm=Ju("toLowerCase");function Am(e,i,n){e=fe(e),i=Y(i);var c=i?Di(e):0;if(!i||c>=i)return e;var h=(i-c)/2;return Kn(xn(h),n)+e+Kn(An(h),n)}function xm(e,i,n){e=fe(e),i=Y(i);var c=i?Di(e):0;return i&&c<i?e+Kn(i-c,n):e}function Cm(e,i,n){e=fe(e),i=Y(i);var c=i?Di(e):0;return i&&c<i?Kn(i-c,n)+e:e}function Nm(e,i,n){return n||i==null?i=0:i&&(i=+i),Lp(fe(e).replace(cs,""),i||0)}function $m(e,i,n){return(n?rt(e,i,n):i===r)?i=1:i=Y(i),Ta(fe(e),i)}function Dm(){var e=arguments,i=fe(e[0]);return e.length<3?i:i.replace(e[1],e[2])}var qm=Hi(function(e,i,n){return e+(n?"_":"")+i.toLowerCase()});function jm(e,i,n){return n&&typeof n!="number"&&rt(e,i,n)&&(i=n=r),n=n===r?Ge:n>>>0,n?(e=fe(e),e&&(typeof i=="string"||i!=null&&!Ya(i))&&(i=_t(i),!i&&$i(e))?Nr(Ht(e),0,n):e.split(i,n)):[]}var Um=Hi(function(e,i,n){return e+(n?" ":"")+ec(i)});function Mm(e,i,n){return e=fe(e),n=n==null?0:si(Y(n),0,e.length),i=_t(i),e.slice(n,n+i.length)==i}function Lm(e,i,n){var c=f.templateSettings;n&&rt(e,i,n)&&(i=r),e=fe(e),i=to({},i,c,ih);var h=to({},i.imports,c.imports,ih),p=Ve(h),v=la(h,p),m,I,A=0,x=i.interpolate||Si,N="__p += '",U=pa((i.escape||Si).source+"|"+x.source+"|"+(x===Pi?Lo:Si).source+"|"+(i.evaluate||Si).source+"|$","g"),H="//# sourceURL="+(pe.call(i,"sourceURL")?(i.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++ia+"]")+`
`;e.replace(U,function(B,se,ue,Et,it,It){return ue||(ue=Et),N+=e.slice(A,It).replace(Bo,dp),se&&(m=!0,N+=`' +
__e(`+se+`) +
'`),it&&(I=!0,N+=`';
`+it+`;
__p += '`),ue&&(N+=`' +
((__t = (`+ue+`)) == null ? '' : __t) +
'`),A=It+B.length,B}),N+=`';
`;var V=pe.call(i,"variable")&&i.variable;if(!V)N=`with (obj) {
`+N+`
}
`;else if(Uo.test(V))throw new G(g);N=(I?N.replace(Co,""):N).replace(ir,"$1").replace(Gs,"$1;"),N="function("+(V||"obj")+`) {
`+(V?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(m?", __e = _.escape":"")+(I?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+N+`return __p
}`;var ee=Qh(function(){return le(p,H+"return "+N).apply(r,v)});if(ee.source=N,Ja(ee))throw ee;return ee}function zm(e){return fe(e).toLowerCase()}function Hm(e){return fe(e).toUpperCase()}function km(e,i,n){if(e=fe(e),e&&(n||i===r))return su(e);if(!e||!(i=_t(i)))return e;var c=Ht(e),h=Ht(i),p=nu(c,h),v=ou(c,h)+1;return Nr(c,p,v).join("")}function Km(e,i,n){if(e=fe(e),e&&(n||i===r))return e.slice(0,cu(e)+1);if(!e||!(i=_t(i)))return e;var c=Ht(e),h=ou(c,Ht(i))+1;return Nr(c,0,h).join("")}function Vm(e,i,n){if(e=fe(e),e&&(n||i===r))return e.replace(cs,"");if(!e||!(i=_t(i)))return e;var c=Ht(e),h=nu(c,Ht(i));return Nr(c,h).join("")}function Bm(e,i){var n=zr,c=gi;if(Re(i)){var h="separator"in i?i.separator:h;n="length"in i?Y(i.length):n,c="omission"in i?_t(i.omission):c}e=fe(e);var p=e.length;if($i(e)){var v=Ht(e);p=v.length}if(n>=p)return e;var m=n-Di(c);if(m<1)return c;var I=v?Nr(v,0,m).join(""):e.slice(0,m);if(h===r)return I+c;if(v&&(m+=I.length-m),Ya(h)){if(e.slice(m).search(h)){var A,x=I;for(h.global||(h=pa(h.source,fe(Ot.exec(h))+"g")),h.lastIndex=0;A=h.exec(x);)var N=A.index;I=I.slice(0,N===r?m:N)}}else if(e.indexOf(_t(h),m)!=m){var U=I.lastIndexOf(h);U>-1&&(I=I.slice(0,U))}return I+c}function Fm(e){return e=fe(e),e&&ss.test(e)?e.replace(Ws,bp):e}var Gm=Hi(function(e,i,n){return e+(n?" ":"")+i.toUpperCase()}),ec=Ju("toUpperCase");function Wh(e,i,n){return e=fe(e),i=n?r:i,i===r?yp(e)?Pp(e):ap(e):e.match(i)||[]}var Qh=re(function(e,i){try{return Ke(e,r,i)}catch(n){return Ja(n)?n:new G(n)}}),Wm=lr(function(e,i){return Tt(i,function(n){n=er(n),ur(e,n,Wa(e[n],e))}),e});function Qm(e){var i=e==null?0:e.length,n=K();return e=i?Se(e,function(c){if(typeof c[1]!="function")throw new At(l);return[n(c[0]),c[1]]}):[],re(function(c){for(var h=-1;++h<i;){var p=e[h];if(Ke(p[0],this,c))return Ke(p[1],this,c)}})}function Jm(e){return bd(Ct(e,P))}function tc(e){return function(){return e}}function Ym(e,i){return e==null||e!==e?i:e}var Zm=Zu(),Xm=Zu(!0);function ft(e){return e}function rc(e){return Tu(typeof e=="function"?e:Ct(e,P))}function ew(e){return xu(Ct(e,P))}function tw(e,i){return Cu(e,Ct(i,P))}var rw=re(function(e,i){return function(n){return Es(n,e,i)}}),iw=re(function(e,i){return function(n){return Es(e,n,i)}});function ic(e,i,n){var c=Ve(i),h=jn(i,c);n==null&&!(Re(i)&&(h.length||!c.length))&&(n=i,i=e,e=this,h=jn(i,Ve(i)));var p=!(Re(n)&&"chain"in n)||!!n.chain,v=pr(e);return Tt(h,function(m){var I=i[m];e[m]=I,v&&(e.prototype[m]=function(){var A=this.__chain__;if(p||A){var x=e(this.__wrapped__),N=x.__actions__=ut(this.__actions__);return N.push({func:I,args:arguments,thisArg:e}),x.__chain__=A,x}return I.apply(e,Or([this.value()],arguments))})}),e}function sw(){return ce._===this&&(ce._=xp),this}function sc(){}function nw(e){return e=Y(e),re(function(i){return Nu(i,e)})}var ow=qa(Se),aw=qa(Xc),cw=qa(oa);function Jh(e){return ka(e)?aa(er(e)):Md(e)}function uw(e){return function(i){return e==null?r:ni(e,i)}}var hw=eh(),lw=eh(!0);function nc(){return[]}function oc(){return!1}function fw(){return{}}function pw(){return""}function dw(){return!0}function gw(e,i){if(e=Y(e),e<1||e>oe)return[];var n=Ge,c=Je(e,Ge);i=K(i),e-=Ge;for(var h=ha(c,i);++n<e;)i(n);return h}function yw(e){return Q(e)?Se(e,er):bt(e)?[e]:ut(yh(fe(e)))}function vw(e){var i=++Tp;return fe(e)+i}var mw=kn(function(e,i){return e+i},0),ww=ja("ceil"),_w=kn(function(e,i){return e/i},1),bw=ja("floor");function Ew(e){return e&&e.length?qn(e,ft,ba):r}function Iw(e,i){return e&&e.length?qn(e,K(i,2),ba):r}function Pw(e){return ru(e,ft)}function Sw(e,i){return ru(e,K(i,2))}function Ow(e){return e&&e.length?qn(e,ft,Sa):r}function Rw(e,i){return e&&e.length?qn(e,K(i,2),Sa):r}var Tw=kn(function(e,i){return e*i},1),Aw=ja("round"),xw=kn(function(e,i){return e-i},0);function Cw(e){return e&&e.length?ua(e,ft):0}function Nw(e,i){return e&&e.length?ua(e,K(i,2)):0}return f.after=ev,f.ary=Rh,f.assign=Hv,f.assignIn=Hh,f.assignInWith=to,f.assignWith=kv,f.at=Kv,f.before=Th,f.bind=Wa,f.bindAll=Wm,f.bindKey=Ah,f.castArray=fv,f.chain=Ph,f.chunk=bg,f.compact=Eg,f.concat=Ig,f.cond=Qm,f.conforms=Jm,f.constant=tc,f.countBy=Cy,f.create=Vv,f.curry=xh,f.curryRight=Ch,f.debounce=Nh,f.defaults=Bv,f.defaultsDeep=Fv,f.defer=tv,f.delay=rv,f.difference=Pg,f.differenceBy=Sg,f.differenceWith=Og,f.drop=Rg,f.dropRight=Tg,f.dropRightWhile=Ag,f.dropWhile=xg,f.fill=Cg,f.filter=$y,f.flatMap=jy,f.flatMapDeep=Uy,f.flatMapDepth=My,f.flatten=_h,f.flattenDeep=Ng,f.flattenDepth=$g,f.flip=iv,f.flow=Zm,f.flowRight=Xm,f.fromPairs=Dg,f.functions=Xv,f.functionsIn=em,f.groupBy=Ly,f.initial=jg,f.intersection=Ug,f.intersectionBy=Mg,f.intersectionWith=Lg,f.invert=rm,f.invertBy=im,f.invokeMap=Hy,f.iteratee=rc,f.keyBy=ky,f.keys=Ve,f.keysIn=lt,f.map=Qn,f.mapKeys=nm,f.mapValues=om,f.matches=ew,f.matchesProperty=tw,f.memoize=Yn,f.merge=am,f.mergeWith=kh,f.method=rw,f.methodOf=iw,f.mixin=ic,f.negate=Zn,f.nthArg=nw,f.omit=cm,f.omitBy=um,f.once=sv,f.orderBy=Ky,f.over=ow,f.overArgs=nv,f.overEvery=aw,f.overSome=cw,f.partial=Qa,f.partialRight=$h,f.partition=Vy,f.pick=hm,f.pickBy=Kh,f.property=Jh,f.propertyOf=uw,f.pull=Kg,f.pullAll=Eh,f.pullAllBy=Vg,f.pullAllWith=Bg,f.pullAt=Fg,f.range=hw,f.rangeRight=lw,f.rearg=ov,f.reject=Gy,f.remove=Gg,f.rest=av,f.reverse=Fa,f.sampleSize=Qy,f.set=fm,f.setWith=pm,f.shuffle=Jy,f.slice=Wg,f.sortBy=Xy,f.sortedUniq=ty,f.sortedUniqBy=ry,f.split=jm,f.spread=cv,f.tail=iy,f.take=sy,f.takeRight=ny,f.takeRightWhile=oy,f.takeWhile=ay,f.tap=Ey,f.throttle=uv,f.thru=Wn,f.toArray=Mh,f.toPairs=Vh,f.toPairsIn=Bh,f.toPath=yw,f.toPlainObject=zh,f.transform=dm,f.unary=hv,f.union=cy,f.unionBy=uy,f.unionWith=hy,f.uniq=ly,f.uniqBy=fy,f.uniqWith=py,f.unset=gm,f.unzip=Ga,f.unzipWith=Ih,f.update=ym,f.updateWith=vm,f.values=Vi,f.valuesIn=mm,f.without=dy,f.words=Wh,f.wrap=lv,f.xor=gy,f.xorBy=yy,f.xorWith=vy,f.zip=my,f.zipObject=wy,f.zipObjectDeep=_y,f.zipWith=by,f.entries=Vh,f.entriesIn=Bh,f.extend=Hh,f.extendWith=to,ic(f,f),f.add=mw,f.attempt=Qh,f.camelCase=Em,f.capitalize=Fh,f.ceil=ww,f.clamp=wm,f.clone=pv,f.cloneDeep=gv,f.cloneDeepWith=yv,f.cloneWith=dv,f.conformsTo=vv,f.deburr=Gh,f.defaultTo=Ym,f.divide=_w,f.endsWith=Im,f.eq=Kt,f.escape=Pm,f.escapeRegExp=Sm,f.every=Ny,f.find=Dy,f.findIndex=mh,f.findKey=Gv,f.findLast=qy,f.findLastIndex=wh,f.findLastKey=Wv,f.floor=bw,f.forEach=Sh,f.forEachRight=Oh,f.forIn=Qv,f.forInRight=Jv,f.forOwn=Yv,f.forOwnRight=Zv,f.get=Za,f.gt=mv,f.gte=wv,f.has=tm,f.hasIn=Xa,f.head=bh,f.identity=ft,f.includes=zy,f.indexOf=qg,f.inRange=_m,f.invoke=sm,f.isArguments=ci,f.isArray=Q,f.isArrayBuffer=_v,f.isArrayLike=ht,f.isArrayLikeObject=Ne,f.isBoolean=bv,f.isBuffer=$r,f.isDate=Ev,f.isElement=Iv,f.isEmpty=Pv,f.isEqual=Sv,f.isEqualWith=Ov,f.isError=Ja,f.isFinite=Rv,f.isFunction=pr,f.isInteger=Dh,f.isLength=Xn,f.isMap=qh,f.isMatch=Tv,f.isMatchWith=Av,f.isNaN=xv,f.isNative=Cv,f.isNil=$v,f.isNull=Nv,f.isNumber=jh,f.isObject=Re,f.isObjectLike=Ae,f.isPlainObject=Ts,f.isRegExp=Ya,f.isSafeInteger=Dv,f.isSet=Uh,f.isString=eo,f.isSymbol=bt,f.isTypedArray=Ki,f.isUndefined=qv,f.isWeakMap=jv,f.isWeakSet=Uv,f.join=zg,f.kebabCase=Om,f.last=$t,f.lastIndexOf=Hg,f.lowerCase=Rm,f.lowerFirst=Tm,f.lt=Mv,f.lte=Lv,f.max=Ew,f.maxBy=Iw,f.mean=Pw,f.meanBy=Sw,f.min=Ow,f.minBy=Rw,f.stubArray=nc,f.stubFalse=oc,f.stubObject=fw,f.stubString=pw,f.stubTrue=dw,f.multiply=Tw,f.nth=kg,f.noConflict=sw,f.noop=sc,f.now=Jn,f.pad=Am,f.padEnd=xm,f.padStart=Cm,f.parseInt=Nm,f.random=bm,f.reduce=By,f.reduceRight=Fy,f.repeat=$m,f.replace=Dm,f.result=lm,f.round=Aw,f.runInContext=b,f.sample=Wy,f.size=Yy,f.snakeCase=qm,f.some=Zy,f.sortedIndex=Qg,f.sortedIndexBy=Jg,f.sortedIndexOf=Yg,f.sortedLastIndex=Zg,f.sortedLastIndexBy=Xg,f.sortedLastIndexOf=ey,f.startCase=Um,f.startsWith=Mm,f.subtract=xw,f.sum=Cw,f.sumBy=Nw,f.template=Lm,f.times=gw,f.toFinite=dr,f.toInteger=Y,f.toLength=Lh,f.toLower=zm,f.toNumber=Dt,f.toSafeInteger=zv,f.toString=fe,f.toUpper=Hm,f.trim=km,f.trimEnd=Km,f.trimStart=Vm,f.truncate=Bm,f.unescape=Fm,f.uniqueId=vw,f.upperCase=Gm,f.upperFirst=ec,f.each=Sh,f.eachRight=Oh,f.first=bh,ic(f,function(){var e={};return Zt(f,function(i,n){pe.call(f.prototype,n)||(e[n]=i)}),e}(),{chain:!1}),f.VERSION=s,Tt(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){f[e].placeholder=f}),Tt(["drop","take"],function(e,i){ae.prototype[e]=function(n){n=n===r?1:He(Y(n),0);var c=this.__filtered__&&!i?new ae(this):this.clone();return c.__filtered__?c.__takeCount__=Je(n,c.__takeCount__):c.__views__.push({size:Je(n,Ge),type:e+(c.__dir__<0?"Right":"")}),c},ae.prototype[e+"Right"]=function(n){return this.reverse()[e](n).reverse()}}),Tt(["filter","map","takeWhile"],function(e,i){var n=i+1,c=n==_r||n==$;ae.prototype[e]=function(h){var p=this.clone();return p.__iteratees__.push({iteratee:K(h,3),type:n}),p.__filtered__=p.__filtered__||c,p}}),Tt(["head","last"],function(e,i){var n="take"+(i?"Right":"");ae.prototype[e]=function(){return this[n](1).value()[0]}}),Tt(["initial","tail"],function(e,i){var n="drop"+(i?"":"Right");ae.prototype[e]=function(){return this.__filtered__?new ae(this):this[n](1)}}),ae.prototype.compact=function(){return this.filter(ft)},ae.prototype.find=function(e){return this.filter(e).head()},ae.prototype.findLast=function(e){return this.reverse().find(e)},ae.prototype.invokeMap=re(function(e,i){return typeof e=="function"?new ae(this):this.map(function(n){return Es(n,e,i)})}),ae.prototype.reject=function(e){return this.filter(Zn(K(e)))},ae.prototype.slice=function(e,i){e=Y(e);var n=this;return n.__filtered__&&(e>0||i<0)?new ae(n):(e<0?n=n.takeRight(-e):e&&(n=n.drop(e)),i!==r&&(i=Y(i),n=i<0?n.dropRight(-i):n.take(i-e)),n)},ae.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},ae.prototype.toArray=function(){return this.take(Ge)},Zt(ae.prototype,function(e,i){var n=/^(?:filter|find|map|reject)|While$/.test(i),c=/^(?:head|last)$/.test(i),h=f[c?"take"+(i=="last"?"Right":""):i],p=c||/^find/.test(i);h&&(f.prototype[i]=function(){var v=this.__wrapped__,m=c?[1]:arguments,I=v instanceof ae,A=m[0],x=I||Q(v),N=function(se){var ue=h.apply(f,Or([se],m));return c&&U?ue[0]:ue};x&&n&&typeof A=="function"&&A.length!=1&&(I=x=!1);var U=this.__chain__,H=!!this.__actions__.length,V=p&&!U,ee=I&&!H;if(!p&&x){v=ee?v:new ae(this);var B=e.apply(v,m);return B.__actions__.push({func:Wn,args:[N],thisArg:r}),new xt(B,U)}return V&&ee?e.apply(this,m):(B=this.thru(N),V?c?B.value()[0]:B.value():B)})}),Tt(["pop","push","shift","sort","splice","unshift"],function(e){var i=_n[e],n=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",c=/^(?:pop|shift)$/.test(e);f.prototype[e]=function(){var h=arguments;if(c&&!this.__chain__){var p=this.value();return i.apply(Q(p)?p:[],h)}return this[n](function(v){return i.apply(Q(v)?v:[],h)})}}),Zt(ae.prototype,function(e,i){var n=f[i];if(n){var c=n.name+"";pe.call(Mi,c)||(Mi[c]=[]),Mi[c].push({name:i,func:n})}}),Mi[Hn(r,Z).name]=[{name:"wrapper",func:r}],ae.prototype.clone=Fp,ae.prototype.reverse=Gp,ae.prototype.value=Wp,f.prototype.at=Iy,f.prototype.chain=Py,f.prototype.commit=Sy,f.prototype.next=Oy,f.prototype.plant=Ty,f.prototype.reverse=Ay,f.prototype.toJSON=f.prototype.valueOf=f.prototype.value=xy,f.prototype.first=f.prototype.head,gs&&(f.prototype[gs]=Ry),f},qi=Sp();Ce?((Ce.exports=qi)._=qi,_e._=qi):ce._=qi}).call(qs)})(jc,jc.exports);var j1=Object.defineProperty,U1=Object.defineProperties,M1=Object.getOwnPropertyDescriptors,nf=Object.getOwnPropertySymbols,L1=Object.prototype.hasOwnProperty,z1=Object.prototype.propertyIsEnumerable,of=(o,t,r)=>t in o?j1(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,oo=(o,t)=>{for(var r in t||(t={}))L1.call(t,r)&&of(o,r,t[r]);if(nf)for(var r of nf(t))z1.call(t,r)&&of(o,r,t[r]);return o},H1=(o,t)=>U1(o,M1(t));function Mr(o,t,r){var s;const a=ab(o);return((s=t.rpcMap)==null?void 0:s[a.reference])||`${q1}?chainId=${a.namespace}:${a.reference}&projectId=${r}`}function di(o){return o.includes(":")?o.split(":")[1]:o}function ep(o){return o.map(t=>`${t.split(":")[0]}:${t.split(":")[1]}`)}function k1(o,t){const r=Object.keys(t.namespaces).filter(a=>a.includes(o));if(!r.length)return[];const s=[];return r.forEach(a=>{const u=t.namespaces[a].accounts;s.push(...u)}),s}function K1(o={},t={}){const r=af(o),s=af(t);return jc.exports.merge(r,s)}function af(o){var t,r,s,a;const u={};if(!Qi(o))return u;for(const[l,g]of Object.entries(o)){const w=Gc(l)?[l]:g.chains,y=g.methods||[],E=g.events||[],P=g.rpcMap||{},S=js(l);u[S]=H1(oo(oo({},u[S]),g),{chains:lc(w,(t=u[S])==null?void 0:t.chains),methods:lc(y,(r=u[S])==null?void 0:r.methods),events:lc(E,(s=u[S])==null?void 0:s.events),rpcMap:oo(oo({},P),(a=u[S])==null?void 0:a.rpcMap)})}return u}function V1(o){return o.includes(":")?o.split(":")[2]:o}function B1(o){const t={};for(const[r,s]of Object.entries(o)){const a=s.methods||[],u=s.events||[],l=s.accounts||[],g=Gc(r)?[r]:s.chains?s.chains:ep(s.accounts);t[r]={chains:g,methods:a,events:u,accounts:l}}return t}function wc(o){return typeof o=="number"?o:o.includes("0x")?parseInt(o,16):o.includes(":")?Number(o.split(":")[1]):Number(o)}const tp={},Oe=o=>tp[o],_c=(o,t)=>{tp[o]=t};class F1{constructor(t){this.name="polkadot",this.namespace=t.namespace,this.events=Oe("events"),this.client=Oe("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(wr.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getAccounts(){const t=this.namespace.accounts;return t?t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;const a=di(r);t[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||Mr(t,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new mr(new Lr(s,Oe("disableProviderPing")))}}class G1{constructor(t){this.name="eip155",this.namespace=t.namespace,this.events=Oe("events"),this.client=Oe("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(t){switch(t.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(t);case"eth_chainId":return parseInt(this.getDefaultChain())}return this.namespace.methods.includes(t.request.method)?await this.client.request(t):this.getHttpProvider().request(t.request)}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(parseInt(t),r),this.chainId=parseInt(t),this.events.emit(wr.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}createHttpProvider(t,r){const s=r||Mr(`${this.name}:${t}`,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new mr(new Lr(s,Oe("disableProviderPing")))}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;const a=parseInt(di(r));t[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}getHttpProvider(){const t=this.chainId,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}async handleSwitchChain(t){var r,s;let a=t.request.params?(r=t.request.params[0])==null?void 0:r.chainId:"0x0";a=a.startsWith("0x")?a:`0x${a}`;const u=parseInt(a,16);if(this.isChainApproved(u))this.setDefaultChain(`${u}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:t.topic,request:{method:t.request.method,params:[{chainId:a}]},chainId:(s=this.namespace.chains)==null?void 0:s[0]}),this.setDefaultChain(`${u}`);else throw new Error(`Failed to switch to chain 'eip155:${u}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(t){return this.namespace.chains.includes(`${this.name}:${t}`)}}class W1{constructor(t){this.name="solana",this.namespace=t.namespace,this.events=Oe("events"),this.client=Oe("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(wr.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;const a=di(r);t[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||Mr(t,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new mr(new Lr(s,Oe("disableProviderPing")))}}class Q1{constructor(t){this.name="cosmos",this.namespace=t.namespace,this.events=Oe("events"),this.client=Oe("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(wr.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;const a=di(r);t[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||Mr(t,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new mr(new Lr(s,Oe("disableProviderPing")))}}class J1{constructor(t){this.name="cip34",this.namespace=t.namespace,this.events=Oe("events"),this.client=Oe("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(wr.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{const s=this.getCardanoRPCUrl(r),a=di(r);t[a]=this.createHttpProvider(a,s)}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}getCardanoRPCUrl(t){const r=this.namespace.rpcMap;if(r)return r[t]}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||this.getCardanoRPCUrl(t);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new mr(new Lr(s,Oe("disableProviderPing")))}}class Y1{constructor(t){this.name="elrond",this.namespace=t.namespace,this.events=Oe("events"),this.client=Oe("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(wr.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;const a=di(r);t[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||Mr(t,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new mr(new Lr(s,Oe("disableProviderPing")))}}class Z1{constructor(t){this.name="multiversx",this.namespace=t.namespace,this.events=Oe("events"),this.client=Oe("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(wr.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;const a=di(r);t[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||Mr(t,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new mr(new Lr(s,Oe("disableProviderPing")))}}class X1{constructor(t){this.name="near",this.namespace=t.namespace,this.events=Oe("events"),this.client=Oe("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){if(this.chainId=t,!this.httpProviders[t]){const s=r||Mr(`${this.name}:${t}`,this.namespace);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);this.setHttpProvider(t,s)}this.events.emit(wr.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const t=this.namespace.accounts;return t?t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;t[r]=this.createHttpProvider(r,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||Mr(t,this.namespace);return typeof s>"u"?void 0:new mr(new Lr(s,Oe("disableProviderPing")))}}var eP=Object.defineProperty,tP=Object.defineProperties,rP=Object.getOwnPropertyDescriptors,cf=Object.getOwnPropertySymbols,iP=Object.prototype.hasOwnProperty,sP=Object.prototype.propertyIsEnumerable,uf=(o,t,r)=>t in o?eP(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,ao=(o,t)=>{for(var r in t||(t={}))iP.call(t,r)&&uf(o,r,t[r]);if(cf)for(var r of cf(t))sP.call(t,r)&&uf(o,r,t[r]);return o},bc=(o,t)=>tP(o,rP(t));class Yc{constructor(t){this.events=new Kc,this.rpcProviders={},this.shouldAbortPairingAttempt=!1,this.maxPairingAttempts=10,this.disableProviderPing=!1,this.providerOpts=t,this.logger=typeof(t==null?void 0:t.logger)<"u"&&typeof(t==null?void 0:t.logger)!="string"?t.logger:_o(bo({level:(t==null?void 0:t.logger)||rf})),this.disableProviderPing=(t==null?void 0:t.disableProviderPing)||!1}static async init(t){const r=new Yc(t);return await r.initialize(),r}async request(t,r){const[s,a]=this.validateChain(r);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(s).request({request:ao({},t),chainId:`${s}:${a}`,topic:this.session.topic})}sendAsync(t,r,s){const a=new Date().getTime();this.request(t,s).then(u=>r(null,Eo(a,u))).catch(u=>r(u,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties}),await this.requestAccounts()}async disconnect(){var t;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(t=this.session)==null?void 0:t.topic,reason:De("USER_DISCONNECTED")}),await this.cleanup()}async connect(t){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(t),await this.cleanupPendingPairings(),!t.skipPairing)return await this.pair(t.pairingTopic)}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}removeListener(t,r){this.events.removeListener(t,r)}off(t,r){this.events.off(t,r)}get isWalletConnect(){return!0}async pair(t){this.shouldAbortPairingAttempt=!1;let r=0;do{if(this.shouldAbortPairingAttempt)throw new Error("Pairing aborted");if(r>=this.maxPairingAttempts)throw new Error("Max auto pairing attempts reached");const{uri:s,approval:a}=await this.client.connect({pairingTopic:t,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties});s&&(this.uri=s,this.events.emit("display_uri",s)),await a().then(u=>{this.session=u,this.namespaces||(this.namespaces=B1(u.namespaces),this.persist("namespaces",this.namespaces))}).catch(u=>{if(u.message!==Zf)throw u;r++})}while(!this.session);return this.onConnect(),this.session}setDefaultChain(t,r){try{if(!this.session)return;const[s,a]=this.validateChain(t);this.getProvider(s).setDefaultChain(a,r)}catch(s){if(!/Please call connect/.test(s.message))throw s}}async cleanupPendingPairings(t={}){this.logger.info("Cleaning up inactive pairings...");const r=this.client.pairing.getAll();if(li(r)){for(const s of r)t.deletePairings?this.client.core.expirer.set(s.topic,0):await this.client.core.relayer.subscriber.unsubscribe(s.topic);this.logger.info(`Inactive pairings cleared: ${r.length}`)}}abortPairingAttempt(){this.shouldAbortPairingAttempt=!0}async checkStorage(){if(this.namespaces=await this.getFromStore("namespaces"),this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.client.session.length){const t=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[t]),this.createProviders()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await I1.init({logger:this.providerOpts.logger||rf,relayUrl:this.providerOpts.relayUrl||N1,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const t=[...new Set(Object.keys(this.session.namespaces).map(r=>js(r)))];_c("client",this.client),_c("events",this.events),_c("disableProviderPing",this.disableProviderPing),t.forEach(r=>{if(!this.session)return;const s=k1(r,this.session),a=ep(s),u=K1(this.namespaces,this.optionalNamespaces),l=bc(ao({},u[r]),{accounts:s,chains:a});switch(r){case"eip155":this.rpcProviders[r]=new G1({namespace:l});break;case"solana":this.rpcProviders[r]=new W1({namespace:l});break;case"cosmos":this.rpcProviders[r]=new Q1({namespace:l});break;case"polkadot":this.rpcProviders[r]=new F1({namespace:l});break;case"cip34":this.rpcProviders[r]=new J1({namespace:l});break;case"elrond":this.rpcProviders[r]=new Y1({namespace:l});break;case"multiversx":this.rpcProviders[r]=new Z1({namespace:l});break;case"near":this.rpcProviders[r]=new X1({namespace:l});break}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",t=>{this.events.emit("session_ping",t)}),this.client.on("session_event",t=>{const{params:r}=t,{event:s}=r;if(s.name==="accountsChanged"){const a=s.data;a&&li(a)&&this.events.emit("accountsChanged",a.map(V1))}else if(s.name==="chainChanged"){const a=r.chainId,u=r.event.data,l=js(a),g=wc(a)!==wc(u)?`${l}:${wc(u)}`:a;this.onChainChanged(g)}else this.events.emit(s.name,s.data);this.events.emit("session_event",t)}),this.client.on("session_update",({topic:t,params:r})=>{var s;const{namespaces:a}=r,u=(s=this.client)==null?void 0:s.session.get(t);this.session=bc(ao({},u),{namespaces:a}),this.onSessionUpdate(),this.events.emit("session_update",{topic:t,params:r})}),this.client.on("session_delete",async t=>{await this.cleanup(),this.events.emit("session_delete",t),this.events.emit("disconnect",bc(ao({},De("USER_DISCONNECTED")),{data:t.topic}))}),this.on(wr.DEFAULT_CHAIN_CHANGED,t=>{this.onChainChanged(t,!0)})}getProvider(t){if(!this.rpcProviders[t])throw new Error(`Provider not found: ${t}`);return this.rpcProviders[t]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(t=>{var r;this.getProvider(t).updateNamespace((r=this.session)==null?void 0:r.namespaces[t])})}setNamespaces(t){const{namespaces:r,optionalNamespaces:s,sessionProperties:a}=t;r&&Object.keys(r).length&&(this.namespaces=r),s&&Object.keys(s).length&&(this.optionalNamespaces=s),this.sessionProperties=a,this.persist("namespaces",r),this.persist("optionalNamespaces",s)}validateChain(t){const[r,s]=(t==null?void 0:t.split(":"))||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[r,s];if(r&&!Object.keys(this.namespaces||{}).map(l=>js(l)).includes(r))throw new Error(`Namespace '${r}' is not configured. Please call connect() first with namespace config.`);if(r&&s)return[r,s];const a=js(Object.keys(this.namespaces)[0]),u=this.rpcProviders[a].getDefaultChain();return[a,u]}async requestAccounts(){const[t]=this.validateChain();return await this.getProvider(t).requestAccounts()}onChainChanged(t,r=!1){var s;if(!this.namespaces)return;const[a,u]=this.validateChain(t);r||this.getProvider(a).setDefaultChain(u),((s=this.namespaces[a])!=null?s:this.namespaces[`${a}:${u}`]).defaultChain=u,this.persist("namespaces",this.namespaces),this.events.emit("chainChanged",u)}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.session=void 0,this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,this.persist("namespaces",void 0),this.persist("optionalNamespaces",void 0),this.persist("sessionProperties",void 0),await this.cleanupPendingPairings({deletePairings:!0})}persist(t,r){this.client.core.storage.setItem(`${sf}/${t}`,r)}async getFromStore(t){return await this.client.core.storage.getItem(`${sf}/${t}`)}}const nP=Yc,oP="wc",aP="ethereum_provider",cP=`${oP}@2:${aP}:`,uP="https://rpc.walletconnect.com/v1/",Uc=["eth_sendTransaction","personal_sign"],hP=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode"],Mc=["chainChanged","accountsChanged"],lP=["chainChanged","accountsChanged","message","disconnect","connect"];var fP=Object.defineProperty,pP=Object.defineProperties,dP=Object.getOwnPropertyDescriptors,hf=Object.getOwnPropertySymbols,gP=Object.prototype.hasOwnProperty,yP=Object.prototype.propertyIsEnumerable,lf=(o,t,r)=>t in o?fP(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,Ms=(o,t)=>{for(var r in t||(t={}))gP.call(t,r)&&lf(o,r,t[r]);if(hf)for(var r of hf(t))yP.call(t,r)&&lf(o,r,t[r]);return o},ff=(o,t)=>pP(o,dP(t));function vo(o){return Number(o[0].split(":")[1])}function Ec(o){return`0x${o.toString(16)}`}function vP(o){const{chains:t,optionalChains:r,methods:s,optionalMethods:a,events:u,optionalEvents:l,rpcMap:g}=o;if(!Ic(t))throw new Error("Invalid chains");const w={chains:t,methods:s||Uc,events:u||Mc,rpcMap:Ms({},t.length?{[vo(t)]:g[vo(t)]}:{})},y=u==null?void 0:u.filter(q=>!Mc.includes(q)),E=s==null?void 0:s.filter(q=>!Uc.includes(q));if(!r&&!l&&!a&&!(y!=null&&y.length)&&!(E!=null&&E.length))return{required:t.length?w:void 0};const P=(y==null?void 0:y.length)&&(E==null?void 0:E.length)||!r,S={chains:[...new Set(P?w.chains.concat(r||[]):r)],methods:[...new Set(w.methods.concat(a!=null&&a.length?a:hP))],events:[...new Set(w.events.concat(l!=null&&l.length?l:lP))],rpcMap:g};return{required:t.length?w:void 0,optional:r.length?S:void 0}}class Zc{constructor(){this.events=new Ut.EventEmitter,this.namespace="eip155",this.accounts=[],this.chainId=1,this.STORAGE_KEY=cP,this.on=(t,r)=>(this.events.on(t,r),this),this.once=(t,r)=>(this.events.once(t,r),this),this.removeListener=(t,r)=>(this.events.removeListener(t,r),this),this.off=(t,r)=>(this.events.off(t,r),this),this.parseAccount=t=>this.isCompatibleChainId(t)?this.parseAccountId(t).address:t,this.signer={},this.rpc={}}static async init(t){const r=new Zc;return await r.initialize(t),r}async request(t){return await this.signer.request(t,this.formatChainId(this.chainId))}sendAsync(t,r){this.signer.sendAsync(t,r,this.formatChainId(this.chainId))}get connected(){return this.signer.client?this.signer.client.core.relayer.connected:!1}get connecting(){return this.signer.client?this.signer.client.core.relayer.connecting:!1}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(t){if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts(t);const{required:r,optional:s}=vP(this.rpc);try{const a=await new Promise(async(l,g)=>{var w;this.rpc.showQrModal&&((w=this.modal)==null||w.subscribeModal(y=>{!y.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),g(new Error("Connection request reset. Please try again.")))})),await this.signer.connect(ff(Ms({namespaces:Ms({},r&&{[this.namespace]:r})},s&&{optionalNamespaces:{[this.namespace]:s}}),{pairingTopic:t==null?void 0:t.pairingTopic})).then(y=>{l(y)}).catch(y=>{g(new Error(y.message))})});if(!a)return;const u=Yw(a.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:u),this.setAccounts(u),this.events.emit("connect",{chainId:Ec(this.chainId)})}catch(a){throw this.signer.logger.error(a),a}finally{this.modal&&this.modal.closeModal()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",t=>{const{params:r}=t,{event:s}=r;s.name==="accountsChanged"?(this.accounts=this.parseAccounts(s.data),this.events.emit("accountsChanged",this.accounts)):s.name==="chainChanged"?this.setChainId(this.formatChainId(s.data)):this.events.emit(s.name,s.data),this.events.emit("session_event",t)}),this.signer.on("chainChanged",t=>{const r=parseInt(t);this.chainId=r,this.events.emit("chainChanged",Ec(this.chainId)),this.persist()}),this.signer.on("session_update",t=>{this.events.emit("session_update",t)}),this.signer.on("session_delete",t=>{this.reset(),this.events.emit("session_delete",t),this.events.emit("disconnect",ff(Ms({},Xw("USER_DISCONNECTED")),{data:t.topic,name:"USER_DISCONNECTED"}))}),this.signer.on("display_uri",t=>{var r,s;this.rpc.showQrModal&&((r=this.modal)==null||r.closeModal(),(s=this.modal)==null||s.openModal({uri:t})),this.events.emit("display_uri",t)})}switchEthereumChain(t){this.request({method:"wallet_switchEthereumChain",params:[{chainId:t.toString(16)}]})}isCompatibleChainId(t){return typeof t=="string"?t.startsWith(`${this.namespace}:`):!1}formatChainId(t){return`${this.namespace}:${t}`}parseChainId(t){return Number(t.split(":")[1])}setChainIds(t){const r=t.filter(s=>this.isCompatibleChainId(s)).map(s=>this.parseChainId(s));r.length&&(this.chainId=r[0],this.events.emit("chainChanged",Ec(this.chainId)),this.persist())}setChainId(t){if(this.isCompatibleChainId(t)){const r=this.parseChainId(t);this.chainId=r,this.switchEthereumChain(r)}}parseAccountId(t){const[r,s,a]=t.split(":");return{chainId:`${r}:${s}`,address:a}}setAccounts(t){this.accounts=t.filter(r=>this.parseChainId(this.parseAccountId(r).chainId)===this.chainId).map(r=>this.parseAccountId(r).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(t){var r,s;const a=(r=t==null?void 0:t.chains)!=null?r:[],u=(s=t==null?void 0:t.optionalChains)!=null?s:[],l=a.concat(u);if(!l.length)throw new Error("No chains specified in either `chains` or `optionalChains`");const g=a.length?(t==null?void 0:t.methods)||Uc:[],w=a.length?(t==null?void 0:t.events)||Mc:[],y=(t==null?void 0:t.optionalMethods)||[],E=(t==null?void 0:t.optionalEvents)||[],P=(t==null?void 0:t.rpcMap)||this.buildRpcMap(l,t.projectId),S=(t==null?void 0:t.qrModalOptions)||void 0;return{chains:a==null?void 0:a.map(q=>this.formatChainId(q)),optionalChains:u.map(q=>this.formatChainId(q)),methods:g,events:w,optionalMethods:y,optionalEvents:E,rpcMap:P,showQrModal:!!(t!=null&&t.showQrModal),qrModalOptions:S,projectId:t.projectId,metadata:t.metadata}}buildRpcMap(t,r){const s={};return t.forEach(a=>{s[a]=this.getRpcUrl(a,r)}),s}async initialize(t){if(this.rpc=this.getRpcConfig(t),this.chainId=this.rpc.chains.length?vo(this.rpc.chains):vo(this.rpc.optionalChains),this.signer=await nP.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata,disableProviderPing:t.disableProviderPing,relayUrl:t.relayUrl,storageOptions:t.storageOptions}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal){let r;try{const{WalletConnectModal:s}=await Qw(()=>import("./index-De7PG1tA.js").then(a=>a.i),__vite__mapDeps([0,1,2]));r=s}catch{throw new Error("To use QR modal, please install @walletconnect/modal package")}if(r)try{this.modal=new r(Ms({projectId:this.rpc.projectId},this.rpc.qrModalOptions))}catch(s){throw this.signer.logger.error(s),new Error("Could not generate WalletConnectModal Instance")}}}loadConnectOpts(t){if(!t)return;const{chains:r,optionalChains:s,rpcMap:a}=t;r&&Ic(r)&&(this.rpc.chains=r.map(u=>this.formatChainId(u)),r.forEach(u=>{this.rpc.rpcMap[u]=(a==null?void 0:a[u])||this.getRpcUrl(u)})),s&&Ic(s)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=s==null?void 0:s.map(u=>this.formatChainId(u)),s.forEach(u=>{this.rpc.rpcMap[u]=(a==null?void 0:a[u])||this.getRpcUrl(u)}))}getRpcUrl(t,r){var s;return((s=this.rpc.rpcMap)==null?void 0:s[t])||`${uP}?chainId=eip155:${t}&projectId=${r||this.rpc.projectId}`}async loadPersistedSession(){if(!this.session)return;const t=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`),r=this.session.namespaces[`${this.namespace}:${t}`]?this.session.namespaces[`${this.namespace}:${t}`]:this.session.namespaces[this.namespace];this.setChainIds(t?[this.formatChainId(t)]:r==null?void 0:r.accounts),this.setAccounts(r==null?void 0:r.accounts)}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(t){return typeof t=="string"||t instanceof String?[this.parseAccount(t)]:t.map(r=>this.parseAccount(r))}}const jP=Zc;export{jP as EthereumProvider,lP as OPTIONAL_EVENTS,hP as OPTIONAL_METHODS,Mc as REQUIRED_EVENTS,Uc as REQUIRED_METHODS,Zc as default};
